"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[5247],{22974:(e,t,n)=>{n.d(t,{VZ:()=>v,Y7:()=>p,LH:()=>m});var a=n(31701);const r="theme";var o=n(1898),s=n(30021),i=n(4926),d=n(47839);const c=10;function l(e,t){const{device:n,ThemeStore:o}=e,{mode:s,usingSystemTheme:l}=t,p={mode:s};o.setState(p),e.mobileNative&&e.mobileNative.setTheme(s,l),d.setTheme(function(e,t){const n=(0,a.gh)({theme:e});return{mode:e,usingSystemTheme:t,colors:{white:a.ZP.white,blue:a.ZP.blue},borderRadius:4,textColor:n.regularTextColor,popoverBackgroundColor:n.popoverBackground,popoverBoxShadow:n.mediumBoxShadow,inputBoxShadow:n.inputBoxShadow,inputBackgroundColor:n.inputBackground,dividerColor:n.darkDividerColor,shadowOpacity:n.shadowOpacity}}(s,l)),localStorage.setItem(r,JSON.stringify(p)),function(e,t){if(0===e.nativeScrollbarWidth)return;const n=document.getElementById("scroll-properties");n&&(n.innerHTML=`\n\t\t\t::-webkit-scrollbar {\n\t\t\t\twidth: ${c}px;\n\t\t\t\theight: ${c}px;\n\t\t\t}\n\t\t\t::-webkit-scrollbar {\n\t\t\t\tbackground: transparent;\n\t\t\t}\n\t\t\t::-webkit-scrollbar-track {\n\t\t\t\tbackground: ${u.scrollbarTrack[t]};\n\t\t\t}\n\t\t\t::-webkit-scrollbar-thumb {\n\t\t\t\tbackground:${u.scrollbarThumb[t]};\n\t\t\t}\n\t\t\t::-webkit-scrollbar-thumb:hover {\n\t\t\t\tbackground:${u.scrollbarThumbHover[t]};\n\t\t\t}\n\t\t`,i.Z.setState(c))}(n,s),"dark"===s?document.body.classList.add("dark"):document.body.classList.remove("dark")}const u={scrollbarTrack:{light:"#EDECE9",dark:"rgba(202, 204, 206, 0.04)"},scrollbarThumb:{light:"#D3D1CB",dark:"#474c50"},scrollbarThumbHover:{light:"#AEACA6",dark:"rgba(202, 204, 206, 0.3)"}};function p(e){s.Z.setState(e)}function m(e){const t=v(e);switch(t){case"dark":case"light":l(e,{mode:t,usingSystemTheme:!1});break;case"system":!async function(e){const{mobileNative:t}=e;let n="light";n=t&&t.api.getTheme?await t.api.getTheme():e.device.prefersDarkInterface?"dark":"light",l(e,{mode:n,usingSystemTheme:!0})}(e);break;default:(0,o.t1)(t)}}function v(e){const t=s.Z.state||"system";return"dark"===(n=t)||"light"===n||"system"===n?n:"system";var n}},7802:(e,t,n)=>{n.d(t,{Z:()=>jt});var a=n(67294),r=n(480),o=n(77907),s=n(7032),i=n(97978),d=n(80444);const c=6e4;async function l(e){var t,n;void 0!==d.default.state.currentUserStore&&void 0!==d.default.state.currentSpaceStore||await d.default.waitUntil((()=>void 0!==d.default.state.currentUserStore&&void 0!==d.default.state.currentSpaceStore));const a=null===(t=d.default.state.currentUserStore)||void 0===t?void 0:t.id,r=null===(n=d.default.state.currentSpaceStore)||void 0===n?void 0:n.id;if(!document.hasFocus())return;if(!a||!r)return;const o=i.Cd({userId:a,spaceId:r}),c=Date.now();o?i.ci({userId:a,spaceId:r,session:{...o,lastFocusedTime:c}}):i.ci({userId:a,spaceId:r,session:{id:(0,s.ZP)(),sessionStartTime:c,lastFocusedTime:c}})}var u=n(54064),p=n(54642),m=n(88632),v=n(29755),h=n(17963);const f=new u.Z;var g=n(22974),b=n(30021);var S=n(86628),w=n(12321),E=n(48779),U=n(81236);function _(){const e=(0,r.O7)(),{currentUserRootStore:t}=(0,S.VK)((()=>d.default.state),[]);(0,a.useEffect)((()=>{t&&async function(e,t){await w.w();const n=t.getSpaceViewStores();for(const a of n){const t=a.getBookmarkedPageStores();for(const e of t)y(e);const n=a.getSharedPageStores();for(const e of n)y(e);const r=a.getTeamsStores();for(const e of r){const t=e.getTeamPagesStores();for(const e of t)y(e)}const o=a.getSpaceStore();if(o){U.Z.getData(e,{spaceId:o.id});const t=(0,E.XD)(e,o);for(const e of t)y(e)}}}(e,t)}),[t,e])}function y(e){e.load();const t=e.getCollectionViewSourceOrLinkCollectionStores();for(const n of t)n.load()}var T=n(47839),k=n(95477),L=n(32223);async function C(e){if(e.device.isBrowser&&document.hidden)return;if(e.device.isElectron&&!(await T.isWindowVisible()))return;if(L.isConnected())return void I(!0);if(!1===navigator.onLine&&!k.default.isLocalhost)return void I(!1);"success"===(await p.ping(e,{})).type?I(!0):I(!1)}function I(e){m.Z.setState({...m.Z.state,online:e,lastOfflineTimestamp:e?m.Z.state.lastOfflineTimestamp:Date.now()})}const A=5e3;var M=n(11342),R=n(22705),Z=n(74948),N=n(38676),P=n(24042);var x=n(84747),O=n(57400),V=n(64496);const B=6e5;function D(e){(0,V._3)(e)?O.Tm(e):O.Th({environment:e,force:!1})}var q=n(19584),F=n(79947);function $(e){(0,F.ZP)({url:`${k.default.secureFileConfig.rootPath}/refresh`,environment:e,method:"GET",format:"text"})}var K=n(53965),H=n(36610),G=n(88280);const W=K.P2(H.XW,5e3);var j=n(55632),z=n(58455);var Y=n(62134),J=n(45023);var X=n(24502),Q=n(68626);var ee=n(1302),te=n(14577),ne=n(61045),ae=n(69454),re=n(24666);const oe=new te.Z((()=>{const e=ae.Z.state;return e.phase===ae.i.willShow?0:e.estimatedKeyboardWebViewOverlap}),{debugName:"estimatedKeyboardWebViewOverlapStore"});var se=n(4993),ie=n(30583),de=n(18245),ce=n(77080);var le=n(2449),ue=n(85844);var pe=n(98104),me=n(89224),ve=n(59238);const he=window.matchMedia("(prefers-color-scheme: dark)");var fe=n(98794),ge=n(27534);const be="loadCachedPageChunk";var Se=n(13447);var we=n(64964),Ee=n(85893);var Ue=n(83355),_e=n(54153),ye=n(9291),Te=n(35253),ke=n(47307),Le=n(91754),Ce=n(10854),Ie=n(46654),Ae=n(21051);class Me extends Ue.Z{constructor(){super(...arguments),this.handleElectronUpdateChecking=()=>{const{AppUpdateStore:e}=this.environment;e.setState({appUpdate:e.state.appUpdate,electronUpdate:{state:"checking"}})},this.handleElectronUpdateError=(e,t)=>{const{AppUpdateStore:n}=this.environment;n.setState({appUpdate:n.state.appUpdate,electronUpdate:{state:"error",error:t}})},this.handleElectronUpdateNotAvailable=()=>{const{AppUpdateStore:e}=this.environment;e.setState({appUpdate:e.state.appUpdate,electronUpdate:{state:"no-update",timestamp:Date.now()}})},this.handleElectronUpdateAvailable=(e,t)=>{const{AppUpdateStore:n}=this.environment,a=(0,M.parseVersion)(t.version),r=T.getDesktopVersion(),o=(0,M.getUpdateType)({currentVersion:r,nextVersion:a,app:"desktop"});n.setState({appUpdate:n.state.appUpdate,electronUpdate:{state:"downloading",type:o,version:a,timestamp:Date.now(),progress:0}})},this.handleElectronUpdateProgress=(e,t)=>{const{AppUpdateStore:n}=this.environment,a=n.state;a.electronUpdate&&"downloading"===a.electronUpdate.state&&n.setState({appUpdate:a.appUpdate,electronUpdate:{...a.electronUpdate,progress:t.transferred/t.total}})},this.handleElectronUpdateReady=(e,t)=>{const{device:n}=this.environment,{AppUpdateStore:a}=this.environment,r=_e.Z.get(Ce.Tm),o=t.version;if(r===o){if(n.isMac)return a.setState({appUpdate:a.state.appUpdate,electronUpdate:{state:"ready",type:M.UpdateType.Major,version:void 0}}),void ke.showDialog({message:(0,Ee.jsx)(ye.FormattedMessage,{id:"desktopAppUpdater.moveNotionToApplicationsFolderDialog.prompt",defaultMessage:"Please move the Notion app into the Applications folder for the auto-updater to work."}),showCancel:!1,keepFocus:!1,handleCancel:()=>(0,Ce.mK)(this.environment),items:[{label:(0,Ee.jsx)(ye.FormattedMessage,{id:"desktopAppUpdater.moveNotionToApplicationsFolderDialog.dismissButton.label",defaultMessage:"Okay"}),onAccept:()=>(0,Ce.mK)(this.environment)}]});Q.log({level:"error",from:"AppUpdateListener",type:"electronUpdateFailed",data:{miscDataToConvertToString:{previousUpdateReady:r,nextUpdateReady:o}}})}const s=T.getDesktopVersion(),i=(0,M.parseVersion)(t.version),d=(0,M.getUpdateType)({currentVersion:s,nextVersion:i,app:"desktop"});a.setState({appUpdate:a.state.appUpdate,electronUpdate:{state:"ready",type:d,version:i}})},this.handleAppUpdateChecking=()=>{const{AppUpdateStore:e}=this.environment;e.state.appUpdate&&"ready"===e.state.appUpdate.state||e.setState({electronUpdate:e.state.electronUpdate,appUpdate:{state:"checking"}})},this.handleElectronAppUpdateError=(e,t)=>{Pe(t,this.environment)},this.handleAppUpdateNotAvailable=()=>{const{AppUpdateStore:e}=this.environment;e.state.appUpdate&&"ready"===e.state.appUpdate.state||e.setState({electronUpdate:e.state.electronUpdate,appUpdate:{state:"no-update",timestamp:Date.now()}})},this.handleElectronAppUpdateAvailable=(e,t)=>{xe(t,this.environment)},this.handleElectronAppUpdateProgress=(e,t)=>{Oe(t,this.environment)},this.handleElectronAppUpdateReady=(e,t)=>{Ve(t,this.environment)},this.handleAppUpdateReload=e=>{Te.Js({bannerStore:Ae.Z}),le.hC({environment:this.environment,url:window.location.href,version:e})},this.handleElectronAppUpdateInstall=()=>{const e=this.environment.AppUpdateStore;if(m.Z.getState().online&&e.isSilentUpdate()){const t=e.state.appUpdate;le.hC({environment:this.environment,url:window.location.href,version:t.version})}},this.pollForAppJsUpdates=async()=>{let e="";for(await new Promise((e=>setTimeout(e,5e3)));this.componentIsMounted;){if(void 0===ue.Z.state.isVisible||!0===ue.Z.state.isVisible)try{const t=le.ac(),n=await p.getAssetsJsonV2(this.environment,{hash:e});if("success"===n.type){const a=n.data;if("version"in a){const e=(0,M.parseVersion)(a.version);e&&((0,M.isEqualVersion)(e,t)||Ve(a,this.environment))}"hash"in a&&(e=a.hash||"")}}catch(t){}await new Promise((e=>setTimeout(e,6e4)))}}}didMount(){const{device:e,mobileNative:t}=this.environment;if(e.isElectron?(T.electronUpdateReady.addListener(this.handleElectronUpdateReady),T.electronUpdateError.addListener(this.handleElectronUpdateError),T.electronUpdateChecking.addListener(this.handleElectronUpdateChecking),T.electronUpdateAvailable.addListener(this.handleElectronUpdateAvailable),T.electronUpdateProgress.addListener(this.handleElectronUpdateProgress),T.electronUpdateNotAvailable.addListener(this.handleElectronUpdateNotAvailable),T.appUpdateReady.addListener(this.handleElectronAppUpdateReady),T.appUpdateError.addListener(this.handleElectronAppUpdateError),T.appUpdateChecking.addListener(this.handleAppUpdateChecking),T.appUpdateAvailable.addListener(this.handleElectronAppUpdateAvailable),T.appUpdateInstall.addListener(this.handleElectronAppUpdateInstall),T.appUpdateProgress.addListener(this.handleElectronAppUpdateProgress),T.appUpdateNotAvailable.addListener(this.handleAppUpdateNotAvailable),T.appUpdateReload.addListener(this.handleAppUpdateReload)):t?t.updateReceiveApiHandlers({appUpdateReady:e=>Ve(e,this.environment),appUpdateError:e=>Pe(e,this.environment),appUpdateChecking:this.handleAppUpdateChecking,appUpdateAvailable:e=>xe(e,this.environment),appUpdateProgress:e=>Oe(e,this.environment),appUpdateNotAvailable:this.handleAppUpdateNotAvailable}):k.default.isAdminMode||k.default.isLocalhost&&!k.default.offline||this.pollForAppJsUpdates(),function(e){const t=le.ac(),n=le.uG();if(!(0,M.isEqualVersion)(t,n)){0,Ne((0,M.getUpdateType)({currentVersion:t,nextVersion:n,app:"client"}),n,e)}}(this.environment),e.isMobileNative&&t&&t.api.openUpdateSettings){const t=e.osVersion,n=e.isAndroid&&(0,M.isLessThanVersion)(t,[7,0]),a=e.isIOS&&(0,M.isLessThanVersion)(t,[15,0]);(n||a)&&function(e){const{mobileNative:t}=e;if(!t)return;Te.Bw({bannerStore:Ae.Z,id:"PlatformUpdateWarning",contentKey:"mobile_platform_unsupported",styleKey:Le.v.Red})}(this.environment)}}willUnmount(){const{device:e}=this.environment;e.isElectron&&(T.electronUpdateReady.removeListener(this.handleElectronUpdateReady),T.electronUpdateError.removeListener(this.handleElectronUpdateError),T.electronUpdateChecking.removeListener(this.handleElectronUpdateChecking),T.electronUpdateAvailable.removeListener(this.handleElectronUpdateAvailable),T.electronUpdateProgress.removeListener(this.handleElectronUpdateProgress),T.electronUpdateNotAvailable.removeListener(this.handleElectronUpdateNotAvailable),T.appUpdateReady.removeListener(this.handleElectronAppUpdateReady),T.appUpdateError.removeListener(this.handleElectronAppUpdateError),T.appUpdateChecking.removeListener(this.handleAppUpdateChecking),T.appUpdateAvailable.removeListener(this.handleElectronAppUpdateAvailable),T.appUpdateProgress.removeListener(this.handleElectronAppUpdateProgress),T.appUpdateNotAvailable.removeListener(this.handleAppUpdateNotAvailable),T.appUpdateReload.removeListener(this.handleAppUpdateReload))}}Me.displayName="AppUpdateListener";const Re=(0,ye.injectIntl)(Me);async function Ze(e){const t=await async function(e){await d.default.waitUntilRendered();const{mainEditorCurrentBlockStore:t,currentUserStore:n}=d.default.state;return!(!n||!t||(0,Ie.IJ)(e,t))}(e);t&&Te.Bw({bannerStore:Ae.Z,id:"AppUpdate",contentKey:"minor_app_update",styleKey:Le.v.Blue})}function Ne(e,t,n){e===M.UpdateType.Major?t&&le.M0(t)?(le.D$(t),Ze(n)):function(e){ke.showDialog({message:(0,Ee.jsx)(ye.FormattedMessage,{defaultMessage:"We just launched new features!",id:"breakingUpdateDialog.title"}),showCancel:!1,keepFocus:!1,handleCancel:()=>(0,Ce.mK)(e),items:[{label:(0,Ee.jsx)(ye.FormattedMessage,{defaultMessage:"Update and see what's new",id:"breakingUpdateDialog.updateButtonTitle"}),color:"blue",onAccept:()=>(0,Ce.mK)(e)}],innerStyle:{width:380}})}(n):e===M.UpdateType.Minor?(t&&le.M0(t)&&le.D$(t),Ze(n)):t&&le.M0(t)&&le.D$(t)}function Pe(e,t){const{AppUpdateStore:n}=t;n.state.appUpdate&&"ready"===n.state.appUpdate.state||n.setState({electronUpdate:n.state.electronUpdate,appUpdate:{state:"error",error:e}})}function xe(e,t){const{AppUpdateStore:n}=t;if(n.state.appUpdate&&"ready"===n.state.appUpdate.state)return;const a=(0,M.parseVersion)(e.version),r=le.ac(),o=(0,M.getUpdateType)({currentVersion:r,nextVersion:a,app:"client"});n.setState({electronUpdate:n.state.electronUpdate,appUpdate:{state:"downloading",type:o,version:a,timestamp:Date.now(),progress:0}})}function Oe(e,t){const{AppUpdateStore:n}=t,a=n.state;a.appUpdate&&"downloading"===a.appUpdate.state&&n.setState({electronUpdate:a.electronUpdate,appUpdate:{...a.appUpdate,progress:e.downloaded/e.total}})}function Ve(e,t){const{AppUpdateStore:n}=t,a=(0,M.parseVersion)(e.version),r=le.ac(),o=(0,M.getUpdateType)({currentVersion:r,nextVersion:a,app:"client"});if(!le.M0(a)){const e={state:"ready",type:o,version:a};n.setState({electronUpdate:n.state.electronUpdate,appUpdate:e})}Ne(o,a,t)}var Be=n(27328),De=n(15145),qe=n(97213),Fe=n(89101),$e=n(21202),Ke=n(92338);const He=["compact","regular","unknown"];var Ge=n(63811),We=n(12847),je=n(83249),ze=n(73990),Ye=n(97977),Je=n(98958),Xe=n(11302),Qe=n(52423),et=n(32953),tt=n(21862),nt=n(8055),at=n(1357),rt=n(87531),ot=n(24677),st=n(29974),it=n(70782),dt=n(39634),ct=n(12955),lt=n(33929),ut=n(51783),pt=n(44499),mt=n(45162),vt=n(18514),ht=n(45010),ft=n(97638);function gt(e){const t=(0,Be.w_)(e);switch(t.type){case"native":return;case"web":const e=t.route;switch(e.name){case"page":return e.collectionViewId?"collection":"page";case"nativeTab":switch(e.tab){case"search":return"search";case"updates":return"updates";case"assistant":return"assistant"}break;default:return}}}var bt=n(55081),St=n(75538),wt=n(19157),Et=n(24646),Ut=n(97799),_t=n(91190),yt=n(36896),Tt=n(44604),kt=n(5162),Lt=n(34859),Ct=n(12252),It=n(21273),At=n(30581),Mt=n(3418),Rt=n(69327),Zt=n(475),Nt=n(65686),Pt=n(53610),xt=n(66881),Ot=n(6258),Vt=n(62820),Bt=n(81023);const Dt=(0,ye.defineMessages)({failedToMovePageGeneric:{id:"MobileNativeListener.failedToMovePage",defaultMessage:"Failed to move page"}});let qt;class Ft extends Ue.Z{constructor(){super(...arguments),this.bottomBarVisibility=this.createComputedStore((()=>{const{currentUserStore:e}=d.default.state,t=Boolean(null==e?void 0:e.id),n=St.default.state.isOnboarding,a=(0,kt.Y)("supportsNativeBottomBarOverlappingWebView")?Mt.Z.hasOpenMobileSlideUps():Mt.Z.hasOpenPopups(),r="web"!==(0,Be.w_)(this.environment.TabbedRouterStore.state).type,o=t&&!n&&!a;return(0,kt.Y)("supportsWebManagedTabNavigation")&&!!r||o})),this.customAddCommentMenuItemEnabled=this.createComputedStore((()=>{var e;if(!(0,kt.Y)("supportsCustomAddCommentMenuItem"))return!1;const{currentUserStore:t}=d.default.state;if(!Boolean(null==t?void 0:t.id))return!1;if((0,kt.Y)("supportsNativeBottomBarOverlappingWebView")?Mt.Z.hasOpenMobileSlideUps():Mt.Z.hasOpenPopups())return!1;const{TabbedRouterStore:n}=this.environment,a=(0,Be.w_)(n.state),r="web"===a.type&&((null===(e=a.redirectedTo)||void 0===e?void 0:e.route)||a.route);if(!r||"page"!==r.name)return!1;const o=re.default.state;if("empty"===o.mode)return!1;const s=(0,mt.tp)({multiSelection:o.multiSelection,filterCommonAncestors:!0,focus:void 0});if(!s||0===s.stores.length)return!1;let i=!0;return s.stores.forEach((e=>{i&&(i=i&&e.canComment())})),i})),this.isOnUpdatesPage=this.createComputedStore((()=>{const e=this.environment.TabbedRouterStore.state;return"updates"===e.activeTab&&0===e.tabs.updates.pages.length})),this.aiAssistantEnabledState=this.createComputedStore((()=>{const{currentUserStore:e,currentSpaceStore:t}=d.default.state;if(!e||!t)return;const n=It.Z.isShowingQNAOnMobile();return{userId:e.id,spaceId:t.id,enabled:n}})),this.sideBarExpandedStateChangeHandler=()=>{var e;null===(e=this.environment.mobileNative)||void 0===e||e.sidebarVisibility(N.sidebarExpandedStore.state&&!(0,Et.YR)(this.environment),(0,Et.qG)(this.environment))},this.bottomBarVisibilityChange=()=>{var e;const t=this.bottomBarVisibility.state;null===(e=this.environment.mobileNative)||void 0===e||e.toggleBottomBar(t)},this.aiAssistantEnabledStateChange=()=>{var e;const t=this.aiAssistantEnabledState.state;t&&(null===(e=this.environment.mobileNative)||void 0===e||e.updateAiAssistantEnabledState(t))},this.handleSwipeNavigation=()=>{const{mobileNative:e,RouterStore:t}=this.environment;if(e&&e.setWebViewAllowsNavigationGestures){const{route:n}=t.state;"onboarding"===n.name||N.sidebarOpenStore.state||Nt.Z.getPreventScrollType()!==Lt.Z.None?!1!==qt&&(qt=!1,e.setWebViewAllowsNavigationGestures(!1)):!0!==qt&&(qt=!0,e.setWebViewAllowsNavigationGestures(!0))}},this.handleKeyboardAutoScroll=()=>{ae.Z.state.phase===ae.i.willShow&&ee.default.afterNextFlush((()=>ne.hQ(this.environment)))},this.handleTabbedRouterStoreChange=()=>{var e;const{mobileNative:t,TabbedRouterStore:n}=this.environment,a=null==t||null===(e=t.api)||void 0===e?void 0:e.handleTabbedRouterStateUpdate;if(a){const e=n.state;a({state:e,topPage:(0,Be.w_)(e),webTransitionType:gt(e),updateId:(0,s.ZP)()});const t=n.getPreviousState();if(!t)return;const r=(0,Be.F9)(t),o=(0,Be.F9)(e);K.Xy(r,o)||je.w3(this.environment,{origin:r,destination:o,from:e.navigationSource,action:e.navigationAction,logging_source:"mobile_native"})}},this.handleCustomAddMenuItemEnabledChanged=()=>{if(!(0,kt.Y)("supportsCustomAddCommentMenuItem"))return;const e=this.customAddCommentMenuItemEnabled.state,{mobileNative:t}=this.environment;null==t||t.updateCustomAddCommentMenuItemEnabled(e)},this.getLocalSearchCache=K.HP((async(e,t)=>(await o.deps.searchActions.loader()).getLocalCacheFromAppState(e)),((e,t)=>{var n;return`${e.currentUser.id}-${(null===(n=d.default.state.currentSpaceViewStore)||void 0===n?void 0:n.id)??"none"}-${t??"none"}`}))}UNSAFE_willMount(){const{mobileNative:e,RouterStore:t,TabbedRouterStore:n,device:a}=this.environment;var r;a.isMobileNative&&e&&(N.sidebarOpenStore.addListener(this.handleSwipeNavigation),N.sidebarExpandedStore.addListener(this.sideBarExpandedStateChangeHandler),At.Z.addListener(this.handleSwipeNavigation),t.addListener(this.handleSwipeNavigation),ae.Z.addListener(this.handleKeyboardAutoScroll),this.bottomBarVisibility.addListener(this.bottomBarVisibilityChange),this.aiAssistantEnabledState.addListener(this.aiAssistantEnabledStateChange),this.environment.WindowSizeStore.addListener(this.sideBarExpandedStateChangeHandler),n.addListener(this.handleTabbedRouterStoreChange),this.customAddCommentMenuItemEnabled.addListener(this.handleCustomAddMenuItemEnabledChanged),e.updateReceiveApiHandlers({statusBarTap:Wt,backButtonPress:()=>Y.Zm(this.environment,{type:"backbutton"}),keyboardWillShow:e=>{ae.Z.updateKeyboardPhase(this.environment,ae.i.willShow,e??0)},keyboardDidShow:e=>ae.Z.updateKeyboardPhase(this.environment,ae.i.shown,e??0),keyboardWillHide:()=>{ae.Z.updateKeyboardPhase(this.environment,ae.i.willHide,0)},keyboardDidHide:()=>{var e;(ae.Z.updateKeyboardPhase(this.environment,ae.i.hidden,0),a.isIpad)&&(ot.ZH(this.environment),null===(e=this.environment.NativeMobileActionBarStore)||void 0===e||e.clear(!0))},keyboardShortcut:e=>Y.Zm(this.environment,e),pushNotificationTokenRefresh:e=>Je.handleTokenRefresh(this.environment,e,"refresh"),resume:Ct.Z.resume,pause:Ct.Z.pause,refreshSubscriptionData:async e=>{await p.invalidateSubscriptionData(this.environment,{spaceId:e,provider:"revenue_cat"}),await Bt.bi(this.environment)},refreshSubscriptionDataV2:async()=>{await Bt.bi(this.environment)},processMobileActionBarAction:t=>{const{componentId:n,action:a}=t;e.componentEvents.dispatch("MobileActionBar",n,"onAction",{action:a})},updateExperimentData:async e=>{if((0,V._3)(this.environment)){const t=await(0,ct.getExperimentDeviceId)(this.environment),n=this.environment.currentUser.id,a=(0,V.fP)(t,n,e);a&&ce.default.updateState(a,this.environment)}},trackExperimentExposure:async e=>{await H.Bb({environment:this.environment,experiment_id:e.experimentId,experiment_version:e.experimentVersion,experiment_group:e.group||"ineligible",logging_source:"mobile_native"})},receiveRawMessageStoreMessage:e=>{L.onMobileNativeReceiveRawMessageStoreMessage(e,this.environment)},updateMessageStoreState:e=>{L.onMobileNativeUpdateMessageStoreState(e,this.environment)},logout:e=>{Ye.logoutSingleAccount({environment:this.environment,userId:e,logoutOrigin:qe.F.MobileNativeListener})},logoutAll:()=>{Ye.logout(this.environment)},openDestinationV2:e=>{Mt.Z.closeAll();const t=this.environment,a=(0,Be.w_)(t.TabbedRouterStore.state),{activeTab:r,tabs:o}=t.TabbedRouterStore.state,s=a===o[r].rootPage,i="native"===a.type,d=s&&i;switch((0,vt.__)(this.environment)&&at.S({environment:this.environment,tab:n.state.activeTab,nativeRootPageOverrideEnabled:!1}),e.type){case"moveTo":!function(e,t){const n=new Ot.G(t,{table:$e.iU,id:e});Xe.bA({environment:t,blocks:[n],moveToContext:"home_tab",onAccept:e=>{tt.r({store:n,environment:t,pageVisitSource:De.tY.Move})}})}(e.blockId,this.environment);break;case"trash":Gt({query:e.query});break;case"AIAssistant":!function(e,t,n){xt.g.update((e=>({query:n.query,searchSessionId:n.searchSessionId,from:n.from??"search",shouldReset:Boolean(n.query&&n.query.trim().length>0)}))),nt.c4({environment:e,url:`${Fe.VP.nativeTab}/assistant`,redirect:t})}(this.environment,d,{query:e.query,searchSessionId:e.searchSessionId,from:e.from})}},openDestination:e=>{Mt.Z.closeAll();switch("closePopup"!==e&&(0,vt.__)(this.environment)&&at.S({environment:this.environment,tab:n.state.activeTab,nativeRootPageOverrideEnabled:!1}),e){case"search":!function(e){(0,kt.Y)("supportsNativeHome")&&e.device.isPhone?(et.Hu({RouterStore:e.RouterStore,currentUserId:e.currentUser.id}),rt.UT({environment:e,analyticsFrom:"mobile-bottom-bar",renderAsPage:!0})):rt.UT({environment:e,analyticsFrom:"mobile-bottom-bar"});je.nB(e,{itemName:"search",logging_source:"mobile_native"})}(this.environment);break;case"addPage":!function(e){(0,kt.Y)("supportsNativeHome")&&e.device.isPhone?(et.Hu({RouterStore:e.RouterStore,currentUserId:e.currentUser.id}),Z.quickAddPage({environment:e,from:"mobile_bottom_bar",redirect:!0,quickAddParentOverride:{type:"space-private-pages"}})):Z.quickAddPage({environment:e,from:"mobile_bottom_bar"});je.nB(e,{itemName:"add_page"})}(this.environment);break;case"allUpdates":t=this.environment,(0,kt.Y)("supportsNativeHome")&&t.device.isPhone?(et.Hu({RouterStore:t.RouterStore,currentUserId:t.currentUser.id}),nt.c4({environment:t,url:`${Fe.VP.nativeTab}/updates`,redirect:!0})):Vt.Z.setState({...Vt.Z.state,open:!0});break;case"addAccount":_t.C.setState({..._t.C.state,open:!0});break;case"createOrJoinWorkspace":return async function(e){await bt.xN(e)}(this.environment);case"notificationAndSettings":Ut.Z.setState({open:!0,source:Ut.Y.Home});break;case"trash":Gt({});break;case"memberSettings":Pt.Z.setState({...Pt.Z.state,open:!0});break;case"help":Zt.Z.setState({...Zt.Z.state,open:!0});break;case"intercom_messages":!function(e){dt.j({environment:e,from:"help_button"})}(this.environment)}var t},setCurrentUserId:async e=>{await async function(e,t){if(t.currentUser.id===e)return;await it.x({environment:t,newCurrentUserId:e})}(e,this.environment)},setCurrentSpace:async e=>{await async function(e,t,n){const a=await it.x({environment:n,newCurrentUserId:e}),{currentUserRootStore:r,currentUserSettingsStore:o}=d.default.state;if(!r)return;await r.load();const s=(0,E.w3)(t);s&&await st.y3({environment:a,spaceViewStore:s,userSettingsStore:o,userRootStore:r,pageVisitSource:De.tY.SwitchSpace,navigationType:"switchingToOrLoadingSpace"})}(e.userId,e.spaceId,this.environment)},updateHorizontalSizeClass:t=>{const n=(0,Ge.Gu)(We.literals(...He),t)?"unknown":t;n!==e.horizontalSizeClass.state&&e.horizontalSizeClass.setState(n)},updateTabbedRouterState:e=>{var t;const{TabbedRouterStore:n}=this.environment,a=n.state;if(e.tab!==a.activeTab||null!==(t=e.pages)&&void 0!==t&&t.length||!K.Xy(e.modal,a.modal)||a.tabs[a.activeTab].pages.length){const t=e.navigationEffect;if(t&&"AIAssistant"===t.type)xt.g.update((e=>({query:t.query,searchSessionId:t.searchSessionId,from:t.from??"search",shouldReset:Boolean(t.query&&t.query.trim().length>0)})));at.S({environment:this.environment,tab:e.tab,queryParams:e.queryParams,pages:e.pages,modal:e.modal,nativeRootPageOverrideEnabled:e.nativeRootPageOverrideEnabled,navigationAction:e.navigationAction,navigationSource:e.navigationSource})}else Ht();const r=n.state;return[{state:r,topPage:(0,Be.w_)(r),webTransitionType:gt(r),updateId:e.updateId??(0,s.ZP)()}]},getLocalSearchResults:async e=>{const t=await this.getLocalSearchCache(this.environment,e.searchSessionId);if(!t)return[{error:"Local cache does not exist"}];const n=(0,Ge.Gu)(Ke.GA,e.sort);if(n)return[{error:`old sort type is unsupported! ${n}`}];const a=e.sort,r=(0,wt.f)({query:{query:{text:e.query??"",filters:e.filters,sort:a},limit:e.limit},localCachedPages:t,includeRecordMap:!1,userId:this.environment.currentUser.id,environment:this.environment,canUseLtr:!1}),o=[{value:{total:0,results:[],recordMap:{},trackEventProperties:void 0}}];if(!r||0===r.results.length)return o;const s=m.Z.state.online?ft.g8(this.environment,r.results):r.results;return[{value:{results:s,total:s.length,recordMap:{},trackEventProperties:{}}}]},customAddCommentMenuItemTapped:()=>{(0,ut.ol)(this.environment,"custom_add_comment_menu_item")},filterValidMoveToBlocks:e=>{const t=e.targets.map((e=>new Ot.G(this.environment,{table:$e.iU,id:e}))),n=e.blocks.filter((e=>{const n=new Ot.G(this.environment,{table:$e.iU,id:e});return n.canEdit()&&(0,pt.Xk)(n,t)}));return[{value:{targets:e.targets,blocks:n}}]},completeMoveToTransaction:async e=>{const{targets:t,destination:n,moveToContext:a,timeToSelectMs:r,isSearchResult:o,flowId:s}=e,i=this.environment,d=t.map((e=>new Ot.G(this.environment,{table:$e.iU,id:e}))),c=Xe.QF(i,t,n);if(d&&d.length>0&&!c)try{return await Se.createAndCommitAsync({userAction:"MobileNativeListener.completeMoveTo",environment:i,waitForServerCommit:!1,perform:async e=>{await Xe.RL({targets:d,value:n,transaction:e,environment:i,moveToContext:a,renderType:"native",timeToSelectMs:r,disableSuccessToast:!0,isSearchResult:o,flowId:s})}}),[{value:e}]}catch(l){}return ze.fW(i,{type:"moved_to_subpage"}),[{error:lt.default.formatMessage(Dt.failedToMovePageGeneric)}]},undoRevision:()=>{Qe.Yw(this.environment,!0)},searchTeams:async e=>{const{query:t}=e,n=d.default.state.currentSpaceStore,a=d.default.state.currentSpaceViewStore;if(!n||!a)return[{error:"SpaceStore or SpaceViewStore was undefined"}];const r=await o.deps.searchActions.loader();return[{value:{ids:(await r.searchTeams({spaceViewStore:a,query:t,teamStores:a.getTeamsStores()})).map((e=>e.id))}}]}}),null!==(r=this.environment.mobileNative)&&void 0!==r&&r.api.ready&&this.environment.mobileNative.api.ready(),this.sideBarExpandedStateChangeHandler(),this.handleCustomAddMenuItemEnabledChanged())}willUnmount(){const{mobileNative:e,RouterStore:t,TabbedRouterStore:n,device:a}=this.environment;a.isMobileNative&&e&&(N.sidebarOpenStore.removeListener(this.handleSwipeNavigation),N.sidebarExpandedStore.removeListener(this.sideBarExpandedStateChangeHandler),At.Z.removeListener(this.handleSwipeNavigation),t.removeListener(this.handleSwipeNavigation),ae.Z.removeListener(this.handleKeyboardAutoScroll),this.bottomBarVisibility.removeListener(this.bottomBarVisibilityChange),this.aiAssistantEnabledState.removeListener(this.aiAssistantEnabledStateChange),n.removeListener(this.handleTabbedRouterStoreChange),this.customAddCommentMenuItemEnabled.removeListener(this.handleCustomAddMenuItemEnabledChanged))}renderComponent(){return(0,Ee.jsx)(Kt,{getLocalSearchCache:this.getLocalSearchCache})}}Ft.displayName="MobileNativeListener";const $t=Ft;function Kt(e){let{getLocalSearchCache:t}=e;const n=(0,r.O7)(),{device:o}=n,i=(0,a.useRef)(),c=(0,a.useRef)(),l=(0,a.useCallback)((function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Object.keys(e.tabs).forEach((n=>{const a=n;t&&(e.tabs[a].nativeRootPageOverrideEnabled=void 0),e.tabs[a].pages="home"!==a?[]:e.tabs[a].pages.splice(0,1)}))}),[]),u=(0,a.useCallback)((e=>{var a;i.current=null==e?void 0:e.id;const{mobileNative:r,TabbedRouterStore:o,currentUser:c}=n,u=d.default.state.currentSpaceStore,p=null==u?void 0:u.id;if(null!=r&&null!==(a=r.api)&&void 0!==a&&a.setCurrentSpaceInfo&&(Q.log({level:"info",from:"appActions",type:"SpaceSwitchingDebug",data:{message:"Web calling nativeAPI setCurrentSpaceInfo",spaceId:p}}),r.api.setCurrentSpaceInfo({spaceId:p,spaceViewId:null==e?void 0:e.id,userId:c.id,editable:(null==u?void 0:u.canEdit())??!0})),(0,vt.__)(n)){const e=e=>{if("web"!==e.type)return;const t={...e.queryParams},n=p&&(0,s.cj)(p);t.spaceId=n,e.queryParams=t,e.route.spaceId=n},t=K.Xh(o.state);e(t.tabs.search.rootPage),e(t.tabs.updates.rootPage),e(t.tabs.addPage.rootPage),l(t),o.setState(t)}t(n,void 0)}),[l,n,t]),p=(0,a.useCallback)((e=>{var t;c.current=null==e?void 0:e.id,null!==(t=n.mobileNative)&&void 0!==t&&null!==(t=t.api)&&void 0!==t&&t.setCurrentUserInfo&&n.mobileNative.api.setCurrentUserInfo({userId:null==e?void 0:e.id,loggedInUserIds:n.currentUser.loggedInUserIds});const a=!(0,vt.__)(n)||void 0===n.currentUser.id,{TabbedRouterStore:r}=n,o=K.Xh(r.state);l(o,a),r.setState(o)}),[l,n]),m=(0,a.useCallback)((()=>{const{currentUserStore:e,currentSpaceStore:t}=d.default.state;null!=e&&e.id&&null!=t&&t.id&&Rt.Z.reinitializeState(n,e.id,t.id);(void 0===(null==e?void 0:e.id)||c.current!==(null==e?void 0:e.id))&&p(e);const a=d.default.state.currentSpaceViewStore;i.current!==(null==a?void 0:a.id)&&u(a)}),[n,u,p]);return(0,a.useEffect)((()=>{if(o.isMobileNative&&n.mobileNative)return m(),d.default.addListener(m),()=>{d.default.removeListener(m)}}),[o.isMobileNative,n,t,m]),null}function Ht(){Nt.Z.getPreventScrollType()===Lt.Z.None&&(N.sidebarOpenStore.state?ht.Z.SidebarMobileScroller&&ht.Z.SidebarMobileScroller.scrollToTop({animate:!0,animationCallback:K.yR}):ht.Z.MenuScroller?ht.Z.MenuScroller.scrollToTop({animate:!0,animationCallback:K.yR}):ht.Z.MenuPageScroller?ht.Z.MenuPageScroller.scrollToTop({animate:!0,animationCallback:K.yR}):ht.Z.PageScroller&&ht.Z.PageScroller.scrollToTop({animate:!0,animationCallback:K.yR}))}function Gt(e){yt.Z.setState({open:!0});const{query:t}=e;t&&Tt.Z.setState({...Tt.Z.state,currentTab:"all_pages",filter:t,limit:Tt.Z.startLimit})}function Wt(){Ht()}function jt(){const e=(0,r.Fy)();return function(){const e=(0,r.O7)(),t=(0,r.Fy)();(0,a.useEffect)((()=>{if(t.isMobileNative)return;let e;document.hasFocus()&&(e=setInterval((()=>{l()}),c),l());const n=()=>{e&&clearInterval(e),e=setInterval((()=>{l()}),c),l()},a=()=>{e&&clearInterval(e),e=void 0};return window.addEventListener("focus",n),window.addEventListener("blur",a),()=>{e&&clearInterval(e),window.removeEventListener("focus",n),window.removeEventListener("blur",a)}}),[t.isMobileNative,e])}(),function(){const e=(0,a.useRef)(!1),t=(0,r.O7)(),n=(0,a.useCallback)((async e=>{if(e.currentUser.id&&p.pendingTaskIds.size>0){const t=await p.getTasks(e,{taskIds:Array.from(p.pendingTaskIds.values())});if("success"===t.type){const{results:n}=t.data,a=new Set(p.pendingTaskIds);for(const t of n)a.delete(t.id),t.status&&p.handleRecordMapForResponse({environment:e,eventName:t.eventName,response:t.status,userId:e.currentUser.id}),p.pendingTaskEventsById.emit(t.id,t),f.emit(t.eventName,t),"failure"!==t.state&&"success"!==t.state||p.pendingTaskIds.delete(t.id);if(a.size>0)for(const e of a.values())p.pendingTaskIds.delete(e)}}}),[]),o=(0,a.useCallback)((async e=>{if(e.currentUser.id){const t=await p.getUserTasks(e,{});if("success"===t.type){for(const e of t.data.taskIds)p.pendingTaskIds.add(e);t.data.taskIds.length>0&&n(e)}}}),[n]),s=(0,a.useCallback)((()=>{const n=m.Z.state.online;n&&!e.current&&o(t),e.current=n}),[t,o]);function i(e){"success"===e.state?v.Z.setStatus(e.request.blockId,void 0):"in_progress"===e.state||"not_started"===e.state?v.Z.setStatus(e.request.blockId,e.status):v.Z.setStatus(e.request.blockId,void 0)}function d(e){"success"===e.state?h.Z.setStatus(e.request.blockId,!1):"in_progress"===e.state||"not_started"===e.state?h.Z.setStatus(e.request.blockId,!0):h.Z.setStatus(e.request.blockId,!1)}(0,a.useEffect)((()=>{e.current=m.Z.state.online;const a=setInterval((()=>n(t)),1e3);return o(t),m.Z.addListener(s),f.addListener("importEvernote",i),f.addListener("extractWebClipperContent",d),()=>{clearInterval(a),m.Z.removeListener(s),f.removeListener("importEvernote",i),f.removeListener("extractWebClipperContent",d)}}),[t,n,s,o])}(),function(){const e=(0,r.O7)(),t=(0,a.useCallback)((()=>{g.LH(e)}),[e]);(0,a.useEffect)((()=>(t(),b.Z.addListener(t),()=>{b.Z.removeListener(t)})),[t])}(),_(),function(){const e=(0,r.O7)();(0,a.useEffect)((()=>{C(e);const t=window.setInterval((()=>C(e)),A);return()=>window.clearInterval(t)}),[e])}(),function(){const e=(0,r.O7)();(0,x.Z)((()=>{D(e)})),(0,a.useEffect)((()=>{const t=window.setInterval((()=>D(e)),B);return()=>{window.clearInterval(t)}}),[e])}(),function(){const e=(0,r.O7)();(0,a.useEffect)((()=>{$(e);const t=window.setInterval((()=>$(e)),q.U6);return()=>window.clearInterval(t)}),[e])}(),function(){const e=(0,r.O7)(),t=(0,r.Fy)(),n=(0,S.VK)((()=>{const{currentUserStore:n,currentUserSettingsStore:a,currentUserRootStore:r}=d.default.state;if(!(e.currentUser.id&&n&&a&&r))return e.publicDomainUserId?{user_id:e.publicDomainUserId}:void 0;const o=r.getSpaceViewStores(),s=o.length>0&&o.every((e=>e.isReady()));if(!n.isDefined()||!a.isDefined()||!s)return;const c=K.oA(o.map((e=>e.getSpaceId()))).map((t=>U.Z.getData(e,{spaceId:t})));if(!c.every((e=>Boolean(e)||null===e)))return;const l=(0,i.ls)(c),u=a.getSettings();if(!u)return;if(void 0===G.subscriptionDataStoreInstance.state)return;const p={user_id:n.id,email:n.getEmail(),user_persona:u.persona,user_team_role:u.team_role,user_use_cases:u.use_cases,user_company_size:u.company_size,user_source:u.source,user_plan_type:l,user_subscription_tier:G.subscriptionDataStoreInstance.state.subscriptionTier,user_has_at_least_one_free_tier_space:(0,i.nZ)(c),time_zone:u.time_zone,locale:u.locale,preferred_locale:u.preferred_locale,signup_time:u.signup_time,app_version:t.version};return u.signup_time&&(p.created_at=Math.floor(u.signup_time/1e3)),t.desktopAppVersion&&(p.desktop_app_version=t.desktopAppVersion),t.mobileAppVersion&&(p.mobile_app_version=t.mobileAppVersion),u.used_desktop_web_app&&(p.used_desktop_web_app=u.used_desktop_web_app),u.used_mobile_web_app&&(p.used_mobile_web_app=u.used_mobile_web_app),u.used_mac_app&&(p.used_mac_app=u.used_mac_app),u.used_windows_app&&(p.used_windows_app=u.used_windows_app),u.used_ios_app&&(p.used_ios_app=u.used_ios_app),u.used_android_app&&(p.used_android_app=u.used_android_app),p}),[e,t],{useDeepEqual:!0});(0,a.useEffect)((()=>{n&&"none"!==n.user_plan_type&&W(e,n)}),[e,n]);const o=void 0!==n;(0,a.useEffect)((()=>{const t=window.setTimeout((()=>{!o&&e.currentUser.id&&W(e,{user_id:e.currentUser.id})}),5e3);return()=>{window.clearTimeout(t)}}),[e,o])}(),function(){const e=(0,r.O7)(),t=(0,S.VK)((()=>z.default.state.isLoaded),[]),n=(0,S.VK)((()=>z.default.state.isLoggingEnabled),[]);(0,a.useEffect)((()=>{t&&async function(){const t=await(0,i.cG)(e);await j.j2({config:k.default,isEnabled:n,deviceId:t,cookieService:e.cookieService})}()}),[e,t,n])}(),function(){const e=(0,r.O7)();(0,a.useEffect)((()=>{const t=t=>{Y.Zm(e,t)},n=t=>{const{shortcutMap:n}=e.KeyboardShortcutStackStore,a=K.w_(n,((n,a)=>(0,J.Z)(e,t,n)));a&&!{cut:!0,copy:!0,paste:!0}[a]&&Y.dJ(e,t,a)};return window.addEventListener("keydown",n),window.addEventListener("cut",t),window.addEventListener("copy",t),window.addEventListener("paste",t),window.addEventListener("keypress",t),()=>{window.removeEventListener("keydown",n),window.removeEventListener("cut",t),window.removeEventListener("copy",t),window.removeEventListener("paste",t),window.removeEventListener("keypress",t)}}))}(),(0,X.Z)(),function(){const e=(0,r.O7)(),t=(0,r.Fy)();(0,a.useEffect)((()=>{t.isElectron&&T.setLogglyData(Q.clientLogglyEnvironmentData),e.mobileNative&&e.mobileNative.setLogglyData(Q.clientLogglyEnvironmentData)}),[t.isElectron,e.mobileNative])}(),function(){const e=(0,r.O7)();(0,a.useEffect)((()=>{if(e.device.isMobile){function t(){ee.default.afterNextFlush((()=>{ne.hQ(e)}))}return re.default.addListener(t),oe.addListener(t),()=>{re.default.removeListener(t),oe.removeListener(t)}}}),[e])}(),(0,se.Z)(),(0,ie.ZP)(),function(){const e=(0,r.O7)();(0,a.useEffect)((()=>{const{mobileNative:t}=e;t&&t.enableBridgeMetricsCollection(e,de.default,ce.default)}),[e])}(),function(){const e=(0,r.O7)();(0,a.useEffect)((()=>{function t(){ue.Z.setState({...ue.Z.state,isVisible:!document.hidden});const t=le.W$(),n=t&&(Date.now()-t)/q.A0>=7;if(e.device.isBrowser&&!document.hidden&&(!t||n)&&m.Z.getState().online){const t=e.AppUpdateStore;if(t.isSilentUpdate()){const n=t.state.appUpdate;le.hC({environment:e,url:window.location.href,version:n.version})}}}return document.addEventListener("visibilitychange",t),t(),()=>{document.removeEventListener("visibilitychange",t)}}),[e])}(),function(){const{deviceType:e}=(0,r.Fy)(),t=(0,r.O7)(),n=t.currentUser.isLoggedIn();(0,a.useEffect)((()=>{if(!n)return;if("windows-desktop"!==e&&"mac-desktop"!==e)return;const a=async()=>{await T.isMainTabOrWindow()&&p.registerDesktopApp(t,{deviceType:e})};a();const r=window.setInterval((()=>{a()}),5*q.hM);return()=>{window.clearInterval(r)}}),[n,e,t])}(),function(){const e=(0,r.O7)(),t=(0,a.useRef)(),n=(0,a.useRef)();(0,a.useEffect)((()=>{function a(){const a=re.default.state,r="empty"===a.mode?void 0:a.multiSelection.start.store,o="empty"===a.mode?void 0:a.multiSelection.end.store;if(t.current===r&&n.current===o)return;if(t.current=r,n.current=o,t.current!==n.current)return;const s=ge.getSimpleTableCellFromTextSelection();if(!s)return;const{rowIndex:i,columnIndex:d,simpleTableStore:c}=s.getProps();fe.selectCell({environment:e,rowIndex:i,columnIndex:d,simpleTableStore:c})}return re.default.addListener(a),()=>{re.default.removeListener(a),t.current=void 0,n.current=void 0}}))}(),function(){const e=(0,r.O7)(),t=(0,a.useCallback)((t=>{const n={compressed:t.decodedBodySize!==t.encodedBodySize,local_cache_hit:0===t.transferSize,next_hop_protocol:t.nextHopProtocol,did_prefetch:e.prefetchCache.isEnabled},a={dns_lookup:{startTime:t.domainLookupStart,endTime:t.domainLookupEnd},connection_establish:{startTime:t.connectStart,endTime:t.connectEnd},request_queued:{startTime:t.connectEnd,endTime:t.requestStart},response_wait:{startTime:t.requestStart,endTime:t.responseStart},response_download:{startTime:t.responseStart,endTime:t.responseEnd}};de.default.measure({metricName:"load_cached_page_chunk.fetch",startTime:t.fetchStart,endTime:t.responseEnd},{environment:e,data:{...n,sub_metrics:{dns_lookup:a.dns_lookup.endTime-a.dns_lookup.startTime,connection_establish:a.connection_establish.endTime-a.connection_establish.startTime,request_queued:a.request_queued.endTime-a.request_queued.startTime,response_wait:a.response_wait.endTime-a.response_wait.startTime,response_download:a.response_download.endTime-a.response_download.startTime}}});for(const[r,{startTime:o,endTime:s}]of Object.entries(a))de.default.measure({metricName:`load_cached_page_chunk.fetch.${r}`,startTime:o,endTime:s},{environment:e,data:n})}),[e]);(0,a.useEffect)((()=>{const e=new PerformanceObserver((n=>{const a=n.getEntries().find((e=>e.name.includes(`${k.default.api.http}/${be}`)&&!e.name.endsWith("s")));a&&("resource"===a.entryType&&t(a),null==e||e.disconnect())}));return e.observe({type:"resource",buffered:!0}),()=>{e.disconnect()}}),[t])}(),function(){const e=(0,r.O7)();(0,a.useEffect)((()=>{const t=()=>Se.updateConnectionState(e);return t(),m.Z.addListener(t),()=>{m.Z.removeListener(t)}}),[e])}(),function(){const e=(0,r.O7)(),t=(0,a.useRef)("none"),n=(0,a.useCallback)((e=>{const n=t.current;e!==n&&(t.current=e,"dragging"===e?ve.Z.setState({isDragging:!0}):"dragging"===n&&ve.Z.setState({isDragging:!1}))}),[]),o=(0,a.useCallback)((()=>{"none"===t.current&&n("touching")}),[n]),s=(0,a.useCallback)((()=>{n("none")}),[n]),i=(0,a.useCallback)((()=>{"touching"===t.current&&me.isExpanded(me.get())&&n("dragging")}),[n]);(0,a.useEffect)((()=>{if(e.device.isIOS)return window.addEventListener("touchstart",o),window.addEventListener("touchend",s),window.addEventListener("touchcancel",s),document.addEventListener("selectionchange",i),()=>{window.removeEventListener("touchstart",o),window.removeEventListener("touchend",s),window.removeEventListener("touchcancel",s),document.removeEventListener("selectionchange",i)}}),[e.device.isIOS,o,s,i]);const d=(0,a.useCallback)((()=>{ee.default.afterNextFlush((()=>{pe.ls()}))}),[]),c=(0,a.useCallback)((()=>{setTimeout((()=>{me.get()||pe.ZH(e)}),0)}),[e]);(0,a.useEffect)((()=>(window.addEventListener("mousedown",d),e.device.isMobileBrowser&&document.addEventListener("focusout",c),()=>{window.removeEventListener("mousedown",d),document.removeEventListener("focusout",c)})),[e,d,c])}(),function(){const e=(0,r.O7)(),t=(0,r.Fy)(),n=(0,a.useRef)(!1),o=(0,a.useCallback)((()=>{"system"===g.VZ(e)&&b.Z.emit()}),[e]),s=(0,S.VK)((()=>{var e;return null===(e=d.default.state.mainEditorCurrentBlockStore)||void 0===e?void 0:e.isReady()}),[]);(0,a.useLayoutEffect)((()=>{!n.current&&s&&(o(),n.current=!0)}),[s,o]),(0,a.useEffect)((()=>{if(t.isAndroid&&e.mobileNative)e.mobileNative.updateReceiveApiHandlers({themeChanged:e=>o()});else{if(he.addEventListener&&he.removeEventListener)return he.addEventListener("change",o),()=>{he.removeEventListener("change",o)};if(he.addListener&&he.removeListener)return he.addListener(o),()=>{he.removeListener(o)}}}),[t.isAndroid,e,o])}(),function(){const e=k.default.isLocalhost||!1;(0,a.useEffect)((()=>{function t(t){if(!e)return;if(!t.data||"string"!=typeof t.data.type)return;const n=t.data.type;"webpackInvalid"===n?we.oV({label:(0,Ee.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,Ee.jsx)("span",{style:{paddingRight:10},children:"Webpack Compiling"}),(0,Ee.jsx)("img",{src:"/images/favicon-local.ico",className:"loading-spinner",style:{display:"inline-block"}})]}),position:"top",durationMs:"keep"}):"webpackOk"!==n&&"webpackWarnings"!==n||we.rN()}return window.addEventListener("message",t),()=>{window.removeEventListener("message",t)}}),[e])}(),(0,Ee.jsxs)(Ee.Fragment,{children:[(0,Ee.jsx)(Re,{},"AppUpdateListener"),(0,Ee.jsx)($t,{}),e.isElectron&&(0,Ee.jsx)(zt,{}),(0,Ee.jsx)(o.LazyInjectThirdPartyScripts,{})]})}function zt(){return function(){const e=(0,r.O7)(),t=(0,S.VK)((()=>({observedWidth:N.sidebarSizeObserver.rect.state.width,targetWidth:N.sidebarWidthStore.state,isExpanded:N.sidebarExpandedStore.state,resizing:N.sidebarResizingStore.state})),[]),n=e.currentUser.isLoggedIn(),o=(0,M.formatVersion)(T.getDesktopVersion()),[s,c]=(0,a.useState)(!1);(0,a.useEffect)((()=>{s&&T.windowSidebarState.set({isLoggedIn:n,...t})}),[t,n,s]);const l=(0,S.VK)((()=>R.ZP.getState().enabled),[]);(0,a.useEffect)((()=>{T.setIsMediaActive(l)}),[l]),(0,a.useEffect)((()=>{let e;e=n?t.isExpanded?"expanded":"collapsed":"disabled",T.sidebarState.set(e)}),[t.isExpanded,n]);const u=(0,S.VK)((()=>{var e,t,n;return{currentUserId:null===(e=d.default.state.currentUserStore)||void 0===e?void 0:e.id,currentSpaceId:null===(t=d.default.state.currentSpaceStore)||void 0===t?void 0:t.getSpaceId(),currentPageId:null===(n=d.default.state.mainEditorCurrentBlockStore)||void 0===n?void 0:n.id}}),[]);(0,a.useEffect)((()=>{T.setAppStoreState(u)}),[u]);const m=(0,a.useCallback)(((t,n,a)=>{i.j(e,n,a)}),[e]);(0,a.useEffect)((()=>(T.track.addListener(m),()=>{T.track.removeListener(m)})),[m]);const v=(0,a.useCallback)(((e,t)=>{c(t)}),[]);(0,a.useEffect)((()=>(T.isActiveTab.get().then((e=>{c(e)})),T.isActiveTab.addListener(v),()=>{T.isActiveTab.removeListener(v)})),[v]);const h=(0,a.useCallback)(((e,t)=>{void 0===t.isShowingTabBar&&(t.isShowingTabBar=t.isTabsFeatureEnabled),P.Z.setState(t)}),[]);(0,a.useEffect)((()=>{var e;return null===(e=T.electronAppFeatures.get())||void 0===e||e.then((e=>{P.Z.setState(e)})),T.electronAppFeatures.addListener(h),()=>{T.electronAppFeatures.removeListener(h)}}),[h]);const f=(0,a.useCallback)((n=>{Z.setExpand({environment:e,isExpanded:!t.isExpanded,from:"electron_listener"})}),[e,t.isExpanded]);(0,a.useEffect)((()=>(T.sidebarState.addToggleListener(f),()=>{T.sidebarState.removeToggleListener(f)})),[f]);const g=(0,a.useCallback)(((e,t)=>{t?Z.open({fromElectron:!0}):Z.close()}),[]);(0,a.useEffect)((()=>(T.sidebarState.addSetSidebarOpenListener(g),()=>{T.sidebarState.removeSetSidebarOpenListener(g)})),[g]);const b=(0,a.useCallback)(((e,t)=>{N.sidebarExpandedStore.setState(t.isExpanded),N.sidebarWidthStore.setState(t.targetWidth)}),[]);(0,a.useEffect)((()=>(T.windowSidebarState.addListener(b),()=>{T.windowSidebarState.removeListener(b)})),[b]),(0,a.useEffect)((()=>{!async function(){if(void 0===o)return;const t=await p.isDesktopVersionCompatible(e,{desktopVersion:o});"success"!==t.type||t.data.compatible||window.location.replace(k.default.domainBaseUrl+t.data.redirect)}()}),[o,e])}(),null}},98938:(e,t,n)=>{n.d(t,{Z:()=>V});var a=n(67294),r=n(480),o=n(86628),s=n(24405),i=n(41892),d=n(15095),c=n(43593),l=n(17755),u=n(42875),p=n(79362),m=n(22808),v=n(82883),h=n(9291),f=n(53965),g=n(18265),b=n(47839),S=n(8055),w=n(95477),E=n(60682),U=n(24990),_=n(19037),y=n(42129),T=n(77907);const k=32;const L=32;async function C(e){const t=document.createElement("canvas");t.width=L,t.height=L;const n=t.getContext("2d"),a=document.createElement("img");return a.src=e,new Promise((e=>{a.onload=()=>{n.drawImage(a,0,0,L,L),e(t.toDataURL("image/png"))},a.onerror=()=>{e("")}}))}var I=n(84210),A=n(83055),M=n(33929),R=n(46654),Z=n(94841),N=n(19034),P=n(80444),x=n(80641),O=n(53730);const V=function(){const e=(0,r.O7)(),t=(0,h.useIntl)(),n=(0,s.Fg)(),L=(0,a.useRef)(),V=(0,o.SI)((()=>{const{RouterStore:n,device:a}=e,r=n.state.route;if("chat"===r.name)return{title:"Notion AI"};if("settingsConsoleOrganization"===r.name)return{title:"Organization settings"};const o=P.default.state.mainEditorCurrentBlockStore;if(!o||!o.isReady())return;const s="page"===r.name&&r.blockId===o.id,i=o.getSpaceStore()??P.default.state.currentSpaceStore,c="space"===r.name&&r.requestedOnPublicDomain&&(null==i?void 0:i.getPublicHomePage())===o.id;if(!s&&!c)return;const l=N.Z.getTotalUnreadMentionsCount(),p=o.getTitleStore();let m;const h=o.getModel(),f=o.getCollectionViewIds(),g=null==p?void 0:p.getRecordModel(p.pointer);if(p&&g){if(m=(0,v.X)({intl:M.default.getIntl(),textValue:p.getValue(),userTimeZone:(0,u.r)(),getRecordModel:o.getRecordModel})||g.getEmptyTitlePlaceholder({getRecordModel:p.getRecordModel,userTimeZone:(0,u.r)(),intl:t}),"block"===p.table&&(0,Z.WE)(o)&&i){m=`${i.getName()} - ${t.formatMessage({id:"DocumentTitleListener.personalHomeLabel",defaultMessage:"Home"})}`}if("collection"===p.table&&h&&h.isCollectionView()&&f.length>1){const e=P.default.state.currentCollectionViewStore;e&&e.getName()&&(m=`${m} | ${e.getName()}`)}a.isElectron||(m=(0,d.db)(m.slice(0,100),U.Z.state)),R.IJ(e,o)||e.device.isElectron||e.device.isMobileNative||(l>9?m=`(9+) ${m}`:l>0&&(m=`(${l}) ${m}`))}let b;null!=i&&i.getPublicSpaceData()&&(b="page"===r.name?(0,I.ZP)({store:o,fullyQualified:!1,scrollToBlockId:null==r?void 0:r.scrollToBlockId,peekViewBlockId:r.peekViewBlockId,peekMode:r.peekMode,collectionViewId:r.collectionViewId,discussionId:r.discussionId,showMoveTo:r.showMoveTo,saveParent:r.saveParent,templateGalleryItem:r.templateGalleryItem,projectManagementLaunch:r.projectManagementLaunch,pageVisitSource:void 0}):(0,I.ZP)({store:o,fullyQualified:!1,pageVisitSource:void 0}));const S=o.getIcon(),w=null==h?void 0:h.isNonverifiedContentClassification();return{title:m,url:b,icon:S,isNonverified:w,hasBypassedContentClassification:w&&h&&x.Z.bypassedPage(o.id),isMemberOfSpace:(0,_.Iay)()}}),[e,t]);return(0,o.Kw)(V),(0,a.useEffect)((()=>{const a=f.Ds((function(){const{device:a}=e,r=V.state;if(!r)return;const{url:o,title:s,icon:u}=r;let v,h,f;u&&(0,p.V2)(u.icon)?f=u.icon:u&&(0,m.Z)(u.icon)?v=u.icon:u&&c.F8(u.icon)&&(h=u);const U=r.isNonverified&&!r.hasBypassedContentClassification&&!r.isMemberOfSpace;s&&document.title!==s&&(U?document.title=t.formatMessage({id:"pageTitle.flaggedContent",defaultMessage:"Flagged Content"}):a.isSafari&&v?document.title=`${v} ${s}`:document.title=s),o&&g.T1(o)!==g.T1(window.location.href)&&(window.history.replaceState(window.history.state,void 0,o),S.j7({environment:e,url:window.location.href}));const _=document.querySelector("link[rel='shortcut icon']");if(_){const t=i.Z.images.faviconIco;if(U)_.href=t,L.current=t;else if(v)v!==L.current&&(L.current=v,async function(e,t){const n=document.createElement("canvas");n.width=k,n.height=k;const a=n.getContext("2d");if(a.font="normal normal normal 32px/32px sans",a.textAlign="center",a.textBaseline="middle","raw"===t)return a.fillText(e,n.width/2,n.height/2+4),n;const r=await T.deps.emojiData.loader(),o=(0,y.y)(e,r);if(!o)return;const s=document.createElement("img");s.src=(0,d.bk)(t);const i=(0,d.G0)(o);return new Promise((e=>{s.onload=()=>{a.drawImage(s,i.x,i.y,i.size,i.size,0,0,k,k),e(n)},s.onerror=()=>{e(void 0)}}))}(v,(0,E.e_)(e)).then((async e=>{await A.aO(),_.href=(null==e?void 0:e.toDataURL("image/png"))||""})));else if(f){if(f!==L.current){L.current=f;const e=`${f}?mode=${n.mode}`;a.isFirefox?_.href=e:C(e).then((e=>{_.href=e}))}}else if(h){const{icon:t,...n}=h,a=l.EK({url:t,width:100,permissionRecord:n.pointer,baseUrl:w.default.domainBaseUrl,fullyQualified:!1,userId:e.currentUser.id});a!==L.current&&(L.current=a,O.transactionQueue.awaitRecordTransaction(n.pointer).then((()=>C(a))).then((e=>{_.href=e})))}else t!==L.current&&(_.href=t,L.current=t)}b.electronApi&&b.electronApi.setWindowTitle&&s&&b.electronApi.setWindowTitle(s)}),500,{leading:!0}),r=document.title;return V.state&&a(),V.addListener(a),()=>{V.removeListener(a),document.title=r}}),[e,t,V,n.mode]),null}},10854:(e,t,n)=>{n.d(t,{Tm:()=>f,mK:()=>g,p9:()=>h});var a=n(89101),r=n(54153),o=n(11342),s=n(36610),i=n(2449),d=n(35253),c=n(47307),l=n(47839),u=n(12714),p=n(95477),m=n(44819),v=n(21051);const h=!1,f="electronUpdateReady2";function g(e){const{AppUpdateStore:t,device:n}=e;if(s.By(e),h){const t=(0,m.Us)(a._j.releases);u.D({environment:e,url:t})}if(n.isElectron&&t.state.electronUpdate&&"ready"===t.state.electronUpdate.state){const e=l.getDesktopVersion();r.Z.set(f,(0,o.formatVersion)(e)),l.installElectronUpdate()}else t.state.appUpdate&&"ready"===t.state.appUpdate.state?(i.hC({environment:e,url:window.location.href,version:t.state.appUpdate.version}),c.dismissDialog(),d.Js({bannerStore:v.Z})):(i.D$((0,o.parseVersion)(p.default.version)),c.dismissDialog(),d.Js({bannerStore:v.Z}))}},44819:(e,t,n)=>{n.d(t,{Us:()=>o,XR:()=>s});var a=n(13991),r=n(13559);n(53965),n(95477);Boolean("en-US"===a.SP);function o(e){const t="https://www.notion.so";return"en-US"!==a.SP?`${t}/${a.SP.toLocaleLowerCase()}${e}`:`${t}${e}`}function s(e,t){if(e.device.isElectron||e.device.isMobileNative)return!1;const n=(0,r.XU)(t,e.currentUser.isLoggedIn());return!!n&&"devOnly"!==n}},19157:(e,t,n)=>{n.d(t,{Y:()=>x,f:()=>P});var a=n(21202),r=n(45366),o=n(92338),s=n(53965),i=n(7032),d=n(97978),c=n(97638),l=(n(57658),n(71384)),u=n(80444);class p{constructor(e,t,n){var a;this.featuresets=void 0,this.queryLower=void 0,this.userId=void 0,this.spaceId=void 0,this.currentTimeMs=void 0,this.pageSignals=void 0,this.resultsFeatureMetadata={},this.featuresets=e,this.queryLower=n.toLowerCase(),this.userId=t.currentUser.id,this.spaceId=null===(a=u.default.state.currentSpaceStore)||void 0===a?void 0:a.id,this.currentTimeMs=Date.now(),this.pageSignals=l.Z.getPageSignals({spaceId:this.spaceId,userId:this.userId})}extractFeatureGroup(e){const t=[];for(const n of this.featuresets){const a={groupName:n.name,features:[]};for(const t of n.features)a.features.push(t({result:e,featureExtractor:this}));t.push(a)}return t}}var m=n(26842),v=n(55320),h=n(29026),f=n(88893),g=n(43759);const b={name:"CLIENT_FEATURESET_RELEVANCY_MODEL",features:[function(e){let{result:t,featureExtractor:n}=e;return{name:"TIME_SINCE_LAST_EDIT",value:n.currentTimeMs-t.block.blockModel.last_edited_time}},function(e){let{result:t,featureExtractor:n}=e;return{name:"IS_LAST_EDITED_BY_ME",value:n.userId&&t.block.blockModel.last_edited_by_id===n.userId?1:0}},function(e){let{result:t,featureExtractor:n}=e;return{name:"IS_CREATED_BY_ME",value:n.userId&&t.block.blockModel.created_by_id===n.userId?1:0}},...o.ik.map((e=>t=>{let{result:n}=t;return{name:`BLOCK_SOURCE_${e}`,value:n.block.source.has(e)?1:0}})),function(e){var t;let{result:n,featureExtractor:a}=e;return{name:"PAGE_AUTHORITY_V1",value:a.pageSignals?null===(t=a.pageSignals[n.block.blockModel.id])||void 0===t?void 0:t.pageAuthorityV1:void 0}},function(e){let{result:t}=e;return{name:"TITLE_LENGTH",value:t.block.text.length}},function(e){let{result:{terms:t},featureExtractor:{queryLower:n}}=e;return{name:"TERMS_COUNT_NORMALIZED",value:t.length/(0,g.pv)(n).length}},function(e){let{result:{terms:t},featureExtractor:{queryLower:n}}=e;const a=(0,g.pv)(n),r=new Set(t);return{name:"FULL_MATCH_TERM_COUNT_NORMALIZED",value:a.filter((e=>r.has(e))).length/a.length}},function(e){let{result:{terms:t,block:{text:n}}}=e;const a=(0,g.pv)(n.toLowerCase());return{name:"MATCHING_PERCENTAGE_OF_TITLE",value:t.length/a.length}}]};n(21703);var S=n(1898);const w=["PAGE_AUTHORITY_V1"],E=["TIME_SINCE_LAST_EDIT"],U=["TIME_SINCE_LAST_EDIT","PAGE_AUTHORITY_V1","TITLE_LENGTH"];const _={TIME_SINCE_LAST_EDIT:.12466083431634997,IS_LAST_EDITED_BY_ME:-.21613457461144744,IS_CREATED_BY_ME:-.17703269315639597,BLOCK_SOURCE_spacePage:-.3131113880096196,BLOCK_SOURCE_recentVisit:1.3539828338773763,BLOCK_SOURCE_bookmarkedPage:-.2543964323135949,BLOCK_SOURCE_sharedPage:-.3735069046074023,BLOCK_SOURCE_frecencyStore:1.420276598070442,BLOCK_SOURCE_teamPage:-.4173608419044771,BLOCK_SOURCE_defaultRecordCache:.19379071892675268,BLOCK_SOURCE_similarUser1dRecentPages:-.13536189982444877,BLOCK_SOURCE_topPages7dPageView:-.39817781921863116,BLOCK_SOURCE_editedPages1d:0,BLOCK_SOURCE_similarUsersEditedPages1d:0,BLOCK_SOURCE_unknown:0,PAGE_AUTHORITY_V1:.039988235334501715,TITLE_LENGTH:-.07084803243271783,TERMS_COUNT_NORMALIZED:-.20071999737688903,FULL_MATCH_TERM_COUNT_NORMALIZED:.4070228883791121,MATCHING_PERCENTAGE_OF_TITLE:.44388948925567084};function y(e){const t=e.map((e=>{let{name:t,value:n}=e;return _[t]*(n??0)}));return(0,s.Sm)(t)}class T extends Error{constructor(e,t){super(e),this.name="MathError",this.cause=void 0,this.cause=t}}function k(e){const t=(0,s.J6)(e),n=(0,s.Sm)(e.map((e=>Math.pow(e-t,2))))/e.length;return Math.sqrt(n)}const L=1.25,C=[b];function I(e){const{results:t,featureGroups:n}=e;return t.map(((e,t)=>{const{block:a,score:r,personalizationBoost:s,rendered:i,terms:d}=e;return{sources:[o.vp.Local],id:a.blockModel.id,spaceId:a.blockModel.space_id,score:r,localSource:a.source,personalizationBoost:s,terms:d,highlight:{text:i},featureGroups:n[t]}}))}function A(e,t,n){const a=e=>n.matches(e.block),o=(0,r.wS)(t);if(1===o.length)return e.search(t,{filter:a,prefix:!0,fields:["text","inits"]});const s=e.search(t,{filter:a,combineWith:"AND",fields:["text"]});if(s.length>0)return s;const i=o.filter((e=>e.length>=g.Qu)),d=(c=i.length,Math.round(.6*c+.5));var c;return e.search(t,{filter:e=>e.queryTerms.length>=d&&a(e)})}function M(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function R(e){const{block:t,score:n,terms:a}=e,{source:r,text:s}=t,i=a.map(M).join("|"),d=new RegExp(i,"ig");var c;return{block:t,rendered:a.length>0?s.replaceAll(d,`${o.Um}$&${o.dK}`):s,score:n,personalizationBoost:(c=r).has("recentVisit")||c.has("frecencyStore")||c.has("bookmarkedPage")||c.has("defaultRecordCache")?L:1,terms:a}}function Z(e,t,n){const{blocks:a,getAllBlocks:r}=e,o=n.text.trim(),s=(0,i.nv)(o),d=s.length>0?s.join(" "):o,l=new c.uL(t);return d.length>0?function(e){const{blocksIndex:t,queryString:n,filterMatcher:a}=e;return A(t,n,a).map((e=>{const t=(0,g.RA)(n,e.block.text);return{...e,score:e.score*t}})).map(R)}({blocksIndex:a,queryString:d,filterMatcher:l}):r().filter((e=>l.matches(e.block))).map(R)}const N=(0,s.Ds)(((e,t,n)=>{C.forEach(((a,r)=>{const o=n.map(((e,n)=>({features:e[r].features,id:t[n].block.blockModel.id})));(0,d.j)(e,"search_local_result_features",{search_session_id:v.default.state.sessionId,group_name:a.name,results_features:o})}))}),1e3,{leading:!1,trailing:!0});function P(e){let{query:t,localCachedPages:n,userId:a,includeRecordMap:r,environment:o,canUseLtr:i}=e;const{query:l,limit:u}=t,{filters:m,sort:v}=l,g=Z(n,m,l);if(0===g.length)return;const b=function(e,t){const{field:n}=e,a="relevance"===n||"desc"===e.direction?-1:1;switch(n){case"lastEdited":case"scroll":return(0,s.MR)(t,(e=>{let{block:{blockModel:t}}=e;return a*(t.last_edited_time||0)}));case"created":return(0,s.MR)(t,(e=>{let{block:{blockModel:t}}=e;return a*(t.created_time||0)}));default:return(0,s.MR)(t,(e=>{let{score:t}=e;return a*t}))}}(v,g),_=t.query.text.length>1&&i,L=_?function(e,t,n,a){const r=new p(t,e,n);return a.map((e=>r.extractFeatureGroup(e)))}(o,C,t.query.text,b):b.map((e=>[]));_&&N(o,b,L);const A="relevance"===v.field?(0,c.YB)({sort:v,currentUserId:a,unsorted:I({results:b,featureGroups:L}),batchSize:h.Xv}):I({results:b,featureGroups:L}),M=function(e){const t=C.map(((t,n)=>{const a=e.map((e=>{var t;let{featureGroups:a}=e;return null===(t=a[n])||void 0===t?void 0:t.features}));if(a.some((e=>void 0===e)))return;const r=function(e){const t=(0,s.Xh)(e);for(const o of t)for(const e of o)(0,S.DE)(w,e.name)?e.value??=0:(0,S.DE)(E,e.name)&&(e.value=Math.log(e.value??1));const n=new Map,a=new Map,r=new Map;for(const o of t)for(const e of o)if(void 0!==e.value&&(0,S.DE)(U,e.name)){n.has(e.name)||n.set(e.name,[]);const t=n.get(e.name);t&&t.push(e.value)}for(const[o,i]of n.entries())a.set(o,(0,s.J6)(i)),r.set(o,k(i));for(const o of t)for(const e of o)if((0,S.DE)(U,e.name)){const t=a.get(e.name),n=r.get(e.name);if(void 0===e.value||void 0===t||void 0===n)throw new T(`Couldn't scale feature ${e.name}`);0!==n&&(e.value=(e.value-t)/n)}return t}(a);return r.map(y)}));if(t.some((e=>void 0===e)))return;return t}(A),R=void 0===M?{}:{result_relevancies:M[0],average_result_relevancy:(0,s.J6)(M[0])};(0,d.j)(o,"search_local_recall_results",{num_visible_members:(0,f.qX)(),results:b.map(O),...R});const P=A.slice(0,u),x=r??!0;return{total:g.length,results:P,recordMap:x?n.recordMap.toJson({allowVersionDowngrade:!1}):{},trackEventProperties:void 0}}function x(e){let{query:t,localCachedPages:n,parentStore:r,isOnline:s,environment:i,shouldLimitLocalResultsWhenOnline:d,maxLocalResultsOverride:l,canUseLtr:u}=e;const p=P({query:t,localCachedPages:n,userId:i.currentUser.id,environment:i,canUseLtr:u});if(!p)return;if(0===p.results.length)return{error:o.Ix.NoResults};let v=p.results.map(((e,t)=>({...e,originalPosition:t,store:m.G.createChildStore(r,{table:a.iU,id:e.id}),serverEventProperties:void 0})));const h=v.length;return s&&d&&(v=(0,c.g8)(i,v,l)),0===v.length?{error:o.Ix.NoResults}:{value:{total:h,results:v,debugInfo:void 0}}}function O(e){const{block:{source:t,blockModel:{id:n}}}=e;return{id:n,localSource:[...t]}}},91190:(e,t,n)=>{n.d(t,{C:()=>o,E:()=>r});var a=n(61766);const r=new a.Z,o=new a.Z},53610:(e,t,n)=>{n.d(t,{Z:()=>a});const a=new(n(61766).Z)},66881:(e,t,n)=>{n.d(t,{g:()=>a});const a=n(49085).default.createValue({shouldReset:!1})},56638:(e,t,n)=>{n.d(t,{Z:()=>o});var a=n(49085);class r extends a.default{getInitialState(){return{open:!1}}}const o=new r},45366:(e,t,n)=>{n.d(t,{wS:()=>o});var a=n(53965);const r=/[-./\\()"',;<>~!@#$%^&*|+=[\]{}`~?:\s]/u;function o(e){return(0,a.oA)(e.split(r))}}}]);