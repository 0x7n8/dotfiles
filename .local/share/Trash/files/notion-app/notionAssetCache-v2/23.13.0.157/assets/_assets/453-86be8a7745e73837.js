"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[453],{80453:(e,t,o)=>{o.r(t),o.d(t,{Comment:()=>pi,CommentFileBlock:()=>$o,Discussion:()=>Wi,DiscussionIndicator:()=>Ni.Z,DiscussionInput:()=>ci,DiscussionReactionBar:()=>gt,MarginCommentsSection:()=>Sn,NewDiscussionMenu:()=>Fn,ReactionBar:()=>ht,ReplyDiscussionMenu:()=>Zn,SuggestionContext:()=>Ei,discussionHelpers:()=>ue,discussionViewActions:()=>i,reactionActions:()=>Ye});var i={};o.r(i),o.d(i,{isCommentUnread:()=>Si});o(21703);var n=o(67294),s=o(1302),r=o(480),a=o(6740),l=o(97511),d=o(33125),c=o(86628),u=o(24405),m=o(68626),p=o(59194),g=o(69651),h=o(45238),f=o(85893);const x=(0,h.IU)("suggestBadge",{viewBox:"0 0 16 16",svg:(0,f.jsxs)("g",{children:[(0,f.jsx)("circle",{cx:"8",cy:"8",r:"7",fill:"#fff",fillOpacity:"1"}),(0,f.jsx)("circle",{cx:"8",cy:"8",r:"7",fill:"#2383E2",fillOpacity:"0.07"}),(0,f.jsx)("circle",{cx:"8",cy:"8",r:"7.5",fill:"#2383E2",fillOpacity:"0.14"}),(0,f.jsx)("path",{fill:"#2383E2",d:"M7.843 9.24l-.906.338c-.07.027-.139.013-.205-.044-.064-.057-.08-.128-.048-.212l.342-.9 3.134-3.13.814.813L7.843 9.24zm3.4-3.398l-.816-.817.359-.352a.617.617 0 01.362-.174.364.364 0 01.332.106l.14.14c.1.105.144.227.133.366a.596.596 0 01-.168.366l-.341.365zM4.142 7.88a3.6 3.6 0 01.236-1.316A3.075 3.075 0 016.12 4.8c.413-.168.87-.252 1.374-.252.333 0 .667.05 1.002.15.337.1.662.24.974.42l-.742.742a3.16 3.16 0 00-.65-.25 2.707 2.707 0 00-.69-.088 2.34 2.34 0 00-1.179.294 2.09 2.09 0 00-.807.817c-.193.348-.29.755-.29 1.22a3.474 3.474 0 00.478 1.753c.164.283.37.548.619.797.25.248.548.472.892.67.344.198.737.36 1.18.485a.856.856 0 01.33.178c.078.073.117.179.117.318 0 .13-.03.229-.092.297a.432.432 0 01-.243.133.884.884 0 01-.311.007 3.974 3.974 0 01-1.05-.331 5.303 5.303 0 01-1.059-.663 5.448 5.448 0 01-.93-.957 4.753 4.753 0 01-.66-1.217 4.204 4.204 0 01-.242-1.443zm7.69.94c0 .454-.097.855-.293 1.204a2.13 2.13 0 01-.82.816c-.352.196-.76.294-1.228.294-.287 0-.574-.038-.861-.116a3.662 3.662 0 01-.82-.332 3.07 3.07 0 01-.69-.522l1.042-.397c.175.146.373.262.594.349.221.086.446.13.674.13.266 0 .509-.06.728-.181.22-.121.396-.289.526-.503a1.42 1.42 0 00.195-.745c0-.212-.038-.43-.113-.656a3.227 3.227 0 00-.308-.674l.725-.735c.2.313.359.644.475.995.116.349.175.706.175 1.073z"})]})});var v=o(30548),b=o(72141),S=o(21202),y=o(70203),C=o(9291),w=o(52629),j=o(37810),k=o(54564),M=o(47307),L=o(61045),D=o(993),R=o(98104),I=o(13447),B=o(74136),F=o(26388),T=o(64369),Z=o(42402),_=o(67706),A=o(65085),V=o(12740),z=o(65187),E=o(11368),P=o(4708),K=o(49394),W=o(65598),U=o(16402),N=o(2275),H=o(89574),O=o(69475),G=o(61766),$=o(77080),X=o(96049),q=o(77144),Y=o(6258),J=o(17707),Q=o(95306);const ee=8,te=10,oe=8,ie=24,ne=6,se=1.5,re=(ie-se)/2,ae=ie+ne,le=`calc(100% + ${oe+(ee-ne)-ae}px)`,de=ie+8;function ce(e){return"margin_comments"===e?12:"comment_unfurl"===e?14:16}var ue=o(10417),me=o(82994),pe=(o(57658),o(15145)),ge=o(41432),he=o(37652),fe=o(13148),xe=o(56666),ve=o(27714),be=o(25651),Se=o(40350),ye=o(18101);const Ce=(0,h.IU)("resolve",{viewBox:"0 0 16 16",svg:(0,f.jsx)(f.Fragment,{children:(0,f.jsx)("path",{d:"M6.6123 14.2646C7.07715 14.2646 7.43945 14.0869 7.68555 13.7109L14.0566 3.96973C14.2344 3.69629 14.3096 3.44336 14.3096 3.2041C14.3096 2.56152 13.8311 2.09668 13.1748 2.09668C12.7236 2.09668 12.4434 2.26074 12.1699 2.69141L6.57812 11.5098L3.74121 7.98926C3.48828 7.68848 3.21484 7.55176 2.83203 7.55176C2.16895 7.55176 1.69043 8.02344 1.69043 8.66602C1.69043 8.95312 1.7793 9.20605 2.02539 9.48633L5.55273 13.7588C5.84668 14.1074 6.1748 14.2646 6.6123 14.2646Z"})})});var we=o(98519),je=o(37612),ke=o(19889),Me=o(53965),Le=o(1898),De=o(893),Re=o(52275),Ie=o(31945),Be=o(73063),Fe=o(78140),Te=o(32163),Ze=o(72495),_e=o(83182),Ae=o(95477),Ve=o(43250),ze=o(60709),Ee=o(18514),Pe=o(80444),Ke=o(1600),We=o(73935),Ue=o(70279),Ne=o(33709),He=o(31701),Oe=o(27153),Ge=o(23063),$e=o(64921),Xe=o(11059),qe=o(72187),Ye=o(21899),Je=o(28992),Qe=o(66957);var et=o(54368),tt=o(77420),ot=o(70301),it=o(45653),nt=o(83420);function st(e){let{authorStore:t,avatarSize:o,avatarStyle:i,placeholderStyle:n}=e;const s=(0,u.Fg)(),r=(0,c.VK)((()=>(0,nt.TL)(t)),[t]),a=(0,c.VK)((()=>$.default.checkGate("comments_density_image_handling")),[]),l=(0,u.yK)((e=>({placeholder:{width:o,height:o,background:e.lightDividerColor,borderRadius:o/2,flexShrink:0,...i}})),[o,i]);return r.asActor?r.table===ke.KJ?(0,f.jsx)(it.Z,{hasTooltip:!0,userValue:r.asActor,style:i,size:o,avatarShouldShowShadow:!a}):r.table===tt.cZ?(0,f.jsx)(ot.Z,{botValue:r,size:o,style:i}):r.table===et.y0?(0,f.jsx)("div",{style:a?l.placeholder:{...n,background:s.lightDividerColor}}):void(0,Le.t1)(r):(0,f.jsx)("div",{style:a?l.placeholder:{...n,background:s.lightDividerColor}})}function rt(e){let{reactionStores:t,initialIndex:o}=e;const[i,s]=n.useState(o),r=(0,C.useIntl)(),a=(0,c.VK)((()=>t.map((e=>e.getIcon()))),[t]),l=(0,c.VK)((()=>t[i].getActorStores().map((e=>({id:e.id,store:e,name:e.getDisplayName(r)}))).filter(Le.$K)),[t,i,r]);return(0,f.jsxs)(Fe.Z,{menuType:ze.og.ActionSheet,children:[(0,f.jsx)(Qe.Z,{tabStyle:{flex:1,justifyContent:"center",display:"flex",minWidth:60},tabs:a,selectedIndex:i,onChange:e=>s(e)}),l.map((e=>(0,f.jsx)(Je.Z,{title:e.name,dontShrinkIcon:!0,icon:(0,f.jsx)(st,{authorStore:e.store,avatarSize:20,avatarStyle:{width:20,height:20},placeholderStyle:{width:20,height:20}})},e.id)))]})}function at(e){const t=(0,r.Fy)(),o=(0,c.VK)((()=>Y.bh.getUserVisibleReactions(e.store)),[e.store]),i=(0,n.useRef)(null),s=function(e){const t=(0,r.O7)(),{onLongPress:o,hapticsEnabled:i=!0,timeout:s=300}=e,a=(0,n.useCallback)((()=>{var e,n,s;i&&(null!==(e=t.mobileNative)&&void 0!==e&&e.buzz?t.mobileNative.buzz():null===(n=(s=window.navigator).vibrate)||void 0===n||n.call(s,20)),o()}),[t.mobileNative,i,o]),l=(0,n.useRef)(),d=(0,n.useCallback)((()=>clearTimeout(l.current)),[]);return(0,n.useEffect)((()=>d),[d]),{onTouchStart:(0,n.useCallback)((()=>{clearTimeout(l.current),l.current=setTimeout(a,s)}),[s,a]),onTouchEnd:d,onTouchCancel:d}}({onLongPress:()=>{var e;return null===(e=i.current)||void 0===e?void 0:e.setOpen(!0)}});if(!t.isMobile)return(0,f.jsx)(f.Fragment,{children:e.children});const a=o.findIndex((t=>!e.reactionStore||t===e.reactionStore))??0;return(0,f.jsx)(Ie.ZP,{ref:i,renderOrigin:()=>(0,f.jsx)("div",{...s,children:e.children}),popupType:t.isTablet?Ie.Z4.Popup:Ie.Z4.SlideUp,render:()=>(0,f.jsx)(rt,{initialIndex:a,reactionStores:o})},e.store.id)}function lt(){const{isMobile:e}=(0,r.Fy)();return(0,u.yK)((t=>({reaction:{display:"flex",margin:"1px",padding:"1px 6px 1px 6px",justifyContent:"center",gap:"4px",border:`1px solid ${t.regularDividerColor}`,borderRadius:"100px",fontSize:14,lineHeight:"20px",fontVariantNumeric:"tabular-nums",background:t.whiteButtonBackground},count:{color:t.mediumTextColor,fontSize:e?j.Z.fontSize.UISmall.mobile:j.Z.fontSize.UISmall.desktop,lineHeight:"20px"},countReacted:{color:t.blueColor},reacted:{background:He.ZP.blueWithAlpha(.08),border:`1px solid ${t.filterPillBorder}`,fontWeight:500},reactedHover:{background:He.ZP.blueWithAlpha(.18)},emojiStyle:{color:"black",display:"inline-block"},reactionIcon:{width:15,height:20,marginTop:.5,marginLeft:.5,fill:t.mediumIconColor},dropShadow:{boxShadow:t.marginDiscussionSelectedShadow}})),[e])}function dt(e){let{store:t,disabled:o,onClick:i,dropShadow:n}=e;const s=(0,c.VK)((()=>t.getActors()),[t]),a=(0,c.VK)((()=>t.getIcon()),[t]),l=lt(),{currentUser:d}=(0,r.O7)();if(!s||!a)return null;if(0===s.length)return null;const u=s.some((e=>e.id===d.id)),m={...l.reaction,...u&&l.reacted,...n&&l.dropShadow},p={...l.count,...u&&l.countReacted};return(0,f.jsx)(F.ZP,{textWrap:!0,style:{maxWidth:350,width:"max-content"},placement:F.ug.Bottom,delayThreshold:300,renderTooltip:()=>(0,f.jsx)(ct,{store:t,icon:a}),render:e=>(0,f.jsxs)($e.Z,{disabled:o,style:m,hoveredStyle:u?l.reactedHover:void 0,onClick:i,...e,children:[(0,f.jsx)("span",{style:l.emojiStyle,children:(0,f.jsx)(Xe.Z,{size:14,char:a})}),(0,f.jsx)("span",{style:p,children:s.length})]})})}function ct(e){let{store:t,icon:o}=e;const i=(0,u.yK)((e=>({text:{color:e.mediumInvertedTextColor}})),[]),n=(0,C.useIntl)(),s=(0,c.VK)((()=>t.getActorStores()),[t]),r=(0,c.VK)((()=>s.map((e=>e.getDisplayName(n))).filter(Le.$K)),[s,n]);return r.length>5?(0,f.jsx)(C.FormattedMessage,{defaultMessage:"{additionalNames, plural, one {{names} and {additionalNames} other <medium>reacted with</medium> {icon}} other {{names} and {additionalNames} others <medium>reacted with</medium> {icon}}}",id:"ReactionBar.hoverTooltip.textAbbreviated",values:{additionalNames:r.length-5,names:r.slice(0,5).join(", "),medium:e=>(0,f.jsx)("span",{style:i.text,children:e}),icon:(0,f.jsx)(Xe.Z,{size:14,char:o})}}):(0,f.jsx)(C.FormattedMessage,{defaultMessage:"{numberOfNames, plural, one {{nameOrNames} <medium>reacted with</medium> {icon}} other {{nameOrNames} <medium>reacted with</medium> {icon}}}",id:"ReactionBar.hoverTooltip.text",values:{numberOfNames:r.length,nameOrNames:r.join(", "),medium:e=>(0,f.jsx)("span",{style:i.text,children:e}),icon:(0,f.jsx)(Xe.Z,{size:14,char:o})}})}function ut(e){const{store:t,discussionLocation:o,onEmojiSelection:i,disableDropShadow:s}=e,a=(0,r.O7)(),l=(0,n.useRef)(null),d=(0,r.Fy)(),c=(0,u.yK)((e=>({container:{padding:2,display:"flex",boxShadow:e.lightBoxShadow,backgroundColor:e.buttonGroupBackground,borderRadius:d.isMobile?3:4,...s&&{borderWidth:1,borderStyle:"solid",borderColor:d.isMobile?"transparent":e.stroke.regular,borderRadius:6,boxShadow:void 0}},addIcon:{width:15,fill:e.mediumIconColor},iconButton:{height:22,width:22,flex:"0 0 auto"}})),[d.isMobile,s]),m=(0,C.useIntl)();return(0,f.jsx)("div",{style:c.container,children:(0,f.jsx)(Be.Z,{hasBackground:!0,ariaLabel:m.formatMessage({defaultMessage:"Add reaction",id:"ReactionBar.newReaction.ariaLabel"}),showShadow:!1,icon:()=>(0,Se.V)(c.addIcon),style:c.iconButton,ref:l,onClick:()=>pt(a,m,t,null==l?void 0:l.current,o,i)})})}function mt(e){let{store:t,discussionLocation:o,onEmojiSelection:i}=e;const s=(0,r.O7)(),a=(0,n.useRef)(null),l=lt(),d=(0,C.useIntl)();return(0,f.jsx)($e.Z,{style:{...l.reaction,minWidth:"2em"},ref:a,onClick:()=>pt(s,d,t,null==a?void 0:a.current,o,i),children:(0,Se.V)(l.reactionIcon)})}function pt(e,t,o,i,n,s){const r=We.findDOMNode(i);if(!r)return;if(!(r instanceof Element))return;const a=r.getBoundingClientRect();Oe.$(e,{originGap:4,originRect:a,popupWidth:qe.FZ,popupHeight:qe.kX,isSmallWidth:!1,title:t.formatMessage({defaultMessage:"Reaction",id:"ReactionBar.emojiModalMenu.title"}),currentTab:"emoji",tabs:[{type:"emoji",title:(0,f.jsx)(C.FormattedMessage,{defaultMessage:"Emojis",id:"recordIcon.emojiTab.title"}),hideRandomButton:!0,onChange:(t,i)=>{s&&s(),I.createAndCommit({environment:e,userAction:"Comment.toggleReactionFromMenu",perform:s=>{Ye.toggleReaction({environment:e,transaction:s,store:o,icon:t,discussionLocation:n}),i&&i.keepVisible||Oe.Z()}})}}]})}function gt(e){const{parentStore:t,discussionLocation:o,onReact:i}=e,s=lt(),a=e=>{I.createAndCommit({userAction:"Discussion.handleResolve",environment:m,perform:e=>{J.DX({environment:m,discussionStore:t,transaction:e,discussionLocation:o})}}),k.Xv(),null==e||e.stopPropagation()},l=(0,c.VK)((()=>t.canComment()),[t]),d=(0,c.VK)((()=>t.canEdit()),[t]),m=(0,r.O7)(),p=(0,n.useRef)(null),g=(0,n.useRef)(null),h=(0,C.useIntl)(),[x,v]=(0,n.useState)(!1),b=x||e.focused,S=(0,c.VK)((()=>Y.bh.getUserVisibleReactions(t)),[t]),y=e=>()=>{e.isDefined()&&(null==i||i(),I.createAndCommit({environment:m,userAction:"Comment.toggleReaction",perform:i=>{const n=1===S.length&&1===e.getActors().length&&e.getActors()[0].id===m.currentUser.id;Ye.toggleReaction({environment:m,transaction:i,store:t,icon:e.getIcon(),discussionLocation:o}),n&&J.DX({environment:m,discussionStore:t,transaction:i,discussionLocation:o})}}))},w=()=>{pt(m,h,t,null==p?void 0:p.current,o,i)},j=(0,u.yK)((e=>({actionButtonStyle:{minWidth:"1.8em",height:"1.5em",borderRadius:".75em",justifyContent:"center",alignItems:"center",display:"flex"}})),[]);return(0,f.jsx)("div",{onMouseEnter:()=>v(!0),onMouseLeave:()=>v(!1),style:{gap:"4px",marginTop:"12px",transform:"scale(1.2)",transformOrigin:"left",display:"flex",flexWrap:"wrap"},children:S.map(((o,i)=>(0,f.jsxs)("div",{style:{display:"flex",flexDirection:"row",gap:2},children:[(0,f.jsx)(at,{reactionStore:o,store:t,children:(0,f.jsx)(dt,{dropShadow:e.focused,disabled:!l,store:o,onClick:y(o)})}),i===S.length-1&&(0,f.jsx)(Ge.Z,{isVisible:!0,animationStyle:{opacity:b?1:0,marginLeft:2},render:()=>(0,f.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[l&&(0,f.jsx)(at,{store:t,children:(0,f.jsx)($e.Z,{style:j.actionButtonStyle,ref:p,onClick:w,children:(0,Se.V)(s.reactionIcon)})}),d&&(0,f.jsx)($e.Z,{style:j.actionButtonStyle,ref:g,onClick:a,children:Ce(s.reactionIcon)})]})})]},o.id)))})}const ht=function(e){const{parentStore:t,discussionLocation:o,onClick:i,disableDropShadow:n}=e,s=(0,c.VK)((()=>t.canComment()),[t]),a=(0,c.VK)((()=>Y.bh.getUserVisibleReactions(t)),[t]),l=(0,r.O7)(),d=(0,c.VK)((()=>$.default.checkGate("comments_density_image_handling")),[]),u=(0,c.VK)((()=>$.default.checkGate("prevent_edits_trash")),[]),m=(0,c.VK)((()=>{if(t.table===Ue.x_){const e=t.getParentBlockStore();return Boolean(e&&e.pathIsDead())}if(t.table===Ne.qF){const e=t.getParentStore();return Boolean(e&&e.pathIsDead())}return!1}),[t]),p=s&&!(u&&m)&&a.length>0,g=s&&!(u&&m)&&0===a.length;return(0,f.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",gap:"4px",marginTop:"4px",marginBottom:"4px",...d?{marginTop:8,marginBottom:0}:{}},children:[a.map((e=>(0,f.jsx)(at,{reactionStore:e,store:t,children:(0,f.jsx)(dt,{disabled:!s||u&&m,store:e,onClick:()=>{e.isDefined()&&(i&&i(),I.createAndCommit({environment:l,userAction:"Comment.toggleReaction",perform:i=>{Ye.toggleReaction({environment:l,transaction:i,store:t,icon:e.getIcon(),discussionLocation:o})}}))}})},e.id))),p&&(0,f.jsx)(at,{store:t,children:(0,f.jsx)(mt,{store:t,discussionLocation:o,onEmojiSelection:i})}),g&&(0,f.jsx)(ut,{store:t,discussionLocation:o,onEmojiSelection:i,disableDropShadow:n})]})},ft=Ce,xt=fe.U,vt=(0,C.defineMessages)({addReaction:{id:"comment.actions.addReaction.label",defaultMessage:"Add reaction"},acceptButton:{id:"comment.actions.acceptButton.label",defaultMessage:"Accept"},rejectButton:{id:"comment.actions.rejectButton.label",defaultMessage:"Reject"},moreActions:{id:"comment.actions.moreActions.label",defaultMessage:"More actions"},reopenButton:{id:"comment.actions.reopenButton.label",defaultMessage:"Re-open"},resolveButton:{id:"comment.actions.resolveButton.label",defaultMessage:"Resolve"}});function bt(e){const{discussionLocation:t}=e,o=(0,C.useIntl)(),i=(0,r.O7)(),s=i.device,a=(0,n.useRef)(null),d=(0,l.l)(),u=(0,c.VK)((()=>Boolean(e.discussionStore.getResolved())),[e.discussionStore]),m=(0,c.VK)((()=>e.store.isDefined()),[e.store]),p=(0,c.VK)((()=>{var e;return null===(e=Pe.default.state.currentUserStore)||void 0===e?void 0:e.id}),[]),g=(0,c.VK)((()=>{const t=e.store.getCreatedById();return e.store.getCreatedByTable()===ke.KJ&&p===t}),[p,e.store]),h=(0,c.VK)((()=>{var e;const t=null===(e=Pe.default.state.currentSpaceStore)||void 0===e?void 0:e.getRole();return t&&b.zz(t)}),[]),x=(0,c.VK)((()=>e.blockStore.getRole()),[e.blockStore]),v=(0,c.VK)((()=>{var e;return null==d||null===(e=d.publicEditModeStore.state)||void 0===e?void 0:e.permission}),[null==d?void 0:d.publicEditModeStore]),S=(0,c.VK)((()=>"suggestion"===e.discussionStore.getType()),[e.discussionStore]),y=(0,c.VK)((()=>e.blockStore.pathIsDead()),[e.blockStore]),w=(0,c.VK)((()=>$.default.checkGate("prevent_edits_trash")),[]),j="comment_only"===x||"comment"===v;if(!m||!p)return null;const M=()=>{I.createAndCommit({userAction:"Comment.handleReopen",environment:i,perform:t=>{J.bh({environment:i,commentStore:e.store,discussionStore:e.discussionStore,transaction:t,discussionLocation:e.discussionLocation})}})},L=t=>{I.createAndCommit({userAction:"Comment.handleResolve",environment:i,perform:t=>{J.DX({environment:i,commentStore:e.store,discussionStore:e.discussionStore,transaction:t,discussionLocation:e.discussionLocation})}}),k.Xv(),null==t||t.stopPropagation()},D=()=>{I.createAndCommit({userAction:"Suggestion.handleAccept",environment:i,perform:t=>{Ke.Yo({action:"accept",environment:i,commentStore:e.store,discussionStore:e.discussionStore,transaction:t,discussionLocation:e.discussionLocation})}}),k.Xv()},R=()=>{I.createAndCommit({userAction:"Suggestion.handleReject",environment:i,perform:t=>{Ke.Yo({action:"reject",environment:i,commentStore:e.store,discussionStore:e.discussionStore,transaction:t,discussionLocation:e.discussionLocation})}}),k.Xv()},B=()=>{var t,o;const n=e.store.getParentStore();if(!n||null==n||!n.isDefined())return null;let s=n.getParentStore();if(null===(t=s)||void 0===t||!t.isDefined())return null;var r;s.getType()===ge.Ti.tableRow&&(s=null===(r=s)||void 0===r?void 0:r.getParentBlockStore());if(null===(o=s)||void 0===o||!o.isDefined())return null;const a=s.getModel().getRenderUrl({baseUrl:Ae.default.domainBaseUrl,getRecordModel:e.store.getRecordModel,discussionId:n.id,pageVisitSource:pe.tY.CopyLink});De.RD({environment:i,stringValue:a,copiedMessage:De.tq.copiedLinkToClipboard})};if(!i.currentUser.isLoggedIn())return null;const F=x&&b.rz(x)||w&&y;if(F)return null;const T=e.isFirstComment&&"comment_unfurl"!==t&&!s.isMobile&&!j&&!F,Z=[];!s.isMobile||j||F||(u?Z.push("reopen"):Z.push("resolve")),g&&Z.push("edit"),e.isFirstComment&&Z.push("copyLink"),(g||h)&&Z.push("delete");const _=Z.length>0;return _||T||e.canShowReactions?(0,f.jsx)(Ie.ZP,{ref:a,popupType:s.isMobile?Ie.Z4.SlideUp:Ie.Z4.Popup,buttonPopupStore:e.buttonPopupStore,placementToOrigin:Ie.pO.Right,stopClickPropagation:!0,renderOrigin:n=>(0,f.jsx)(Ct,{buttonConfig:{resolve:{visible:T&&!S,resolved:u,onResolve:L,onReopen:M},react:{visible:e.canShowReactions,onReact:()=>{var n;pt(i,o,e.store,(null===(n=a.current)||void 0===n?void 0:n.getAnchor())??null,t,e.handleReaction)}},accept:{visible:S,onAccept:D},reject:{visible:S,onReject:R},moreActions:{visible:_}},visible:e.visible,buttonPopupEvents:n,discussionLocation:e.discussionLocation,store:e.store}),render:t=>{let o;o=s.isMobile?{menuType:ze.og.ActionSheet}:{menuType:ze.og.Popup};const i=Z.map((t=>"reopen"===t?{key:"reopen",render:e=>(0,f.jsx)(Re.Z,{...e,icon:(0,he.V)({height:16,width:16}),title:(0,f.jsx)(C.FormattedMessage,{id:"comment.reopenDiscussion.button",defaultMessage:"Re-open discussion"})}),action:M}:"resolve"===t?{key:"resolve",render:e=>(0,f.jsx)(Re.Z,{...e,icon:(0,we.k)({height:16,width:16}),title:(0,f.jsx)(C.FormattedMessage,{id:"comment.resolveDiscussion.button",defaultMessage:"Resolve comments"})}),action:()=>L()}:"edit"===t?{key:"edit",render:e=>(0,f.jsx)(Re.Z,{...e,icon:(0,be.R)({height:16,width:16}),title:(0,f.jsx)(C.FormattedMessage,{id:"comment.editComment.button",defaultMessage:"Edit comment"})}),action:e.handleEditComment}:"delete"===t?{key:"delete",render:e=>(0,f.jsx)(Re.Z,{...e,icon:(0,je.y)({height:16,width:16}),title:(0,f.jsx)(C.FormattedMessage,{id:"comment.deleteComment.button",defaultMessage:"Delete comment"})}),action:e.handleDeleteComment}:"copyLink"===t?{key:"copyLink",render:e=>(0,f.jsx)(Re.Z,{...e,icon:(0,ve.N)({height:16,width:16}),title:(0,f.jsx)(C.FormattedMessage,{id:"comment.copyLinkToDiscussion.button",defaultMessage:"Copy link to discussion"})}),action:B}:void(0,Le.t1)(t)));return(0,f.jsx)("div",{className:Ve.G6g,children:(0,f.jsxs)(Fe.Z,{...o,children:[(0,f.jsx)(Te.Z,{type:Te.i.Vertical,initialFocus:void 0,onAccept:t.close,sections:Me.oA([i.length&&{key:0,render:e=>(0,f.jsx)(Ze.Z,{...e}),items:i}])}),!s.isMobile&&(0,f.jsx)(Ze.Z,{topBorder:!0,disableDesktopPadding:!1,children:(0,f.jsx)(_e.Z,{title:(0,f.jsx)(C.FormattedMessage,{defaultMessage:"Learn about comments",id:"comments.learn"}),href:(0,Ee.UY)("guides.comments"),analyticsFrom:"comments"})})]})})}}):null}function St(e){return"accept"in e}function yt(e){return"resolve"in e}function Ct(e){const{buttonPopupEvents:t,discussionLocation:o,buttonConfig:i}=e,n=(0,r.O7)().device,s=(0,C.useIntl)(),a=(0,c.VK)((()=>$.default.checkGate("comments_density_image_handling")),[]),l=(0,u.yK)((t=>({addIcon:{width:15,fill:t.mediumIconColor},container:{display:"flex",boxShadow:t.lightBoxShadow,position:"absolute",flexShrink:0,padding:"2px",backgroundColor:t.buttonGroupBackground,...n.isMobile?{borderRadius:4,marginTop:4,right:16}:{marginRight:"margin_comments"===o?0:8,marginTop:"updates_sidebar"===e.discussionLocation?6:0,right:"margin_comments"===o?12:16,top:"margin_comments"===o?6:0,opacity:e.visible?1:0,gap:1,borderRadius:4,transition:"opacity 100ms ease-out",zIndex:1},...a?{top:0,right:0}:{}}})),[n.isMobile,o,e.discussionLocation,e.visible,a]);return(0,f.jsxs)("div",{style:l.container,children:[i.react.visible&&(0,f.jsx)(F.ZP,{renderTooltip:()=>(0,f.jsx)(C.FormattedMessage,{...vt.addReaction}),render:e=>(0,f.jsx)(Be.Z,{ariaLabel:s.formatMessage(vt.addReaction),hasBackground:!1,showShadow:!1,icon:()=>(0,Se.V)(l.addIcon),onClick:i.react.onReact,style:{height:22,width:22,flex:"0 0 auto"},...e})}),yt(i)&&i.resolve.visible&&(0,f.jsx)(F.ZP,{renderTooltip:()=>(0,f.jsx)(C.FormattedMessage,{...i.resolve.resolved?vt.reopenButton:vt.resolveButton}),render:e=>(0,f.jsx)(Be.Z,{hasBackground:!1,showShadow:!1,icon:i.resolve.resolved?ye.b:Ce,onClick:i.resolve.resolved?i.resolve.onReopen:i.resolve.onResolve,style:{height:22,width:22,flex:"0 0 auto"},...e,ariaLabel:s.formatMessage(i.resolve.resolved?vt.reopenButton:vt.resolveButton)})}),St(i)&&i.accept.visible&&(0,f.jsx)(F.ZP,{renderTooltip:()=>(0,f.jsx)(C.FormattedMessage,{...vt.acceptButton}),render:e=>(0,f.jsx)(Be.Z,{hasBackground:!1,showShadow:!1,icon:ft,onClick:i.accept.onAccept,style:{height:22,width:22,flex:"0 0 auto"},ariaLabel:s.formatMessage(vt.acceptButton),...e})}),St(i)&&i.reject.visible&&(0,f.jsx)(F.ZP,{renderTooltip:()=>(0,f.jsx)(C.FormattedMessage,{...vt.rejectButton}),render:e=>(0,f.jsx)(Be.Z,{hasBackground:!1,showShadow:!1,icon:xt,onClick:i.reject.onReject,style:{height:22,width:22,flex:"0 0 auto"},ariaLabel:s.formatMessage(vt.rejectButton),...e})}),i.moreActions.visible&&(0,f.jsx)(F.ZP,{renderTooltip:()=>(0,f.jsx)(C.FormattedMessage,{...vt.moreActions}),render:e=>(0,f.jsx)(Be.Z,{...t,...e,hasBackground:!1,showShadow:!1,icon:xe.o,style:{height:22,width:22,flex:"0 0 auto"},ariaLabel:s.formatMessage(vt.moreActions)})})]})}var wt=o(95538),jt=o(31781),kt=o(53471),Mt=o(68785),Lt=o(27016),Dt=o(69721),Rt=o(79954),It=o(27411),Bt=o(31505),Ft=o(39301),Tt=o(53336),Zt=o(73744),_t=o(34859),At=o(45589);const Vt=.8,zt=(0,C.defineMessages)({scrollLeftButtonAriaLabel:{defaultMessage:"Scroll left",id:"FilmStrip.scrollLeftButtonAriaLabel"},scrollRightButtonAriaLabel:{defaultMessage:"Scroll right",id:"FilmStrip.scrollRightButtonAriaLabel"}});function Et(e){let{children:t,shouldShowGrayFog:o}=e;const i=(0,C.useIntl)(),s=(0,n.useRef)(null),r=(0,c.qz)(void 0,At.Z),{scrollLeft:a,scrollWidth:l,clientWidth:d}=(0,c.VK)((()=>r.state),[r]),m=(0,n.useCallback)((()=>{var e;null===(e=s.current)||void 0===e||e.getClientRect()}),[]);(0,n.useEffect)((()=>(Zt.lj(window,"resize",m),()=>{Zt.ZV(window,"resize",m)})),[m]),(0,n.useEffect)((()=>{m()}),[m]);const p=(0,n.useMemo)((()=>Math.floor(a)>0),[a]),g=(0,n.useMemo)((()=>Math.ceil(a+d)<l),[a,l,d]),h=(0,n.useCallback)((e=>{var t;e.stopPropagation(),null===(t=s.current)||void 0===t||t.scrollByOffset(0,-Vt*d,{animate:!0})}),[d]),x=(0,n.useCallback)((e=>{var t;e.stopPropagation(),null===(t=s.current)||void 0===t||t.scrollByOffset(0,Vt*d,{animate:!0})}),[d]),v=(0,u.yK)((e=>({scrollerWrapper:{display:"flex",position:"relative"},scroller:{overflow:"auto",display:"flex",gap:4,paddingTop:6,marginTop:-6,paddingRight:4},commonArrowStyles:{position:"absolute",borderRadius:12,width:24,height:24,background:e.tint.regular,top:12,boxShadow:"none"},iconHoveredStyle:{background:e.tint.regular},leftArrowStyle:{left:0},rightArrowStyle:{right:4},arrowIconStyle:{height:12,fill:e.icon.secondary},leftArrowContainer:{position:"absolute",height:"100%",width:30,background:`linear-gradient(to right, ${o?e.hoveredMarginDiscussionBackground:e.selectedMarginDiscussionBackground} 0px, ${e.contentBackgroundTransparent} 30px`},rightArrowContainer:{position:"absolute",height:"100%",width:30,right:0,background:`linear-gradient(to left, ${o?e.hoveredMarginDiscussionBackground:e.selectedMarginDiscussionBackground} 0px, ${e.contentBackgroundTransparent} 30px`}})),[o]);return(0,f.jsxs)("div",{style:v.scrollerWrapper,children:[(0,f.jsx)(Tt.Z,{ref:s,type:_t.Z.X,store:r,onScroll:m,style:v.scroller,zIndex:0,children:t}),p&&(0,f.jsx)("div",{style:v.leftArrowContainer,children:(0,f.jsx)(Be.Z,{icon:Bt.Y,hovered:!1,showShadow:!0,onClick:h,ariaLabel:i.formatMessage(zt.scrollLeftButtonAriaLabel),style:{...v.commonArrowStyles,...v.leftArrowStyle},iconStyle:v.arrowIconStyle,hoveredStyle:v.iconHoveredStyle})}),g&&(0,f.jsx)("div",{style:v.rightArrowContainer,children:(0,f.jsx)(Be.Z,{icon:Ft.n,hovered:!1,showShadow:!0,onClick:x,ariaLabel:i.formatMessage(zt.scrollRightButtonAriaLabel),style:{...v.commonArrowStyles,...v.rightArrowStyle},iconStyle:v.arrowIconStyle,hoveredStyle:v.iconHoveredStyle})})]})}const Pt=3;function Kt(e){let{stores:t,collapsed:o,shouldShowGrayFogInScroller:i}=e;return 0===t.length?null:t.length<=Pt?(0,f.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:4},children:t.map((e=>(0,f.jsx)(Dt.Z,{store:e,disabled:!1,commentProps:{shouldHideBlockActionMenu:o}},e.id)))}):(0,f.jsx)(Et,{shouldShowGrayFog:i,children:t.map((e=>(0,f.jsx)(Dt.Z,{store:e,disabled:!1,commentProps:{shouldHideBlockActionMenu:o}},e.id)))})}var Wt=o(42858);const Ut=3,Nt=4;function Ht(e){let{stores:t,embedBlockLocation:o,onRemoveContent:i}=e;if(0===t.length)return null;if(t.length<=Ut)return(0,f.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:4},children:t.map((e=>(0,f.jsx)(Ot,{store:e,embedBlockLocation:o,onRemoveContent:i,isLarge:!0},e.id)))});if(t.length<=Nt)return(0,f.jsx)("div",{style:{display:"flex",gap:4},children:t.map((e=>(0,f.jsx)(Ot,{store:e,embedBlockLocation:o,onRemoveContent:i,isLarge:!1},e.id)))});const n=t.slice(0,Nt-1),s=t[Nt-1],r=t.length-Nt+1,a=t.slice(Nt);return(0,f.jsxs)("div",{style:{display:"flex",gap:4},children:[n.map((e=>(0,f.jsx)(Ot,{store:e,embedBlockLocation:o,onRemoveContent:i,isLarge:!1},e.id))),(0,f.jsxs)("div",{children:[(0,f.jsx)($e.Z,{style:{position:"absolute",zIndex:1,width:48,height:48,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0, 0, 0, 0.4)",borderRadius:8,color:"white",fontWeight:j.Z.fontWeight.bold},hoveredStyle:{background:"rgba(0, 0, 0, 0.4)"},pressedStyle:{background:"rgba(0, 0, 0, 0.4)"},onClick:()=>{Wt.dK({blocks:[s]})},children:`+${r}`}),(0,f.jsx)(Ot,{store:s,embedBlockLocation:o,onRemoveContent:i,isLarge:!1},s.id)]}),(0,f.jsx)("div",{style:{display:"none"},children:a.map((e=>(0,f.jsx)(Ot,{store:e,embedBlockLocation:o,onRemoveContent:i,isLarge:!1},e.id)))})]})}function Ot(e){let{store:t,isLarge:o,embedBlockLocation:i,onRemoveContent:n}=e;const s=(0,u.yK)((e=>({imageShared:{border:`1px solid ${e.stroke.deemphasized}`,borderRadius:8,cursor:"zoom-in"}})),[]);return(0,f.jsx)(Lt.ZP,{store:t,blockLocation:i,disabled:!1,disableDrag:!0,disableResizers:!0,preserveScale:!0,inlineContentStyle:{...s.imageShared,...o?Gt:$t},disableActions:!o,onRemoveBlockFromComment:o?n:void 0},t.id)}const Gt={objectFit:"contain",width:"auto",height:"auto",maxWidth:240,maxHeight:240,minWidth:48,minHeight:48},$t={width:48,height:48,minWidth:48,minHeight:48};var Xt=o(32854);function qt(e){let{store:t}=e;const o=(0,c.VK)((()=>It.default.getKeyState(It.default.getBlockKey(t.id))),[t.id]),i=(0,C.useIntl)(),n=(0,u.yK)((e=>({wrapper:{height:48,width:214,display:"flex",alignItems:"center",background:"white",border:`1px solid ${e.regularDividerColor}`,borderRadius:12,padding:"8px 10px 8px 8px",gap:8},icon:{background:e.tint.regular,borderRadius:6,width:32,minWidth:32,height:32,display:"flex",alignItems:"center",justifyContent:"center"},fileDetails:{display:"flex",flexDirection:"column"},fileName:{fontSize:14,fontWeight:j.Z.fontWeight.medium,lineHeight:"18px",color:e.text.primary,textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"},fileSizeText:{color:e.text.secondary},progressText:{color:e.text.tertiary},sizeAndProgressContainer:{display:"flex",alignItems:"center",gap:4,fontSize:12,lineHeight:"15px"}})),[]);if(!o)return(0,f.jsxs)("div",{style:n.wrapper,children:[(0,f.jsx)("div",{style:n.icon,children:(0,f.jsx)(Mt.Z,{})}),(0,f.jsx)("div",{style:n.fileDetails,children:(0,f.jsx)("div",{style:n.fileName,children:i.formatMessage({id:"commentFilePlaceholder.loading",defaultMessage:"Loading..."})})})]});const{name:s,size:r,progressPercent:a}=o;return(0,f.jsxs)("div",{style:n.wrapper,children:[(0,f.jsx)("div",{style:n.icon,children:(0,f.jsx)(Mt.Z,{})}),(0,f.jsx)("div",{style:{overflow:"hidden"},children:(0,f.jsxs)("div",{style:n.fileDetails,children:[(0,f.jsx)("div",{style:n.fileName,children:s}),(0,f.jsxs)("div",{style:n.sizeAndProgressContainer,children:[(0,f.jsx)("span",{style:n.fileSizeText,children:(0,ue.formatFileSize)(r)}),(0,f.jsx)("span",{style:n.progressText,children:"—"}),(0,f.jsx)(Mt.Z,{}),(0,f.jsx)(Xt.Z,{percentage:a,style:n.progressText})]})]})})]})}var Yt=o(64275),Jt=o(54604),Qt=o(12981),eo=o(81865);function to(e){const{url:t,imageNaturalHeight:o,imageNaturalWidth:i}=e,s=(0,n.useMemo)((()=>({display:"block",width:`min(${i}px, 100%)`,height:`min(${o}px, 100%)`,pointerEvents:"auto",objectFit:"cover"})),[i,o]);return(0,f.jsx)("div",{style:oo,children:(0,f.jsx)(Qt.Z,{src:t,style:s,placeholderLoadedStyle:{display:"flex",justifyContent:"center",alignItems:"center"}})})}const oo={alignSelf:"center",margin:"0 auto",position:"relative",height:"100%",width:"100%",overflow:"hidden"};const io=function(e){let{file:t,isLarge:o}=e;const i=(0,n.useRef)(null),s=(0,r.O7)(),a=(0,c.VK)((()=>$.default.checkGate("comments_density_image_handling")),[]),l=(0,u.yK)((e=>{if(a){return{imageThumbnail:{...{border:`1px solid ${e.stroke.deemphasized}`,borderRadius:8,cursor:"zoom-in"},...o?{objectFit:"contain",width:"auto",height:"auto",maxWidth:240,maxHeight:240,minWidth:48,minHeight:48}:{width:48,height:48}}}}return{imageThumbnail:{borderRadius:4,border:`1px solid ${e.lightDividerColor}`,objectFit:"cover",height:48,width:48,cursor:"zoom-in"}}}),[a,o]),d=(0,n.useCallback)((()=>{var e;const o=null===(e=i.current)||void 0===e?void 0:e.getImageDimensions();if(!o)return;const{naturalHeight:n,naturalWidth:s}=o;return"local"===t.type?(0,f.jsx)(to,{url:t.dataURL,imageNaturalHeight:n,imageNaturalWidth:s}):(0,f.jsx)(eo.Z,{url:t.source,render:(e,t)=>(0,f.jsx)(to,{url:t,error:e,imageNaturalHeight:n,imageNaturalWidth:s}),isAuthenticated:!0,permissionRecord:t.store.pointer})}),[t]),m=(0,n.useCallback)((e=>{var t;e.stopPropagation();const o=null===(t=i.current)||void 0===t?void 0:t.getImageDimensions();o&&Jt.ui({environment:s,renderFullScreenNode:d,fullScreenNodeRect:o.clientRect,contentAspectRatio:o.naturalWidth/o.naturalHeight})}),[d,s]);return"local"===t.type?(0,f.jsx)(Qt.Z,{src:t.dataURL,style:l.imageThumbnail,placeholderStyle:l.imageThumbnail,onClick:m,ref:i}):(0,f.jsx)(eo.Z,{url:t.source,isAuthenticated:!0,permissionRecord:t.store.pointer,render:(e,t)=>(0,f.jsx)(Qt.Z,{src:t,style:l.imageThumbnail,placeholderStyle:l.imageThumbnail,onClick:m,ref:i})})};var no=o(40304),so=o(52455),ro=o(87292),ao=o(61646);const lo=(0,h.IU)("videoAttachment",{viewBox:"0 0 28 28",svg:(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("rect",{width:"28",height:"28",fill:"none"}),(0,f.jsx)("path",{d:"M14.1333 26.4668C21.103 26.4668 26.8667 20.7031 26.8667 13.7334C26.8667 6.75098 21.103 1 14.1206 1C7.15088 1 1.3999 6.75098 1.3999 13.7334C1.3999 20.7031 7.16357 26.4668 14.1333 26.4668ZM14.1333 24.8164C7.98877 24.8164 3.05029 19.8652 3.05029 13.7334C3.05029 7.58887 7.98877 2.6377 14.1206 2.6377C20.2651 2.6377 25.2163 7.58887 25.229 13.7334C25.229 19.8652 20.2778 24.8164 14.1333 24.8164ZM18.9702 14.3936C19.4653 14.1016 19.4526 13.4287 18.9702 13.1367L11.7212 8.79492C11.2261 8.49023 10.5786 8.73145 10.5786 9.27734V18.2275C10.5786 18.7734 11.188 19.0273 11.7212 18.71L18.9702 14.3936Z"})]})}),co={doc:{title:"DOC"},docx:{title:"DOCX"},xls:{title:"XLS"},xlsx:{title:"XLSX"},pdf:{title:"PDF"},video:{icon:lo}},uo={doc:{icon:no.w},docx:{icon:no.w},xls:{icon:ao.Y},xlsx:{icon:ao.Y},pdf:{icon:ro.B},video:{icon:lo}};function mo(e){const{file:t,type:o}=e,i=(0,c.VK)((()=>$.default.checkGate("comments_density_image_handling")),[]),n=(0,u.yK)((e=>{let t;switch(o){case"doc":case"docx":t=e.msDocDiscussionInputPreview;break;case"xls":case"xlsx":t=e.msExcelDiscussionInputPreview;break;case"pdf":t=e.pdfDiscussionInputPreview;break;default:t=e.sidebarSecondaryBackground}return i&&(t=e.tint.regular),{wrapper:{height:48,width:220,display:"flex",background:"transparent",borderRadius:5,overflow:"hidden",border:`1px solid ${e.regularDividerColor}`,...i?{width:216,borderRadius:12,padding:"8px 10px 8px 8px",gap:10}:{}},fileTypeArea:{background:t,height:48,width:48,display:"flex",justifyContent:"center",alignItems:"center",flexShrink:0,...i?{width:32,height:32,borderRadius:6}:{}},icon:{height:26,width:26,fill:e.regularIconColor,...i?{width:24,height:24}:{}},fileType:{fontSize:11,lineHeight:"16.8px",fontWeight:j.Z.fontWeight.semibold,color:e.regularInvertedTextColor},fileDescription:{padding:"6px 12px 6px 12px",display:"flex",flexDirection:"column",justifyContent:"center",overflow:"hidden",...i?{padding:0}:{}},fileTitle:{color:e.regularTextColor,textOverflow:"ellipsis",fontSize:14,lineHeight:"19.6px",whiteSpace:"nowrap",overflow:"hidden",width:"100%",paddingBottom:20,...i?{fontWeight:j.Z.fontWeight.medium,lineHeight:"18px",color:e.text.primary}:{}},fileSize:{color:e.lightTextColor,fontSize:12,lineHeight:"16.8px",width:"100%",...i?{lineHeight:"15px",color:e.text.secondary}:{}}}}),[o,i]),s=i?uo[o]:co[o],r=i?(0,ue.formatFileSize)(t.size):t.size;return(0,f.jsxs)("div",{style:n.wrapper,children:[(0,f.jsx)("div",{style:n.fileTypeArea,children:s?"title"in s?(0,f.jsx)("div",{style:n.fileType,children:s.title}):s.icon(n.icon):(0,so.X)(n.icon)}),(0,f.jsxs)("div",{style:n.fileDescription,children:[(0,f.jsx)("div",{style:n.fileTitle,children:t.name}),(0,f.jsx)("div",{style:n.fileSize,children:r})]})]})}const po={image:io,pdf:mo,doc:mo,xls:mo,embed:mo},go={"application/vnd.openxmlformats-officedocument.wordprocessingml.document":"docx","application/msword":"doc","application/vnd.ms-excel":"xls","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"xlsx",image:"image"};function ho(e){return"local"===e.type?function(e){const[t]=e.split("/");return go[e]||go[t]}(e.file.type)||(0,wt.Dz)({url:e.file.name,baseUrl:Ae.default.domainBaseUrl,publicDomainName:Ae.default.publicDomainName}):(0,wt.y_)(e.source,".doc")?"doc":(0,wt.y_)(e.source,".docx")?"docx":(0,wt.y_)(e.source,".xls")?"xls":(0,wt.y_)(e.source,".xlsx")?"xlsx":(0,wt.Dz)({url:e.source,baseUrl:Ae.default.domainBaseUrl,publicDomainName:Ae.default.publicDomainName})}function fo(e){let{file:t,onRemoveFile:o,disableRemove:i,isLarge:s}=e;const[a,l]=(0,n.useState)(!1),d=(0,c.VK)((()=>$.default.checkGate("comments_density_image_handling")),[]),u=(0,n.useCallback)((()=>null==o?void 0:o(t)),[t,o]),m=(0,r.O7)(),p=!i&&(a||m.device.isMobile);(0,n.useEffect)((()=>()=>{"local"===t.type&&t.dataURL&&URL.revokeObjectURL(t.dataURL)}),[t]);const g=ho(t),h=po[g]||mo;return(0,f.jsxs)($e.Z,{style:{...bo,...d?{width:"fit-content"}:{}},hoveredStyle:xo,pressedStyle:vo,onMouseEnter:()=>l(!0),onMouseLeave:()=>l(!1),children:[(0,f.jsx)(h,{file:t,type:g,isLarge:d?s:void 0}),p&&(0,f.jsx)(Be.Z,{icon:Yt.D,style:So,hasBackground:!0,isDarkIconColor:!0,hovered:!1,showShadow:!0,onClick:u})]})}const xo={background:"none"},vo={background:"none"},bo={display:"flex",alignItems:"center",justifyContent:"center",position:"relative",paddingRight:"10px",cursor:"pointer"},So={position:"absolute",top:"-5px",right:"6px",height:18,width:18,borderRadius:18,padding:4},yo=.8;function Co(e){const t=(0,n.useRef)(null),o=(0,c.VK)((()=>$.default.checkGate("comments_density_image_handling")),[]),i=(0,u.yK)((e=>({leftArrowStyle:{left:10,top:26,background:e.mediumIconColor,...ko},rightArrowStyle:{right:10,top:26,background:e.mediumIconColor,...ko},iconStyle:{height:6,fill:e.contentBackground},hoveredStyle:{background:e.regularIconColor}})),[]),[{scrollLeft:s,scrollWidth:r,clientWidth:a},,l]=(0,c.AF)(void 0,At.Z),d=(0,n.useCallback)((e=>{var o;e.stopPropagation(),null===(o=t.current)||void 0===o||o.scrollByOffset(0,-yo*a,{animate:!0})}),[a]),m=(0,n.useCallback)((e=>{var o;e.stopPropagation(),null===(o=t.current)||void 0===o||o.scrollByOffset(0,yo*a,{animate:!0})}),[a]),p=(0,n.useCallback)((()=>{var e;null===(e=t.current)||void 0===e||e.getClientRect()}),[]);(0,n.useEffect)((()=>(Zt.lj(window,"resize",p),()=>{Zt.ZV(window,"resize",p)})),[p]);const g=(0,n.useMemo)((()=>Math.floor(s)>0),[s]),h=(0,n.useMemo)((()=>Math.ceil(s+a)<r),[s,r,a]);if((0,n.useEffect)((()=>{p()}),[e.files,p]),0===e.files.length)return null;const x=e.files.filter((e=>"local"===e.type||Boolean(e.source)));return o&&x.length<=3?(0,f.jsx)("div",{style:{...jo,...o?{flexDirection:"column",gap:8}:{}},children:x.map((t=>(0,f.jsx)(fo,{file:t,onRemoveFile:e.onRemoveFile,disableRemove:e.disableRemove,isLarge:o},t.id)))}):(0,f.jsxs)("div",{style:jo,children:[(0,f.jsx)(Tt.Z,{style:{...wo,...o?{paddingTop:0}:{}},ref:t,type:_t.Z.X,onScroll:p,zIndex:0,store:l,children:x.map((t=>(0,f.jsx)(fo,{file:t,onRemoveFile:e.onRemoveFile,disableRemove:e.disableRemove},t.id)))}),g&&(0,f.jsx)(Be.Z,{icon:Bt.Y,hovered:!1,showShadow:!0,onClick:d,style:i.leftArrowStyle,iconStyle:i.iconStyle,hoveredStyle:i.hoveredStyle}),h&&(0,f.jsx)(Be.Z,{icon:Ft.n,hovered:!1,showShadow:!0,onClick:m,style:i.rightArrowStyle,iconStyle:i.iconStyle,hoveredStyle:i.hoveredStyle})]})}const wo={overflow:"scroll",display:"flex",alignItems:"flex-start",flexDirection:"row",paddingTop:10},jo={display:"flex",paddingRight:0,position:"relative"},ko={position:"absolute",borderRadius:4,width:16,height:16,opacity:1,flexShrink:0,boxShadow:"none"};function Mo(e){if("image"!==e.getType())return!1;const t=y.QaF(e.getPropertyValue("source"));return void 0!==t&&!(0,wt.y_)(t,".jfif")&&!(0,wt.y_)(t,".webp")}function Lo(e){let{stores:t}=e;return 0===t.length?null:(0,f.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:4},children:t.map((e=>(0,f.jsx)(qt,{store:e},e.id)))})}function Do(e){const t=e.discussionFormat===ue.DiscussionFormat.Sidebar?jt.vW.SidebarComment:jt.vW.PageComment,o=(0,c.VK)((()=>$.default.checkGate("comments_density_image_handling")),[]),{uploading:i,images:n,embeds:s,files:r}=(0,c.VK)((()=>{if(!o)return{uploading:[],images:[],embeds:[],files:[]};const[t,i]=Me.uK(e.contentStores,(e=>{const t=Boolean(It.default.getKeyState(It.default.getBlockKey(e.id))),o=Lt.ZP.getEmbedSourceFromBlockStore(e);return t||!o})),[n,s]=Me.uK(i,(e=>Mo(e))),[r,a]=Me.uK(s,(e=>"video"===e.getType()));return{uploading:t,images:n,embeds:r,files:a}}),[e.contentStores,o]),{filmStripFiles:a,embedBlockStores:l}=(0,c.VK)((()=>{if(o)return{filmStripFiles:[],embedBlockStores:[]};if(e.collapsed)return{filmStripFiles:kt.nQ(e.contentStores),embedBlockStores:[]};if(e.discussionFormat===ue.DiscussionFormat.Page&&e.contentStores.filter((e=>Mo(e))).length>1){const[t,o]=Me.uK(e.contentStores,(e=>Mo(e)));return{filmStripFiles:kt.nQ(t),embedBlockStores:o}}return{filmStripFiles:[],embedBlockStores:e.contentStores}}),[e.contentStores,e.collapsed,e.discussionFormat,o]);if(o)return 0===i.length&&0===n.length&&0===s.length&&0===r.length?null:(0,f.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:4,marginTop:8},children:[(0,f.jsx)(Lo,{stores:i}),(0,f.jsx)(Ht,{stores:n,embedBlockLocation:t,onRemoveContent:e.onRemoveContent}),s.length>0&&(0,f.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:4},children:s.map((o=>(0,f.jsx)(Lt.ZP,{store:o,blockLocation:t,disabled:!1,disableDrag:!0,disableResizers:!0,preserveScale:!0,inlineContentStyle:{},onRemoveBlockFromComment:e.onRemoveContent},o.id)))}),(0,f.jsx)(Kt,{stores:r,collapsed:e.collapsed,shouldShowGrayFogInScroller:e.discussionHovered&&(e.discussionFormat===ue.DiscussionFormat.Margin||e.discussionFormat===ue.DiscussionFormat.Sidebar)})]});const d=l.length>0&&l.map((i=>(0,f.jsx)(Rt.Z,{store:i,analyticsName:"comment_media",actionSectionGroupKey:"comment_media",canTriggerContextMenu:!0,style:{marginTop:8,...o?{marginTop:0}:{}},children:Lt.ZP.hasRendererForStore(i)?(0,f.jsx)(Lt.ZP,{disabled:!1,disableDrag:!0,store:i,disableResizers:!0,preserveScale:!0,inlineContentStyle:{height:"auto",width:"auto",maxHeight:240,maxWidth:"100%",cursor:"zoom-in"},blockLocation:t,iconSvg:()=>(0,f.jsx)(Mt.Z,{style:o?{}:{marginRight:10}}),onRemoveBlockFromComment:e.onRemoveContent,children:(0,f.jsx)(C.FormattedMessage,{defaultMessage:"Uploading file...",id:"comment.embeddedFile.uploadInProgressMessage"})}):(0,f.jsx)(Dt.Z,{disabled:!1,store:i})},i.id))),u=a.length>0&&(0,f.jsx)(Co,{files:a,disableRemove:!0});return(0,f.jsxs)(f.Fragment,{children:[u,d]})}function Ro(){const e=(0,c.VK)((()=>$.default.checkGate("comments_density_image_handling")),[]),t=(0,u.yK)((t=>({newBarLine:{height:"0px",borderBottom:`1px solid ${t.darkDividerColor}`,width:"100%",marginLeft:0},newBarWrapper:{color:t.mediumTextColor,textTransform:"uppercase",fontSize:10.5,letterSpacing:.5,fontWeight:j.Z.fontWeight.semibold,display:"flex",alignItems:"center",marginRight:16,marginLeft:16,marginTop:10,marginBottom:10,...e?{margin:"0px 0px 0px 0px",paddingTop:10,paddingBottom:10,paddingLeft:de}:{}},newBarText:{padding:"0 10px",whiteSpace:"nowrap"},threadLine:{position:"absolute",backgroundColor:t.stroke.deemphasized,width:se,height:"100%",borderRadius:2,left:re,top:-6}})),[e]);return e?(0,f.jsxs)("div",{style:{position:"relative"},children:[(0,f.jsx)("div",{style:t.threadLine}),(0,f.jsxs)("div",{style:t.newBarWrapper,children:[(0,f.jsx)("div",{style:t.newBarLine}),(0,f.jsx)("div",{style:t.newBarText,children:(0,f.jsx)(C.FormattedMessage,{id:"comment.newIndicator.label",defaultMessage:"New comments"})}),(0,f.jsx)("div",{style:t.newBarLine})]})]}):(0,f.jsxs)("div",{style:t.newBarWrapper,children:[(0,f.jsx)("div",{style:t.newBarLine}),(0,f.jsx)("div",{style:t.newBarText,children:(0,f.jsx)(C.FormattedMessage,{id:"comment.newIndicator.label",defaultMessage:"New comments"})}),(0,f.jsx)("div",{style:t.newBarLine})]})}var Io=o(15157),Bo=o(85344),Fo=o(67060),To=o(37601),Zo=o(3386),_o=o(28020),Ao=o(33929),Vo=o(68056),zo=o(24666);var Eo=o(91315),Po=o(22962),Ko=o(83065),Wo=o(61519),Uo=o(99768);const No=function(e){const t=(0,r.O7)(),{icon:o,onClick:i,tooltip:n}=e,s=(0,c.VK)((()=>$.default.checkGate("comments_density_image_handling")),[]);return(0,f.jsx)(Uo.Z,{capture:!0,render:e=>(0,f.jsx)(F.ZP,{renderTooltip:()=>n,render:r=>(0,f.jsx)(Be.Z,{ariaLabel:n,icon:o,iconStyle:{width:t.device.isMobile?20:16,height:t.device.isMobile?20:16},style:{marginLeft:t.device.isMobile?16:10,...s?{marginLeft:t.device.isMobile?16:0}:{}},onClick:i,...r,...e})})})};const Ho=function(e){const t=(0,C.useIntl)(),o=(0,r.O7)(),{device:i}=o,n=(0,c.VK)((()=>$.default.checkGate("comments_density_image_handling")),[]),s=(0,u.yK)((e=>({cancelIcon:{background:e.mediumIconColor,borderRadius:"50%",marginLeft:o.device.isMobile?16:12,pointerEvents:"auto",height:20,width:20,...n?{marginLeft:o.device.isMobile?4:0}:{}},cancelIconHovered:{background:e.lightIconColor}})),[o.device.isMobile,n]),{canSend:a,visible:l,onSend:d,onCancel:m,isEditing:g,animated:h,onMention:x,onAttach:v,inline:b}=e,S={opacity:l?1:0},y=()=>(0,f.jsx)(Uo.Z,{capture:!0,render:e=>(0,f.jsx)(Be.Z,{ariaLabel:t.formatMessage({id:"discussionInput.sendButton.ariaLabel",defaultMessage:"Send comment"}),icon:Ko._,onClick:d,isBlue:a,disabled:!a,iconStyle:{height:o.device.isMobile?26:24,width:o.device.isMobile?26:24},style:{marginLeft:o.device.isMobile?16:12,pointerEvents:"auto",height:20,width:20,...n?{marginLeft:o.device.isMobile?16:0,height:24,width:24}:{}},...e})}),w=()=>(0,f.jsx)(Uo.Z,{capture:!0,render:e=>(0,f.jsx)(Be.Z,{ariaLabel:t.formatMessage({id:"discussionInput.updateButton.ariaLabel",defaultMessage:"Update comment"}),icon:Eo.r,onClick:d,isBlue:a,disabled:!a,iconStyle:{height:o.device.isMobile?23:21,width:o.device.isMobile?23:21},style:{marginLeft:o.device.isMobile?16:12,pointerEvents:"auto",height:20,width:20,...n?{marginLeft:o.device.isMobile?16:2,height:24,width:24}:{}},...e})}),j=()=>(0,f.jsx)(Uo.Z,{capture:!0,render:e=>(0,f.jsx)(Be.Z,{ariaLabel:t.formatMessage({id:"discussionInput.cancelButton.ariaLabel",defaultMessage:"Cancel editing comment"}),icon:Yt.D,isDarkIconColor:!0,onClick:m,iconStyle:{fill:"white",height:o.device.isMobile?18:16,width:o.device.isMobile?18:16},style:s.cancelIcon,hoveredStyle:s.cancelIconHovered,...e})});return n?(0,f.jsx)(Ge.Z,{isVisible:!0,animationStyle:S,render:()=>(0,f.jsx)("div",{style:{display:"flex",flexDirection:"column-reverse",alignItems:"end",pointerEvents:l?void 0:"none",width:"min-content",...h&&S},children:(0,f.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:6},children:[(0,f.jsx)(No,{icon:p.s,onClick:v,tooltip:t.formatMessage({id:"discussionInput.uploadFile.button.tooltip",defaultMessage:"Attach file"})}),!i.isMobileBrowser&&(0,f.jsx)(No,{icon:Po.O,onClick:x,tooltip:t.formatMessage({id:"discussionInput.insertMention.button.tooltip",defaultMessage:"Mention a person, page, or date"})}),g&&(0,f.jsx)("div",{style:{height:14,marginRight:6},children:(0,f.jsx)(Wo.Z,{vertical:!0,size:1})}),g?j():null,g?w():y()]})})}):(0,f.jsx)(Ge.Z,{isVisible:!0,animationStyle:S,render:()=>(0,f.jsx)("div",{style:{display:"flex",...b?{flexDirection:"column-reverse",alignItems:"end",marginRight:8}:{flexDirection:"row",position:"absolute",bottom:7,right:12,alignItems:"center"},pointerEvents:l?void 0:"none",...h&&S},children:(0,f.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[(0,f.jsx)(No,{icon:p.s,onClick:v,tooltip:t.formatMessage({id:"discussionInput.uploadFile.button.tooltip",defaultMessage:"Attach file"})}),!i.isMobileBrowser&&(0,f.jsx)(No,{icon:Po.O,onClick:x,tooltip:t.formatMessage({id:"discussionInput.insertMention.button.tooltip",defaultMessage:"Mention a person, page, or date"})}),g&&(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("div",{style:{height:14,marginLeft:o.device.isMobile?10:8},children:(0,f.jsx)(Wo.Z,{vertical:!0,size:1})}),j()]}),g?w():y()]})})})},Oo=(0,C.defineMessages)({defaultPlaceholder:{defaultMessage:"Add a comment…",id:"discussionInput.defaultPlaceholder.addComment"},pasteFileIntoCommentNotAllowed:{id:"clipboardActions.pasteFileIntoCommentError.message",defaultMessage:"Sorry, you cannot paste files into a comment."},replyInputPlaceholder:{defaultMessage:"Reply...",id:"updateSidebar.placeholder.addComment"}});var Go=o(13966);function $o(e){let{title:t,source:o,size:i,file:s,store:r,onClick:a,showBlockActionMenuButton:l}=e;(0,n.useEffect)((()=>()=>{"local"===(null==s?void 0:s.type)&&null!=s&&s.dataURL&&URL.revokeObjectURL(s.dataURL)}),[s]);const d=(0,u.yK)((e=>({wrapper:{height:48,width:214,background:"white",border:`1px solid ${e.regularDividerColor}`,borderRadius:12,padding:"7px 10px 8px 8px",cursor:a?"pointer":"default"},wrapperHoveredStyle:{background:e.surface.wash},iconContainer:{height:32,width:32,minWidth:32,background:e.tint.regular,borderRadius:6,display:"flex",justifyContent:"center",alignItems:"center"},icon:{height:24,width:24,fill:e.regularIconColor},fileName:{fontSize:14,fontWeight:j.Z.fontWeight.medium,lineHeight:"18px",color:e.text.primary,textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"},fileSizeText:{fontSize:12,lineHeight:"15px",color:e.text.secondary},actionMenuHoveredStyle:{background:e.tint.regular}})),[a]),c=(0,ue.getIcon)(o);return(0,f.jsx)($e.Z,{style:d.wrapper,hoveredStyle:r?d.wrapperHoveredStyle:{background:"white"},pressedStyle:r?d.wrapperHoveredStyle:{background:"white"},onClick:a,children:(0,f.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[(0,f.jsx)("div",{style:d.iconContainer,children:c(d.icon)}),(0,f.jsx)("div",{style:{overflow:"hidden",flexGrow:1},children:(0,f.jsx)(F.ZP,{renderTooltip:()=>(0,f.jsx)("div",{children:t}),render:e=>(0,f.jsxs)("div",{style:{display:"flex",flexDirection:"column"},...e,children:[(0,f.jsx)("div",{style:d.fileName,children:t}),i&&(0,f.jsx)("span",{style:d.fileSizeText,children:(0,ue.formatFileSize)(i)})]})})}),r&&l&&(0,f.jsx)(Go.Z,{store:r,fadeIn:!1,actionSectionGroupKey:"comment_media",hideFilterActionsInput:!0,style:{borderRadius:50},hoveredStyle:d.actionMenuHoveredStyle,iconStyle:{width:12,height:12}})]})})}function Xo(e){let{children:t,handleRemoveFileClicked:o}=e;const[i,s]=(0,n.useState)(!1),a=(0,r.O7)(),l=(0,C.useIntl)(),d=i||a.device.isMobile;return(0,f.jsxs)($e.Z,{onMouseEnter:()=>s(!0),onMouseLeave:()=>s(!1),style:Yo,hoveredStyle:Jo,pressedStyle:Jo,children:[t,d&&(0,f.jsx)(Be.Z,{icon:Yt.D,style:qo,hasBackground:!0,isDarkIconColor:!0,hovered:!1,showShadow:!0,onClick:o,ariaLabel:l.formatMessage({id:"discussionInputAttachment.removeFileButton.label",defaultMessage:"Remove file"})})]})}const qo={position:"absolute",top:-4,right:-3,height:18,width:18,borderRadius:18},Yo={position:"relative",cursor:"pointer",width:"min-content",height:"min-content",background:"transparent"},Jo={background:"transparent"},Qo=3,ei=3;function ti(e){let{files:t,onRemoveFile:o}=e;const{images:i,nonImages:n}=(0,c.VK)((()=>{const[e,o]=Me.uK(t,(e=>function(e){if("local"===e.type){const t=e.file.type,[o]=t.split("/");if("image"===o)return!0}const t=(0,wt.Dz)({url:"local"===e.type?e.file.name:e.source,baseUrl:Ae.default.domainBaseUrl,publicDomainName:Ae.default.publicDomainName});return"image"===t}(e)));return{images:e,nonImages:o}}),[t]);return(0,f.jsxs)("div",{style:{width:"100%",display:"flex",flexDirection:"column",gap:4,marginTop:4},children:[(0,f.jsx)(oi,{files:i,onRemoveFile:o}),(0,f.jsx)(ii,{files:n,onRemoveFile:o})]})}function oi(e){let{files:t,onRemoveFile:o}=e;return 0===t.length?null:t.length<=Qo?(0,f.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:4},children:t.map((e=>(0,f.jsx)(Xo,{handleRemoveFileClicked:()=>o(e),children:(0,f.jsx)(io,{file:e,isLarge:!0})},e.id)))}):(0,f.jsx)(Et,{children:t.map((e=>(0,f.jsx)(Xo,{handleRemoveFileClicked:()=>o(e),children:(0,f.jsx)(io,{file:e,isLarge:!1})},e.id)))})}function ii(e){let{files:t,onRemoveFile:o}=e;if(0===t.length)return null;const i=t.map((e=>{const t=e.name??"",i="remote"===e.type?e.source:t,n=e.size??"";return(0,f.jsx)(Xo,{handleRemoveFileClicked:()=>o(e),children:(0,f.jsx)($o,{title:t,source:i,size:n,showBlockActionMenuButton:!1})},e.id)}));return t.length<=ei?(0,f.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:4},children:i}):(0,f.jsx)(Et,{children:i})}const ni=n.forwardRef((function(e,t){var o;const i=(0,r.O7)(),{device:l,currentUser:d}=i,[m,p,g]=(0,c.AF)(e.discussionInputStore),{textStore:h,files:x}=m,v=(0,c.VK)((()=>h.getValue()),[h]),[b,S]=(0,n.useState)(!1),[y,w]=(0,n.useState)(!1),j=(0,n.useRef)(null),{commentStore:k}=e,L=e.discussionFormat!==ue.DiscussionFormat.Page;(0,n.useImperativeHandle)(t,(()=>({uploadFiles:U})));const B=(0,c.VK)((()=>(0,_o.B7)(i)),[i]),F=(0,c.VK)((()=>$.default.checkGate("comments_density_image_handling")),[]),T=(0,n.useRef)(null===(o=e.blockStore)||void 0===o?void 0:o.clone()),Z=(0,c.VK)((()=>{const e=zo.default.state;return"editing"===e.mode&&(0,Vo.qS)(e.multiSelection)&&e.multiSelection.start.store===h}),[h]),_=(0,c.VK)((()=>({isEmpty:(0,ue.inputIsEmpty)(g),hasChanged:(0,ue.hasCommentChanged)(g,k),hasNewLineCharacter:g.hasNewLineCharacter()})),[g,k]),A=(0,c.VK)((()=>Z||!_.isEmpty),[_.isEmpty,Z]),V=(0,n.useCallback)((async()=>{const e=zo.default.state;"editing"===e.mode&&(0,Vo.qS)(e.multiSelection)&&e.multiSelection.start.store===h||(R.NX({store:h}),await s.default.afterNextFlush())}),[h]),E=e=>{const t=g.state;g.setState({...t,files:t.files.filter((t=>t.id!==e.id))})},P=async e=>{await U(e.files),Bo.Zq(i,{type:"paste"})},U=(0,n.useCallback)((async t=>{var o;if(await V(),x.length+t.length>10)return void M.showErrorMessage((0,f.jsx)(C.FormattedMessage,{id:"discussionInput.uploadFile.tooManyFilesErrorMessage",defaultMessage:"You cannot upload more than {maxFiles} files per comment.",values:{maxFiles:10}}));const i=t.map(kt.Xo);p({...m,files:[...x,...i]}),null===(o=e.onFileUploaded)||void 0===o||o.call(e)}),[V,x,p,m,e]),N=e.discussionFormat===ue.DiscussionFormat.Margin,H=e.discussionFormat===ue.DiscussionFormat.Sidebar,O=e.discussionFormat===ue.DiscussionFormat.Page;(0,n.useEffect)((()=>{e.commentStore&&function(e,t){const o=W.le(t),i=kt.nQ(o);e.setState({...e.state,files:i})}(g,e.commentStore)}),[g,e.commentStore]);const G=(0,n.useRef)(!1),X=(0,n.useCallback)((t=>{t?Io.Z.set({userId:d.id,key:di(e.parentStore.id,e.inReplyToDiscussionId),value:t??null}):Io.Z.remove({userId:d.id,key:di(e.parentStore.id,e.inReplyToDiscussionId)})}),[d.id,e.inReplyToDiscussionId,e.parentStore.id]);(0,n.useEffect)((()=>{e.shouldSaveUnsentComments&&G.current&&X(v),G.current=!0}),[e.shouldSaveUnsentComments,X,v]);const q=(0,n.useRef)(h);(0,n.useEffect)((()=>{if(e.shouldSaveUnsentComments){const t=Io.Z.get({userId:d.id,key:di(e.parentStore.id,e.inReplyToDiscussionId)});t&&I.createAndCommit({userAction:"DiscussionInput.willMount",environment:i,perform:e=>{D.sO({environment:i,editorMode:"default",store:q.current,value:t,transaction:e})}})}}),[i,d.id,e.inReplyToDiscussionId,e.parentStore.id,e.shouldSaveUnsentComments]);const Y=(0,n.useRef)(x);(0,n.useEffect)((()=>{Y.current=x}),[x]),(0,n.useEffect)((()=>()=>{Y.current&&Y.current.forEach((e=>{"local"===e.type&&e.dataURL&&URL.revokeObjectURL(e.dataURL)}))}),[]);const J=!e.isEditingExistingComment&&(e.discussionFormat===ue.DiscussionFormat.Page||e.discussionFormat===ue.DiscussionFormat.Menu),Q=!!F||!J,ee=()=>{var e;return null===(e=j.current)||void 0===e?void 0:e.focus()},te=x&&x.length>0,oe=!(e.discussionFormat===ue.DiscussionFormat.Menu&&e.inReplyToDiscussionId)&&(H||N&&!e.isNewComment),ne=void 0!==e.showCtaButtons?e.showCtaButtons:e.isEditingExistingComment||A||b,se=F?{}:{paddingBottom:Q&&ne?34:4},re=!e.isMobileSlideUpMenu,ae=(N||H)&&!e.isNewComment,le=(0,u.yK)((t=>({inputWrapper:{display:"flex",flexDirection:"column",alignItems:"bottom",minHeight:N?void 0:32,width:"100%",fontSize:14,paddingTop:N?1:4,paddingBottom:N?1:4,borderRadius:4,boxShadow:!e.isNewComment&&N?`0px 0px 0px 1px ${t.darkDividerColor}`:void 0,transition:"background 300ms ease",background:y&&!ne&&t.focusDiscussionInputBackground||ne&&!e.isEditingExistingComment&&(e.isNewComment&&N?t.selectedMarginDiscussionBackground:t.discussionInputActivatedBackground)||"inherit",cursor:ne?"text":"pointer",alignSelf:"center",position:"relative",...F?{boxShadow:void 0,flexDirection:"row",flexWrap:"wrap",justifyContent:"flex-end",background:"transparent",minHeight:void 0,alignItems:"center",rowGap:4,columnGap:6,padding:"3.5px 4px 3px 4px",margin:"-3.5px -4px 0 -4px"}:{}}})),[y,N,e.isEditingExistingComment,e.isNewComment,ne,F]),de=F?ie:H?23:20,ce={fontSize:14,marginTop:H?2:3,marginBottom:2,paddingLeft:O?4:6,paddingRight:10,maxHeight:l.isMobileNative?"50vh":"70vh",overflowY:"auto",overflowX:"hidden",WebkitOverflowScrolling:"touch",userSelect:"auto",WebkitUserSelect:"auto",...F?{lineHeight:"20px",padding:0,margin:0,overflow:"auto"}:{}},me=(0,c.VK)((()=>0===(h.getValue()||[]).length),[h]),pe=function(e){const{isEditing:t,onEditPreviousComment:o,textRef:i}=e;if(!t)return{};const n=e=>{"key"in e&&(e.metaKey||e.ctrlKey)&&i.current&&R.N_({store:i.current.props.store})},s=e=>{"key"in e&&(e.metaKey||e.ctrlKey)&&i.current&&R.NX({store:i.current.props.store})};return{onUp:o??n,onDown:s}}({isEditing:Z,shouldTrapCursorInInput:L,onEditPreviousComment:me?e.onEditPreviousComment:void 0,textRef:j}),ge=()=>{X(void 0),e.onSubmit()},he=()=>{if(!l.isMobile)return void ge();const e="editing"===zo.default.state.mode&&zo.default.state.multiSelection;e&&I.createAndCommit({userAction:"DiscussionInput.handleEnter",environment:i,perform:t=>{D.hJ({environment:i,editorMode:"default",string:"\n",multiSelection:e,disableMentions:!0,disableSlashCommands:!0,disableEmojiCommands:!0,transaction:t})}})},fe=(0,f.jsx)(Ho,{visible:ne,onAttach:async()=>{const{device:e}=i;e.isIOS&&e.isMobileNative&&!e.isTablet&&(R.ZH(i),await s.default.afterNextFlush());const t=await kt.y({multiple:!0});await U(t),Bo.Zq(i,{type:"file_picker"})},onMention:async()=>{await V(),Fo.lZ({environment:i,mentionTypes:{page:!0,heading:!0,createPage:!1,user:!0,inviteUserToWorkspace:!0,inviteUserToPage:!0,bot:!0,date:!0,reminder:!1,templateVariable:!1,group:!0}})},canSend:!_.isEmpty,onSend:ge,onCancel:e.onCancel,isEditing:e.isEditingExistingComment||!1,animated:N,inline:!!F||!Q});return(0,f.jsx)(Zo.Z,{debugName:"DiscussionInput",capture:Z,onCommandEnter:Me.yR,children:(0,f.jsx)(li,{enabled:!!T.current&&!!e.canDrop,store:T.current,onNativeDrop:async e=>{let{files:t}=e;await U(t),Bo.Zq(i,{type:"drop"})},children:(0,f.jsx)("div",{className:e.isEditingExistingComment?Ve.hzx:Ve.wFE,style:{...si,...e.containerStyle||{}},onFocus:e=>{const t=e.target;t instanceof HTMLElement&&(0,a.E)(t)&&S(!0)},onBlur:()=>S(!1),onMouseOver:()=>w(!0),onMouseOut:()=>w(!1),children:(0,f.jsxs)("div",{style:ri,children:[e.showAvatar&&(0,f.jsx)(it.Z,{userStore:B,size:de,avatarShouldShowShadow:!F,style:{...ai,...F?{marginTop:0,marginRight:8}:{}}}),(0,f.jsx)(Ge.Z,{isVisible:!0,animationStyle:se,render:()=>(0,f.jsxs)("div",{className:oe?Ve.Wh_:"",onClick:ee,style:{...le.inputWrapper,...N&&se},tabIndex:-1,children:[(0,f.jsxs)("div",{style:{flexGrow:1,display:"flex",...F?{minHeight:24,paddingTop:2,width:_.hasNewLineCharacter?"100%":""}:{}},children:[(0,f.jsx)(z.Z,{style:ce,store:h,parentStore:e.parentStore,disabled:!1,onEnter:he,onCommandEnter:ge,onPasteFiles:P,onEsc:e.onCancel,...pe,placeholder:Ao.default.formatMessage(ae?Oo.replyInputPlaceholder:Oo.defaultPlaceholder),ref:j,isDiscussionInput:!0,disableSlashCommands:!0,disableInsertText:!0,disableSelectAllBlocks:!0,disableSelectionDrag:!0,disableEmbedMenu:!0,disabledMentionTypes:{reminder:!0},disableMobileActionBar:!0,disableStyleAnnotations:l.isMobileBrowser,disableInsertedDeletedAnnotations:l.isMobileBrowser,pasteBehavior:"inline",inPageFind:K.B3.none}),!Q&&fe]}),te&&F&&(0,f.jsx)(ti,{files:x,onRemoveFile:E}),te&&!F&&(0,f.jsx)("div",{style:{paddingBottom:Q?8:0,paddingLeft:8,paddingRight:8},children:(0,f.jsx)(Co,{files:x,onRemoveFile:E})}),Q&&fe]})}),re&&(0,f.jsx)(To.Z,{show:Z,onDismiss:()=>R.ZH(i)})]})})})})})),si={display:"flex",flexDirection:"column",width:"100%",cursor:"pointer"},ri={display:"flex",alignItems:"center",flexGrow:1},ai={flexShrink:0,flexGrow:0,marginRight:6,alignSelf:"flex-start",marginTop:6};function li(e){const{enabled:t,children:o,store:i,onNativeDrop:n}=e;return t&&i?(0,f.jsx)(Rt.Z,{store:i,analyticsName:"discussion_input",canNativeDropOnto:!0,onNativeDrop:n,keepTextSelectionOnDrop:!0,shouldShowDropZone:!0,children:o}):(0,f.jsx)(f.Fragment,{children:o})}function di(e,t){return t?`UnsentDiscussion-${e}-${t}`:`UnsentDiscussion-${e}`}const ci=ni,ui=new v.ZP("Temporary",!1,"necessary");function mi(e){switch(e){case"margin_comments":return 0;case"updates_sidebar":return 35;case"comment_unfurl":return 29;default:return 32}}const pi=function(e){const{store:t,discussionContext:o,maxLines:i,discussionLocation:h,shouldShowThreadLine:v}=e,ne=(0,r.O7)(),pe=(0,C.useIntl)(),[ge,he]=(0,n.useState)(!1),[fe,xe]=(0,n.useState)(!1),[ve,be]=(0,n.useState)(!1),Se=(0,c.VK)((()=>$.default.checkGate("comments_density_image_handling")),[]),ye=mi(h),Ce=(0,c.VK)((()=>e.store.isDefined()?new me.Z(ne,e.store.getSpaceId()):void 0),[ne,e.store]),we=(0,c.VK)((()=>W.le(e.store).filter((e=>(0,Y.Vh)(e,{table:S.iU,id:e.id},"alive").getValue()))),[e.store]),je=(0,c.VK)((()=>e.discussionStore.getResolved()),[e.discussionStore]),ke=(0,c.VK)((()=>null==Ce?void 0:Ce.state.files),[Ce]),Me=(0,c.VK)((()=>null==Ce?void 0:Ce.state.textStore),[Ce]),Le=(0,n.useCallback)((e=>{const t=e.target;t instanceof HTMLElement&&(0,a.E)(t)&&xe(!0)}),[]),De=(0,n.useCallback)((()=>{xe(!1)}),[]),Re=(0,n.useCallback)((()=>{X.Z.state||be(!0)}),[]),Ie=(0,n.useCallback)((()=>{be(!1)}),[]),Be=(0,l.l)(),Fe=(0,c.qz)(void 0,G.Z),Te=(0,c.VK)((()=>Fe.state.open),[Fe]),Ze=(0,N.L2)(e.blockStore),_e=(0,c.VK)((()=>{const t=e.discussionStore.getComments();return Boolean(t&&t[0]===e.store.id)}),[e.discussionStore,e.store.id]),Ae=(0,c.VK)((()=>{var t;const o=e.blockStore.getRole(),i=_e&&"comment_unfurl"!==h,n=$.default.checkGate("prevent_edits_trash"),s=e.blockStore.pathIsDead(),r=o&&b.rz(o)||n&&s,{device:a}=ne,l="comment_only"===o||Be&&"comment"===(null===(t=Be.publicEditModeStore.state)||void 0===t?void 0:t.permission),d=i&&!a.isMobile&&!l&&!r;return ve||fe||e.hoveringDiscussion&&i||Te||a.isMobile||e.showResolveButtonByDefaultIfPossible&&d}),[e.blockStore,e.hoveringDiscussion,e.showResolveButtonByDefaultIfPossible,_e,h,ne,Be,ve,fe,Te]),Ve=(0,n.useContext)(E.Ue),ze=(0,c.VK)((()=>{const e=t.getCreatedByPointer();return e?{createdByPointer:e,lastEditedTime:t.getLastEditedTime(),createdTime:t.getCreatedTime(),text:t.getText(),reactions:Y.bh.getUserVisibleReactions(t)}:null}),[t]),Ee=(0,c.VK)((()=>{if(!ze)return null;const e=Y.t1.createChildStore(t,ze.createdByPointer);return{displayName:e.getDisplayName(pe),store:e}}),[ze,pe,t]),Pe=(0,c.VK)((()=>{if(!ze||!Ee)return;const e=t.id,o=Ee.store.id,i="getEmail"in Ee.store?Ee.store.getEmail():void 0;return i?{authorId:o,authorEmail:i,commentWasLoadedFromDisk:O.l.commentIds.has(e),authorWasLoadedFromDisk:O.l.userIds.has(o)}:void 0}),[t.id,Ee,ze]);(0,n.useEffect)((()=>{if(!Pe)return;const e=ui.get("v1commentAuthorMapping"),o=null==e?void 0:e[t.id],i=o?{authorId:o[0],authorEmail:o[1],commentWasLoadedFromDisk:o[2],authorWasLoadedFromDisk:o[3]}:void 0;if(i){const o=[...Pe.authorId!==i.authorId?["author-id"]:[],...Pe.authorEmail!==i.authorEmail?["author-email"]:[]];var n;if(o.length>0)m.log({from:"client/components/Comment.tsx",level:"warning",type:"CommentToAuthorLocalStorageMismatchV1",error:(0,w.Ui)(new Error("The user saw a comment whose author didn't match a previous session or render pass.")),data:{mismatches:o,wasm_sqlite_initialized:q.Z.state.metricData.state.wasm_sqlite_initialized,commentStoreId:t.id,commentVersion:null===(n=t.getModel())||void 0===n?void 0:n.getVersion(),commentCreatedByPointerIdAfter:null==ze?void 0:ze.createdByPointer.id,authorIdBefore:i.authorId,authorIdAfter:Pe.authorId,authorEmailBefore:i.authorEmail,authorEmailAfter:Pe.authorEmail,commentWasLoadedFromDiskBefore:i.commentWasLoadedFromDisk,commentWasLoadedFromDiskAfter:Pe.commentWasLoadedFromDisk,authorWasLoadedFromDiskBefore:i.authorWasLoadedFromDisk,authorWasLoadedFromDiskAfter:Pe.authorWasLoadedFromDisk}}),ui.set("v1commentAuthorMapping",{...e,[t.id]:[Pe.authorId,Pe.authorEmail,Pe.commentWasLoadedFromDisk,Pe.authorWasLoadedFromDisk]})}else ui.set("v1commentAuthorMapping",{...e,[t.id]:[Pe.authorId,Pe.authorEmail,Pe.commentWasLoadedFromDisk,Pe.authorWasLoadedFromDisk]})}),[Pe,null==ze?void 0:ze.createdByPointer.id,t]);const Ke=(0,c.VK)((()=>(0,P.En)()),[]),We=(0,n.useCallback)((()=>{I.createAndCommit({userAction:"Comment.deleteComment",environment:ne,perform:t=>{J.YF({environment:ne,commentStore:e.store,transaction:t,discussionLocation:h})},skipUpdatingEditedMetadata:!0})}),[ne,e.store,h]),Ue=(0,n.useCallback)((async()=>{await M.confirmUserAction({message:(0,f.jsx)(C.FormattedMessage,{defaultMessage:"Would you like to delete this comment?",id:"comment.confirmDialog.deleteComment.prompt"}),acceptLabel:(0,f.jsx)(C.FormattedMessage,{defaultMessage:"Delete",id:"comment.confirmDialog.deleteComment.deleteButton.label"})})&&(We(),k.Xv(),Q.Cd(ne))}),[We,ne]),Ne=(0,n.useCallback)((async t=>{const o=W.zP(e.store).getValue(),i=W.le(e.store).filter((e=>e.id!==t.id)),n=o&&o.length>0,s=0===i.length;!n&&s?(await Ue(),he(!1)):I.createAndCommit({userAction:"Comment.handleRemoveFileFromActions",environment:ne,perform:o=>{J.Zo({commentStore:e.store,fileBlocks:[t],transaction:o})}})}),[ne,Ue,e.store]),He=(0,n.useCallback)((()=>{qe.current&&L.bx({element:qe.current,scrollers:{verticalScroller:null==Ve?void 0:Ve.verticalScroller},vertical:{reveal:"closest"},horizontal:void 0,animate:!0})}),[Ve]),Oe=(0,n.useCallback)((async()=>{if(!Ce)return;const t=W.zP(e.store).getValue()||[],o=Ce.state.textStore;I.createAndCommit({userAction:"Comment.handleEditComment",environment:ne,perform:e=>{D.sO({environment:ne,editorMode:"default",store:o,value:t,transaction:e})}}),he(!0),await s.default.afterNextFlush(),await s.default.afterNextFlush(),R.NX({store:o})}),[Ce,ne,e.store]),Ge=(0,n.useCallback)((async()=>{if(!Ce)return!1;if(!(0,ue.hasCommentChanged)(Ce,e.store))return he(!1),!0;if(await M.confirmUserAction({message:(0,f.jsx)(C.FormattedMessage,{defaultMessage:"Do you want to discard this edit?",id:"comment.confirmDialog.discardEdit.prompt"}),acceptLabel:(0,f.jsx)(C.FormattedMessage,{defaultMessage:"Discard",id:"comment.confirmDialog.discardEdit.discardButton.label"})}))return he(!1),!0;return!1}),[Ce,e.store]),$e=(0,n.useCallback)((async()=>{const t=null==Me?void 0:Me.getValue();t&&t.length>0||ke&&ke.length>0?I.createAndCommit({userAction:"Comment.handleSubmitEdit",environment:ne,perform:o=>{J.DF({environment:ne,store:e.store,text:t||[],transaction:o,discussionLocation:h,files:ke||[]})}}):await Ue(),he(!1)}),[ke,Me,h,ne,Ue,e.store]),Xe=(0,n.useRef)(null),qe=(0,n.useRef)(null);(0,d.c)(H.Z,(()=>({edit:Oe,handleCancelEdit:Ge,getNode:()=>Xe.current,isEditing:()=>ge,discussionLocation:h,commentId:e.store.id})),[Oe,Ge,ge,h,e.store.id]);const Ye=Se?ie:ue.DiscussionLocationToAvatarSize[h],Je=null==ze?void 0:ze.text,Qe=void 0!==Je&&Je.length>0&&y.VrM(Je)>0,et=Qe&&(0,ue.isCommentAllEmojis)(Je),tt=function(e){let{discussionLocation:t,isAllEmojis:o,avatarSize:i,newCommentsDesignEnabled:n}=e;const s=mi(t);return(0,u.yK)((e=>({container:{flexGrow:"comment_unfurl"===t?1:void 0,...n?{paddingTop:"comment_unfurl"===t?te:ee,paddingRight:"margin_comments"===t?12:16,paddingBottom:oe,paddingLeft:ce(t)}:{}},comment:{position:"relative",fontSize:14,...n?{}:{display:"flex",alignItems:"flex-start"}},commentElementsBelowUserRow:n?{paddingLeft:de}:{},avatar:{marginRight:10,marginTop:"comment_unfurl"===t?16:2,...n?{marginTop:0,marginRight:8}:{},userSelect:"none",WebkitUserSelect:"none"},threadLine:n?{position:"absolute",backgroundColor:e.stroke.deemphasized,borderRadius:2,width:se,height:le,left:re,top:ae}:{},userRow:{display:"flex",flexDirection:"row",alignItems:"center",userSelect:"none",WebkitUserSelect:"none",...n?{}:{padding:"margin_comments"===t?"4px 16px 0px 12px":"comment_unfurl"===t?"6px 16px 0px 10px":"6px 16px 0px 18px",position:"relative",marginTop:"comment_unfurl"===t?-11:void 0}},placeholder:{height:8,width:81,borderRadius:4,background:e.lightDividerColor},unfurlMoreWrapper:{color:e.lightTextColor,fontWeight:"comment_unfurl"===t?j.Z.fontWeight.medium:void 0,...n?{display:"block",marginBottom:-1.5}:{}},attachIcon:{width:18,height:18,fill:e.mediumIconColor},text:{cursor:"comment_unfurl"!==t?"text":void 0,...o?{fontSize:32}:{},...n?{lineHeight:"20px",paddingTop:4}:{paddingLeft:s,marginLeft:"comment_unfurl"===t?8:void 0}},textWrapper:n?{}:{padding:"margin_comments"===t?"2px 16px 6px 42px":"0px 16px 3px 16px",marginTop:"comment_unfurl"===t?"-14px":void 0},reactionContainer:{marginLeft:"margin_comments"===t?41:50,marginRight:14,marginTop:4,marginBottom:4,...n?{margin:0}:{}},attachmentContainer:{display:"flex",alignItems:"center",...n?{}:{padding:"0px 16px 6px 54px",marginTop:-12}},timestamp:{margin:"0 6px",flexBasis:"comment_unfurl"!==t?140:void 0,whiteSpace:"normal",flexGrow:"updates_sidebar"===t||"comment_unfurl"===t?void 0:1,display:"inline",...n?{color:e.text.tertiary}:{}},commentAttachment:n?{}:{margin:"0px 16px 0px "+("margin_comments"===t?"40px":"50px")},commentAuthorPlaceholder:{marginRight:8,marginTop:"comment_unfurl"===t?14:2,height:i,width:i,borderRadius:20,flexShrink:0}})),[t,s,o,i,n])}({discussionLocation:h,isAllEmojis:et,avatarSize:Ye,newCommentsDesignEnabled:Se});if(!Ce)return null;if(!ze||!Ee)return null;const ot="comment_unfurl"!==h,it=!!Se&&v;let nt,rt;ze.lastEditedTime&&ze.lastEditedTime>ze.createdTime+100?(nt=(0,f.jsx)(C.FormattedMessage,{defaultMessage:"{lastEditedTime} (edited)",id:"comment.editedAtTime.label",values:{lastEditedTime:(0,U.IS)(ze.lastEditedTime,{useUltraCompactFormat:Se})}}),rt=(0,U.uy)(ze.lastEditedTime)):(nt=(0,U.IS)(ze.createdTime,{useUltraCompactFormat:Se}),rt=(0,U.uy)(ze.createdTime));const at=we.length>0&&(0,f.jsx)("div",{style:tt.commentAttachment,children:(0,f.jsx)(Do,{contentStores:we,onRemoveContent:Ne,discussionFormat:(0,ue.discussionLocationToDiscussionFormat)(h),collapsed:e.collapsed,discussionHovered:e.hoveringDiscussion})});return(0,f.jsxs)("div",{ref:Xe,onClick:e=>ge&&e.stopPropagation(),style:tt.container,children:[e.showNewBar&&(0,f.jsx)(Ro,{}),(0,f.jsxs)("div",{style:tt.comment,onFocus:Le,onBlur:De,onMouseMove:Re,onMouseLeave:Ie,children:[(0,f.jsxs)("div",{style:Se?{}:{flexGrow:1,minWidth:0},children:[(0,f.jsxs)("div",{style:tt.userRow,children:[e.isSuggestionComment?(0,f.jsxs)("div",{style:{position:"relative"},children:[(0,f.jsx)(st,{authorStore:null==Ee?void 0:Ee.store,avatarSize:Ye,avatarStyle:tt.avatar,placeholderStyle:tt.commentAuthorPlaceholder}),(0,f.jsx)("div",{style:{position:"absolute",right:4,bottom:-4},children:x({width:16,height:16})})]}):(0,f.jsx)(st,{authorStore:null==Ee?void 0:Ee.store,avatarSize:Ye,avatarStyle:tt.avatar,placeholderStyle:tt.commentAuthorPlaceholder}),(0,f.jsxs)("div",{style:{overflow:"hidden"},children:[(0,f.jsx)("span",{style:{fontWeight:Se?j.Z.fontWeight.medium:j.Z.fontWeight.semibold,whiteSpace:"normal"},children:Ke?(0,f.jsx)(F.ZP,{renderTooltip:()=>Ee&&Ee.store instanceof Y.U6?(0,f.jsx)(V.Z,{targetUserStore:Ee.store}):null,placement:F.ug.Top,alignment:F.v2.End,render:e=>(0,f.jsx)("span",{...e,children:Ee.displayName}),delayThreshold:600,allowHover:!0,closeDelay:1500,isLightBackground:!0}):Ee.displayName||(0,f.jsx)("span",{style:tt.placeholder})}),(0,f.jsx)(T.Z,{isSmall:!0,isSecondaryColor:!0,isMultiline:!0,style:tt.timestamp,children:(0,f.jsx)(_.Z,{text:nt,tooltipText:rt,icon:g.C})}),"comment_unfurl"===h&&je&&(0,f.jsx)("div",{style:{display:"inline-flex"},children:(0,f.jsx)(B.Z,{children:(0,f.jsx)(C.FormattedMessage,{id:"comment.unfurl.resolvedStatus",defaultMessage:"Resolved"})})})]})]}),it&&(0,f.jsx)("div",{style:tt.threadLine}),(0,f.jsxs)("div",{style:tt.commentElementsBelowUserRow,children:[Boolean(o)&&(0,f.jsx)("div",{style:Se?{}:{paddingLeft:ye+15,paddingRight:16},children:o}),ge&&(0,f.jsx)("div",{style:Se?{marginTop:4}:{marginTop:(0,ue.discussionLocationToDiscussionFormat)(h)===ue.DiscussionFormat.Margin?8:void 0},children:(0,f.jsx)(ci,{containerStyle:Se?{width:"calc(100% + 8px)"}:{padding:"margin_comments"===h?"0px 16px 0px 16px":"0px 10px 0px 45px"},showAvatar:!1,parentStore:e.store,blockStore:e.blockStore,onCancel:Ge,onSubmit:$e,discussionInputStore:Ce,isEditingExistingComment:!0,isMobileSlideUpMenu:!0,shouldSaveUnsentComments:!1,commentStore:e.store,discussionFormat:(0,ue.discussionLocationToDiscussionFormat)(h),canDrop:!0})}),Qe&&!ge&&(0,f.jsx)("div",{style:{...tt.textWrapper},children:(0,f.jsx)(A.Z,{onMore:"comment_unfurl"===h?void 0:()=>{},moreElement:(0,f.jsxs)(Z.Z,{disableUnderline:!0,style:tt.unfurlMoreWrapper,hoverColor:Se?"blue":void 0,children:["…"," ",(0,f.jsx)("span",{children:(0,f.jsx)(C.FormattedMessage,{id:"text.truncated.showMoreLabel",defaultMessage:"more"})})]}),maxLines:e.collapsed?i:void 0,children:(0,f.jsx)(z.Z,{style:tt.text,store:W.zP(e.store),disabled:!0,disabledMentionTypes:{date:!0},disableEquationInteraction:!0,inPageFind:K.B3.none})})}),ge||"comment_unfurl"===h?!Qe&&(0,f.jsxs)("div",{style:tt.attachmentContainer,children:[(0,f.jsx)("div",{style:{marginRight:5},children:(0,p.s)(tt.attachIcon)}),(0,f.jsx)(C.FormattedMessage,{defaultMessage:"{numberOfAttachments, plural, one {{numberOfAttachments} attachment} other {{numberOfAttachments} attachments}}",values:{numberOfAttachments:we.length},id:"comment.unfurl.attachments.title"})]}):at,(0,f.jsx)("div",{ref:qe,children:ot&&ze.reactions.length>0&&(0,f.jsx)("div",{style:tt.reactionContainer,children:(0,f.jsx)(ht,{parentStore:e.store,discussionLocation:h})})})]})]}),"comment_unfurl"!==h&&!ge&&!Ze&&(0,f.jsx)(bt,{store:e.store,discussionStore:e.discussionStore,blockStore:e.blockStore,discussionLocation:h,visible:Ae,isFirstComment:_e,buttonPopupStore:Fe,canShowReactions:ot,handleEditComment:Oe,handleDeleteComment:Ue,handleReaction:He})]})]})};var gi=o(93963),hi=o(50627),fi=o(46351),xi=o(95802),vi=o(21853),bi=o(56681);function Si(e){var t;let{discussionStore:o,commentStore:i}=e;if(!i.isDefined())return!1;const n=null===(t=Pe.default.state.currentUserStore)||void 0===t?void 0:t.id;const s=bi.Z.state.lastInteractionTimes[o.id];if(i.getCreatedById()===n)return!1;const r=function(){if(!o.isDefined()||!n)return 0;const{pageVisitStore:e}=Pe.default.state,{lastViewTime:t,lastExitTime:i}=e.state;return i||t}();if(void 0===r)return!1;const a=(0,ue.getAndSortCommentStoresByTime)(o).filter((e=>e.getCreatedById()===n)).reverse()[0],l=i.getCreatedTime();return!l||!(a&&l<a.getCreatedTime())&&(!(s&&l<s)&&l>r)}var yi=o(13991),Ci=o(99036),wi=o(25501),ji=o(59753),ki=o(2456);const Mi=new Set([ge.Ti.toggle,ge.Ti.bulletedList,ge.Ti.numberedList,ge.Ti.quote,ge.Ti.toDo,ge.Ti.code,ge.Ti.callout,ge.Ti.header,ge.Ti.subHeader,ge.Ti.subSubHeader,ge.Ti.tableRow]);function Li(e){const t=(0,u.Fg)(),o=(0,c.VK)((()=>{var t;return e.store.isDefined()?null===(t=e.store.getParentStore())||void 0===t?void 0:t.getValue():null}),[e.store]),i=(0,c.VK)((()=>e.blockStore.getSpaceId()),[e.blockStore]),n=(0,c.VK)((()=>{if(!e.store.isDefined())return;const t=e.store.getContext();if(!t)return;return y.VP_(t,(t=>!y.xw5(t)||y.h19(t)===e.store.id))}),[e.store]),s=(0,c.VK)((()=>$.default.checkGate("comments_density_image_handling")),[]),r=o=>{let{textValue:n,propertySchema:r,discussionParentValue:a}=o;const l=s?18:24,d=(0,f.jsx)("div",{style:{overflow:"hidden",lineHeight:`${l}px`,maxHeight:4*l},children:(0,f.jsx)(ki.KX,{value:{value:n,spaceId:i},propertySchema:r,labeled:!1,rootStore:e.blockStore,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableDateStyleAnnotations:!0})});if(!a)return d;const c=a.type;return c===ge.Ti.code?(0,f.jsx)(wi.Z,{title:(0,ki.SP)(a),theme:t,style:{marginTop:0,marginBottom:0},children:(0,f.jsx)("span",{style:{fontFamily:j.Z.getCompositeFontFamily(yi.SP).mono,fontSize:12,tabSize:2},children:d})}):(0,ki.pH)(c)?(0,f.jsx)(wi.Z,{title:(0,ki.pH)(c),theme:t,style:{marginTop:0,marginBottom:0},children:d}):d},a={display:"flex",alignItems:"flex-start",fontSize:14,marginTop:8,marginBottom:8,color:t.mediumTextColor,width:"100%",...s?{alignItems:void 0,marginTop:6,marginBottom:6,fontSize:13,color:t.text.secondary}:{}};function l(e){if(!n)return null;const t=Ci.Kc(Ao.default.getIntl()).title;return t?(0,f.jsx)("div",{style:a,children:(0,f.jsxs)("div",{style:{display:"flex",width:"100%"},children:[(0,f.jsx)(Di,{newCommentsDesignEnabled:s}),r({textValue:n,discussionParentValue:e,propertySchema:t})]})}):null}if("updates_sidebar"===e.discussionLocation){if(!o)return null;if("text"!==o.type)return(0,f.jsx)("div",{onClick:e.onClick,style:{display:"flex",cursor:ji.kk.fromBlock(o).isType(ge.Zi)?"text":void 0},children:n&&Mi.has(o.type)?l(o):(0,f.jsxs)("div",{style:s?a:{display:"flex",marginTop:8,marginBottom:8,width:"100%"},children:[(0,f.jsx)(Di,{newCommentsDesignEnabled:s}),(0,f.jsx)(ki.ZP,{blockValue:o,rootStore:e.blockStore,blockPreviewLocation:"comments_sidebar"})]})})}return(0,f.jsx)("div",{onClick:e.onClick,style:{cursor:"text"},children:l()})}function Di(e){let{newCommentsDesignEnabled:t}=e;return(0,f.jsx)("div",{style:t?{width:2,marginLeft:1,borderRadius:4,marginRight:8,background:He.DB,flexShrink:0}:{width:3,borderRadius:4,marginLeft:2,marginRight:8,background:He.DB,flexShrink:0,paddingBottom:2}})}var Ri=o(7189),Ii=o(73819);const Bi={margin_comments:"8px 12px 6px",page_discussion:"8px 0px 0px",block_menu:"8px 16px 0px",reply_menu_mentions_comments:"8px 16px 0px",updates_sidebar:"4px 16px 12px"},Fi=n.forwardRef((function(e,t){const o=(0,r.O7)(),{format:i,role:n,showMoreCommentsButton:s,onMoreCommentsClick:a,inputVisible:l,blockStore:d}=e,m=(0,Ii.cR)(d),p=(0,c.VK)((()=>$.default.checkGate("prevent_edits_trash")),[]),g=n&&b.rz(n)||p&&m,h=o.currentUser.isLoggedIn(),{device:x,WindowSizeStore:v}=o,S=(0,u.Fg)(),y=(0,c.VK)((()=>$.default.checkGate("comments_density_image_handling")),[]),w=(0,c.VK)((()=>({paddingLeft:x.isMobile&&v.getSafePaddingLeftCSS(18)||i===ue.DiscussionFormat.Margin&&9||13,paddingRight:x.isMobile&&v.getSafePaddingLeftCSS(14)||i===ue.DiscussionFormat.Margin&&12||16})),[v,x.isMobile,i]),j=(0,u.yK)((t=>({container:{paddingTop:e.collapsed?1:4,paddingLeft:w.paddingLeft,paddingRight:w.paddingRight,paddingBottom:(x.isMobile&&i!==ue.DiscussionFormat.Page?8:i===ue.DiscussionFormat.Sidebar&&14)||0,position:"relative",...y?{padding:0,...i===ue.DiscussionFormat.Page?{marginLeft:16,marginRight:16}:{}}:{}},moreCommentsWrapper:{position:"absolute",display:"flex",justifyContent:"center",alignItems:"flex-start",zIndex:1,left:0,right:0,marginTop:-32,height:30,background:`linear-gradient(to bottom, ${t.contentBackgroundTransparent} 0px, ${t.selectedMarginDiscussionBackground} 30px`,...y?{marginTop:-28}:{}},tooltip:{...(0,F.JS)(t,!1),cursor:"pointer",display:"flex",justifyContent:"center",alignItems:"center",...y?{marginTop:-4,borderRadius:6,padding:"4px 10px 4px 8px"}:{}}})),[w,x.isMobile,i,e.collapsed,y]);return(0,f.jsx)(f.Fragment,{children:h&&!g&&(s||l)&&(0,f.jsxs)("div",{style:j.container,children:[s&&(0,f.jsx)("div",{style:j.moreCommentsWrapper,children:(0,f.jsxs)("div",{style:j.tooltip,onClick:a,children:[(0,f.jsx)("div",{style:{marginRight:5},children:(0,Ri.K)({fill:S.regularInvertedTextColor,height:12,width:12})}),(0,f.jsx)(C.FormattedMessage,{defaultMessage:"See more",id:"discussion.moreMessageTooltip"})]})}),l&&(0,f.jsx)(ci,{showAvatar:!!y||"margin_comments"!==e.discussionLocation,containerStyle:y?{padding:Bi[e.discussionLocation]}:{...x.isMobile?{}:{paddingLeft:5,paddingRight:2}},parentStore:e.store,onCancel:e.onCancel,onSubmit:e.onSubmit,discussionInputStore:e.discussionInputStore,isMobileSlideUpMenu:!1,shouldSaveUnsentComments:!0,onEditPreviousComment:e.onEditPreviousComment,inReplyToDiscussionId:e.store.id,discussionFormat:e.format,showCtaButtons:e.showCtaButtons,ref:t,onFileUploaded:e.onFileUploaded})]})})}));var Ti=o(62385);function Zi(e){const t=(0,c.VK)((()=>$.default.checkGate("comments_density_image_handling")),[]),o=(0,u.yK)((o=>{const i=ce(e.discussionLocation)+ie;return{newBarLine:{height:"0px",borderBottom:`1px solid ${o.darkDividerColor}`,marginLeft:0,flex:1},moreCommentsWrapper:{color:o.lightTextColor,fontSize:14,paddingLeft:e.insetButton?38:25,flexGrow:1,display:"flex",alignItems:"center",...t?{paddingLeft:8}:{}},button:{padding:"12px 12px",margin:"1px 4px",borderRadius:4,fontSize:14,color:o.mediumTextColor,width:"calc(100% - 8px)",justifyContent:"space-between",...t?{padding:"14px 0",margin:`0 0 0 ${i}px`,width:`calc(100% - ${i}px - 16px)`}:{}},buttonHovered:{background:o.focusDiscussionInputBackground},threadLine:{position:"absolute",backgroundColor:o.stroke.deemphasized,width:se,height:"100%",top:ee-ne,left:ce(e.discussionLocation)+re,borderRadius:2}}}),[e.insetButton,e.discussionLocation,t]);return e.count<=0?null:(0,f.jsxs)("div",{style:t?{position:"relative"}:{},children:[t&&(0,f.jsx)("div",{style:o.threadLine}),(0,f.jsx)(Ti.Z,{style:o.button,onClick:e.onClick,hoveredStyle:o.buttonHovered,children:(0,f.jsx)("div",{style:o.moreCommentsWrapper,children:(0,f.jsx)(C.FormattedMessage,{defaultMessage:"Show {moreCommentsNumber, plural, one {{moreCommentsNumber} reply} other {{moreCommentsNumber} replies}}",id:"discussion.showMoreCommentsSidebarButton.label",values:{moreCommentsNumber:e.count}})})},"show")]})}var _i=o(14200);const Ai=(0,C.defineMessages)({addLabel:{id:"suggestionContext.label.add",defaultMessage:"Add"},removeLabel:{id:"suggestionContext.label.remove",defaultMessage:"Delete"},labelForReplaceOldText:{id:"suggestionContext.label.replaceOld",defaultMessage:"Replace"},labelForReplaceNewText:{id:"suggestionContext.label.replaceNew",defaultMessage:"with"},boldLabel:{id:"suggestionContext.label.bold",defaultMessage:"Bold"},unboldLabel:{id:"suggestionContext.label.unbold",defaultMessage:"Unbold"},italicLabel:{id:"suggestionContext.label.italic",defaultMessage:"Italicize"},unitalicLabel:{id:"suggestionContext.label.unitalic",defaultMessage:"Unitalicize"},strikeLabel:{id:"suggestionContext.label.strike",defaultMessage:"Strike through"},unstrikeLabel:{id:"suggestionContext.label.unstrike",defaultMessage:"Remove strike through"},underlineLabel:{id:"suggestionContext.label.underline",defaultMessage:"Underline"},removeUnderlineLabel:{id:"suggestionContext.label.remove underline",defaultMessage:"Remove underline"},codeStyleLabel:{id:"suggestionContext.label.codeStyle",defaultMessage:"Mark as code"},removeCodeStyleLabel:{id:"suggestionContext.label.remove codeStyle",defaultMessage:"Remove code style"},addLinkLabel:{id:"suggestionContext.label.addLink",defaultMessage:"Add link"},removeLinkLabel:{id:"suggestionContext.label.removeLink",defaultMessage:"Remove link"},highlightLabel:{id:"suggestionContext.label.highlight",defaultMessage:"Highlight"},removeHighlightLabel:{id:"suggestionContext.label.removeHighlight",defaultMessage:"Remove highlight"},undefinedOpLabel:{id:"suggestionContext.label.undefinedOp",defaultMessage:"Undefined operation"}}),Vi={[y.GKr.Bold]:[Ai.boldLabel,Ai.unboldLabel],[y.GKr.Italic]:[Ai.italicLabel,Ai.unitalicLabel],[y.GKr.Strike]:[Ai.strikeLabel,Ai.unstrikeLabel],[y.GKr.Underline]:[Ai.underlineLabel,Ai.removeUnderlineLabel],[y.GKr.Code]:[Ai.codeStyleLabel,Ai.removeCodeStyleLabel],[y.GKr.Link]:[Ai.addLinkLabel,Ai.removeLinkLabel],[y.GKr.Highlight]:[Ai.highlightLabel,Ai.removeHighlightLabel]};function zi(e){const{annotation:t,isReplace:o}=e,i=Ai.undefinedOpLabel;if(y.pGj(t))return o?Ai.labelForReplaceNewText:Ai.addLabel;if(y.$b8(t))return o?Ai.labelForReplaceOldText:Ai.removeLabel;if(y.u2m(t)||y.Jeu(t)){const e=y.EpE(t);return y.u2m(t)?Vi[y.J7s(e)][0]??i:Vi[y.J7s(e)][1]??i}(0,Le.t1)(t)}function Ei(e){const{discussionStore:t}=e,o=(0,C.useIntl)(),i=(0,c.VK)((()=>t.isSuggestionDiscussion()),[t]),n=(0,c.VK)((()=>{const t=e.discussionStore.getContext();if(!t)return[];const o=t.flatMap((e=>(0,y.hDy)(e))).filter((t=>y.BIG(t)&&y.fgJ(t)===e.discussionStore.id));if(0===o.length)return[];const i=[];for(const e of o){const n=o.length>1,s=zi({annotation:e,isReplace:n}),r=y.$b8(e);let a=t;if(y.u2m(e)||y.Jeu(e)){const t=y.EpE(e);if(y.j0F(t)){a=[[y.zW$(t)]]}}n&&(y.pGj(e)?a=t.filter((e=>(0,y.hDy)(e).some((e=>y.pGj(e))))):y.$b8(e)&&(a=t.filter((e=>(0,y.hDy)(e).some((e=>y.$b8(e))))))),i.push({label:s,value:a,shouldUseDeleteColor:r})}return i}),[e.discussionStore]),s=(0,c.VK)((()=>e.blockStore.getSpaceId()),[e.blockStore]),r=(0,u.yK)((e=>({container:{marginTop:2},label:{color:e.text.uiBlueSecondary,fontSize:14,lineHeight:"18px"},labelDeleteColor:{color:e.text.tertiary},text:{color:e.text.uiBluePrimary,fontSize:14,lineHeight:"18px"},textDeleteColor:{color:e.text.secondary},suggestionContextItem:{display:"block",marginBottom:4}})),[]),a=Ci.Kc(o).title;return i&&a&&0!==n.length?(0,f.jsx)("div",{style:r.container,children:(0,f.jsx)(A.Z,{maxLines:e.collapsed?1:void 0,children:n.map(((t,i)=>{let{label:n,value:l,shouldUseDeleteColor:d}=t;return(0,f.jsxs)("div",{style:r.suggestionContextItem,children:[(0,f.jsxs)("span",{style:{...r.label,...d&&r.labelDeleteColor},children:[o.formatMessage(n),": "]}),(0,f.jsxs)("span",{style:{...r.text,...d&&r.textDeleteColor},children:["“",(0,f.jsx)(_i.Z,{value:{value:l,spaceId:s},propertySchema:a,rootStore:e.blockStore,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableDateStyleAnnotations:!0}),"”"]})]},i)}))})}):null}const Pi=2,Ki=5;function Wi(e){const t=(0,n.useRef)(null),o=(0,r.O7)(),i=(0,c.VK)((()=>$.default.checkGate("comments_density_image_handling")),[]),a=(0,c.VK)((()=>"suggestion"===e.store.getType()),[e.store]),l=(0,c.VK)((()=>W.D4(e.store)),[e.store]),m=(0,c.VK)((()=>l.filter((e=>e.isDefined()))),[l]),p=(0,n.useRef)(e.discussionInputStore||new me.Z(o,e.store.pointer.spaceId)).current,g=(0,c.VK)((()=>(0,ue.inputIsEmpty)(p)),[p]),h=(0,c.VK)((()=>(0,hi.Wt)(e.blockStore)),[e.blockStore]),x=(0,c.VK)((()=>e.store.getResolved()),[e.store]),[v,b]=(0,n.useState)(!1),[S,w]=(0,n.useState)(!1),[j,k]=(0,n.useState)(!0),D=(0,c.qz)(void 0,At.Z),B=(0,c.VK)((()=>D.state.clientRect),[D]),F=e.format===ue.DiscussionFormat.Sidebar,T=e.format===ue.DiscussionFormat.Margin,Z=(0,n.useRef)(null);(0,d.c)(fi.Z,(()=>({isSidebarFormat:()=>F,isMarginFormat:()=>T,getStore:()=>e.store,getInputStore:()=>p,getNode:()=>Z.current})),[F,T,e.store,p]);const _=(0,c.VK)((()=>{if(!F)return;return(0,ue.getAndSortCommentStoresByTime)(e.store).find((t=>Si({discussionStore:e.store,commentStore:t})))}),[F,e.store]),A=(0,n.useRef)(_),V=void 0===A.current?_:A.current,z=(0,c.VK)((()=>{const{showAllRepliesAfterTimestamp:t}=e,o=(()=>{var o;if(S||m.length<=Ki||"block_menu"===e.discussionLocation||"page_discussion"===e.discussionLocation)return m;const i=[t,null===(o=A.current)||void 0===o?void 0:o.getCreatedTime(),null==_?void 0:_.getCreatedTime()].filter(Le.$K),n=i.length>0?Math.min(...i):void 0;if(n){const e=m.filter((e=>(e.getCreatedTime()||0)>n)),t=m.filter((e=>(e.getCreatedTime()||0)<=n));return t.length<=Ki?m:[...Me.pm(t,Pi),...e]}return Me.pm(m,Pi)})(),i=new Set(o.map((e=>e.id))),n=m.filter((e=>!i.has(e.id)));return{commentStores:m,commentsToShow:o,commentsToCollapse:n,reactionsToShow:Y.bh.getUserVisibleReactions(e.store)}}),[m,_,e,S],{useDeepEqual:!0}),E=(0,n.useCallback)((()=>{if(!e.store.isDefined())return;const t=e.store.getContext();if(!t)return;return y.VP_(t,(t=>!y.xw5(t)||y.h19(t)===e.store.id))}),[e.store]),P=(0,c.VK)((()=>{if(!F)return;return(0,ue.getAndSortCommentStoresByTime)(e.store).find((t=>Si({discussionStore:e.store,commentStore:t})))}),[F,e.store]),K=n.createRef(),U=(0,n.useRef)(e.blockStore.clone()).current,N=(0,u.yK)((t=>i?{discussionWrapper:{...e.format===ue.DiscussionFormat.Page&&{margin:"0px -14px 16px"},...e.format===ue.DiscussionFormat.Menu&&{padding:"6px 0 12px",marginLeft:-2,boxShadow:e.isFirst?"none":`0 -1px 0 ${t.regularDividerColor}`,marginTop:e.isFirst?0:1},...e.format===ue.DiscussionFormat.Margin&&{padding:"4px 0",borderRadius:8}}}:{discussionWrapper:{...e.format===ue.DiscussionFormat.Page&&{margin:"14px -14px 14px"},...e.format===ue.DiscussionFormat.Menu&&{paddingTop:10,paddingBottom:12,marginLeft:-2,boxShadow:e.isFirst?"none":`0 -1px 0 ${t.regularDividerColor}`,marginTop:e.isFirst?0:1},...e.format===ue.DiscussionFormat.Margin&&{paddingTop:e.collapsed?8:0,paddingBottom:e.collapsed?8:14,borderRadius:4}}}),[e.collapsed,e.format,e.isFirst,i]);(0,n.useEffect)((()=>{o.KatexStore.loadIfNeeded(E)}),[o.KatexStore,E]);const O=t=>{const{device:i}=o;if(!i.isMobile)return;if(!e.store.isDefined())return;t.stopPropagation(),t.preventDefault(),vi.Z.setState({open:!1});const n=Me.oA(xi.C.findSelectablesFromIds([e.store.getParentId()])),s=null==n?void 0:n[0];s&&L.XW({handle:s,vertical:{reveal:"bottom"},horizontal:{reveal:"closest"},animate:!0})},G=()=>{const o=(0,ue.lineClampForCommentCount)(l.length);if(!e.collapsed)return(0,f.jsx)(Tt.Z,{style:{display:"flex",flexDirection:"column",maxHeight:500,overflowY:"scroll",paddingTop:i?void 0:8},ref:t,type:_t.Z.Y,store:D,children:l.map(((t,n)=>{const s=a&&0===n;return(0,f.jsx)(pi,{store:t,discussionStore:e.store,blockStore:e.blockStore,hoveringDiscussion:v,discussionLocation:e.discussionLocation,showResolveButtonByDefaultIfPossible:e.showResolveButtonByDefaultIfPossible,maxLines:o,shouldShowThreadLine:i?n!==l.length-1:void 0,discussionContext:s?(0,f.jsx)(Ei,{discussionStore:e.store,blockStore:e.blockStore,collapsed:Boolean(e.collapsed)}):void 0,isSuggestionComment:s},t.id)}))});const n=l[0]&&(0,f.jsx)(pi,{store:l[0],discussionStore:e.store,blockStore:e.blockStore,hoveringDiscussion:v,discussionLocation:e.discussionLocation,showResolveButtonByDefaultIfPossible:e.showResolveButtonByDefaultIfPossible,maxLines:o,collapsed:e.collapsed,shouldShowThreadLine:i?1!==l.length:void 0,discussionContext:a?(0,f.jsx)(Ei,{discussionStore:e.store,blockStore:e.blockStore,collapsed:Boolean(e.collapsed)}):void 0,isSuggestionComment:a},l[0].id),s=l.length>1&&l[l.length-1]&&(0,f.jsx)(pi,{store:l[l.length-1],discussionStore:e.store,blockStore:e.blockStore,hoveringDiscussion:v,discussionLocation:e.discussionLocation,showResolveButtonByDefaultIfPossible:e.showResolveButtonByDefaultIfPossible,maxLines:o,collapsed:e.collapsed,shouldShowThreadLine:!i&&void 0},l[l.length-1].id),r=l.length-2;return(0,f.jsxs)(f.Fragment,{children:[n,(0,f.jsx)(Zi,{insetButton:!T,count:r,onClick:ne,discussionLocation:e.discussionLocation}),s]})};const q=(0,c.VK)((()=>e.blockStore.getRole()),[e.blockStore]),Q=t.current,ee=(0,c.VK)((()=>(null==Q?void 0:Q.atScrollEnd())??!0),[Q]),te=j&&!e.collapsed&&T&&B&&t.current&&!ee,oe=()=>{s.default.afterNextFlush((()=>{t.current&&t.current.scrollToBottom({animate:!0})}))},ie=Me.Ds((()=>{setTimeout((()=>k(!0)),50)}),50),ne=e=>{T||(e.stopPropagation(),w(!0))},se=()=>{p.reset()},re=()=>{X.Z.state||b(!0)},ae=()=>{b(!1)};return 0===z.commentsToShow.length&&z.reactionsToShow.length>0?(0,f.jsx)("div",{ref:Z,style:{...N.discussionWrapper,paddingLeft:16},onMouseMove:re,onMouseLeave:ae,children:(0,f.jsx)(gt,{focused:!1,parentStore:e.store,discussionLocation:e.discussionLocation})}):(0,f.jsx)(Rt.Z,{store:U,analyticsName:"discussion",canNativeDropOnto:!0,onNativeDrop:async e=>{let{files:t}=e;K.current&&await K.current.uploadFiles(t)},keepTextSelectionOnDrop:!0,shouldShowDropZone:!0,children:(0,f.jsxs)("div",{ref:Z,style:N.discussionWrapper,onMouseMove:re,onMouseLeave:ae,children:[function(){if(T)return G();const{commentStores:t,commentsToShow:o,commentsToCollapse:n}=z,s=n.length>0,r=o.map(((t,n)=>{const r=a&&0===n,l=r?(0,f.jsx)(Ei,{discussionStore:e.store,blockStore:e.blockStore,collapsed:Boolean(e.collapsed)}):0===n&&!s&&(e.format===ue.DiscussionFormat.Menu||e.format===ue.DiscussionFormat.Sidebar)&&(0,f.jsx)(Li,{format:e.format,discussionLocation:e.discussionLocation,store:e.store,blockStore:e.blockStore,onClick:O});return(0,f.jsx)(pi,{store:t,discussionStore:e.store,blockStore:e.blockStore,hoveringDiscussion:v,discussionLocation:e.discussionLocation,showResolveButtonByDefaultIfPossible:e.showResolveButtonByDefaultIfPossible,discussionContext:l,isSuggestionComment:r,showNewBar:t.id===(null==V?void 0:V.id)&&0!==n,shouldShowThreadLine:i?n!==o.length-1:void 0},t.id)})),l=a,d=l?(0,f.jsx)(Ei,{discussionStore:e.store,blockStore:e.blockStore,collapsed:Boolean(e.collapsed)}):(e.format===ue.DiscussionFormat.Menu||e.format===ue.DiscussionFormat.Sidebar)&&(0,f.jsx)(Li,{format:e.format,discussionLocation:e.discussionLocation,store:e.store,blockStore:e.blockStore,onClick:O});return(0,f.jsxs)("div",{style:{position:"relative"},children:[F&&P&&(0,f.jsx)(gi.z,{style:Ui}),s&&(0,f.jsx)(pi,{store:t[0],discussionStore:e.store,blockStore:e.blockStore,hoveringDiscussion:v,discussionLocation:e.discussionLocation,showResolveButtonByDefaultIfPossible:e.showResolveButtonByDefaultIfPossible,discussionContext:d,shouldShowThreadLine:i?1!==t.length:void 0,isSuggestionComment:l},t[0].id),(0,f.jsx)(Zi,{insetButton:!T,count:n.length-1,onClick:ne,discussionLocation:e.discussionLocation}),r]})}(),x?(0,f.jsx)("div",{style:{height:8}}):(0,f.jsx)(Fi,{ref:K,showMoreCommentsButton:!!te,onMoreCommentsClick:oe,inputVisible:!(h||e.collapsed&&g),store:e.store,blockStore:U,format:e.format,discussionInputStore:p,discussionLocation:e.discussionLocation,onCancel:async()=>{if((0,ue.hasCommentChanged)(p)){await M.confirmUserAction({message:(0,f.jsx)(C.FormattedMessage,{defaultMessage:"Do you want to discard this reply?",id:"discussion.confirmDialog.discardReply.prompt"}),acceptLabel:(0,f.jsx)(C.FormattedMessage,{defaultMessage:"Discard",id:"discussion.confirmDialog.discardReplyButton.label"})})?(se(),e.onDismiss&&e.onDismiss()):(await s.default.afterNextFlush(),R.NX({store:p.state.textStore}))}else se(),e.onDismiss&&e.onDismiss()},onSubmit:async()=>{k(!1);const{device:t}=o,{store:i,discussionLocation:n}=e;I.createAndCommit({userAction:"Discussion.handleSubmitReply",environment:o,perform:e=>{J.Xi({environment:o,discussionStore:i,textValue:p.state.textStore.getValue()||[],transaction:e,discussionLocation:n,files:p.state.files})}}),se(),R.ZH(o),oe(),ie(),t.isMobile||(await s.default.afterNextFlush(),R.N_({store:p.state.textStore}))},onEditPreviousComment:()=>{const t=o.currentUser.id;if(!t)return;const i=W.D4(e.store).filter((e=>e.getCreatedById()===t)),n=Me.Z$(i);if(!n)return;const s=H.Z.find((t=>t.commentId===n.id&&t.discussionLocation===e.discussionLocation));s&&(R.ZH(o),s.edit())},showCtaButtons:!!T||void 0,onFileUploaded:()=>{const e=xi.C.findSelectableFromStore(U);e&&L.XW({handle:e,vertical:{reveal:"bottom"},horizontal:{reveal:"closest"},animate:!0})},role:q})]})})}const Ui={marginRight:4,position:"absolute",right:16,top:14};var Ni=o(33866),Hi=o(10906),Oi=o(82136),Gi=o(92650),$i=o(14577),Xi=o(38585),qi=o(80503),Yi=o(51454),Ji=o(39500),Qi=o(49427),en=o(36391),tn=o(24229),on=o(50628),nn=o(92120),sn=o(48514),rn=o(37240);function an(e){let{discussionData:{groupedDiscussionsData:t,id:o},onClick:i}=e;const[s,r]=(0,n.useState)(!1),a=(0,n.useCallback)((()=>{r(!0)}),[]),l=(0,n.useCallback)((()=>{r(!1)}),[]),d=(0,n.useCallback)((async e=>{const o=t[0].discussionStore;await i(e,o)}),[i,t]),m=(0,c.VK)((()=>$.default.checkGate("comments_density_image_handling")),[]),p=(0,c.VK)((()=>t.flatMap((e=>(0,W.D4)(e.discussionStore)))),[t]),h=(0,c.VK)((()=>{const e=t[0].parentBlockStore;return[...new Set(p.map((e=>e.getCreatedById())).filter(Le.$K))].map((t=>Y.U6.createChildStore(e,{table:ke.KJ,id:t}))).slice(0,3)}),[t,p]),x=(0,c.VK)((()=>{const e=p.map((e=>e.getLastEditedTime()));return Math.max(...e)}),[p]),v=(0,u.yK)((e=>({discussion:{border:`1px solid ${e.regularDividerColor}`,borderRadius:4,background:s?e.hoveredMarginDiscussionBackground:e.contentBackground,width:Gi.Z,display:"flex",padding:"10px 12px",cursor:"pointer",...m?{border:`1px solid ${e.stroke.deemphasized}`,borderRadius:8,padding:"12px",alignItems:"center",gap:6}:{}},userAvatarsContainer:{display:"flex",marginRight:6,justifyContent:"center",alignItems:"center",flexDirection:"row-reverse",...m?{marginRight:0}:{}},hiddenUsers:{fontSize:14,color:e.mediumTextColor,marginRight:6},commentCount:{fontSize:14,fontWeight:j.Z.fontWeight.semibold,whiteSpace:"normal",marginLeft:6,...m?{marginLeft:0,color:e.text.primary,fontWeight:j.Z.fontWeight.medium,lineHeight:"18px"}:{}},textPlaceholder:{background:e.lightDividerColor,height:14,width:81,borderRadius:4,marginLeft:4},lastEditedTime:{margin:"1px 0px 0px 6px",whiteSpace:"normal",display:"flex",justifyContent:"center",alignItems:"center",lineHeight:"21px",...m?{marginLeft:0,color:e.text.tertiary,fontSize:12,lineHeight:"15px"}:{}},commentAuthorAvatarStyle:{width:20,height:20,borderRadius:20,marginRight:-3,position:"relative",userSelect:"none",WebkitUserSelect:"none",...m?{width:24,height:24,marginRight:2}:{}},commentAuthorPlaceholderStyle:{width:20,height:20,borderRadius:20,marginRight:-3,position:"relative"},secondaryLabel:{fontSize:j.Z.fontSize.UISmall.desktop,marginLeft:4,color:e.lightTextColor,marginTop:1,whiteSpace:"normal",display:"flex",justifyContent:"center",alignItems:"center",lineHeight:"21px",...m?{marginLeft:0,marginTop:0,color:e.text.tertiary}:{}},expandIcon:{width:j.Z.fontSize.UISmall.desktop,height:j.Z.fontSize.UISmall.desktop,fill:e.lightTextColor,marginTop:1}})),[s,m]);return(0,f.jsx)("div",{style:v.discussion,onMouseEnter:a,onMouseLeave:l,onClick:d,className:Ve.S9A,children:(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("div",{style:v.userAvatarsContainer,children:h.map((e=>(0,f.jsx)(st,{authorStore:e,avatarSize:m?24:20,avatarStyle:v.commentAuthorAvatarStyle,placeholderStyle:v.commentAuthorPlaceholderStyle},e.id)))}),p.length>0?(0,f.jsx)("div",{style:v.commentCount,children:(0,f.jsx)(C.FormattedMessage,{defaultMessage:"{numComments, plural, one {{numComments} comment} other {{numComments} comments}}",id:"marginComments.collapsed.numComments.count",values:{numComments:p.length}})}):(0,f.jsx)("div",{style:v.textPlaceholder}),s?(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("div",{style:{marginLeft:10,display:"flex",justifyContent:"center",alignItems:"center",...m?{marginLeft:0}:{}},children:(0,rn.s)(v.expandIcon)}),(0,f.jsx)("div",{style:v.secondaryLabel,children:(0,f.jsx)(C.FormattedMessage,{defaultMessage:"Expand",id:"marginComments.collapsed.expand.label"})})]}):x&&(0,f.jsx)(T.Z,{isSmall:!0,isSecondaryColor:!0,isMultiline:!0,style:v.lastEditedTime,children:(0,f.jsx)(_.Z,{text:(0,U.IS)(x,{useUltraCompactFormat:m}),tooltipText:(0,U.uy)(x),icon:g.C})})]})})}var ln=o(74725),dn=o(18821);function cn(e){let{discussionData:{parentBlockStore:t,discussionInputStore:o},isVisible:i}=e;const s=(0,n.useRef)(null),a=(0,r.O7)(),l=(0,c.VK)((()=>$.default.checkGate("comments_density_image_handling")),[]),d=(0,n.useCallback)((()=>{dn.Dc(a)}),[a]),m=(0,n.useCallback)((()=>{dn.uK({discussionInputStore:o,environment:a,discussionHelpers:ue})}),[a,o]),p=(0,n.useMemo)((()=>[`.${Ve.mJW}`]),[]);(0,ln.O)({active:i,closeHandler:m,ref:s,excludedSelectors:p,ignoreKeydown:!0});const g=(0,u.yK)((e=>({discussion:{borderRadius:6,boxShadow:e.marginDiscussionSelectedShadow,width:Gi.Z,background:e.selectedMarginDiscussionBackground},discussionInputContainer:{borderRadius:6,padding:l?"8px 8px 8px 12px":"6px 4px 4px 8px"}})),[l]);return(0,f.jsx)("div",{style:g.discussion,ref:s,className:Ve.S9A,children:(0,f.jsx)(ci,{parentStore:t,discussionInputStore:o,shouldSaveUnsentComments:!1,isMobileSlideUpMenu:!1,discussionFormat:ue.DiscussionFormat.Margin,onSubmit:d,onCancel:m,isNewComment:!0,blockStore:t,canDrop:!0,showAvatar:!1,containerStyle:g.discussionInputContainer,showCtaButtons:!0})})}var un=o(22491),mn=o(5971);function pn(e){let{discussionData:{discussionStore:t,parentBlockStore:o},timeMounted:i,onClick:s,isVisible:a,isDiscussionSelected:l,isDiscussionHovered:d}=e;const m=(0,n.useRef)(null),p=(0,r.O7)(),[g,h]=(0,n.useState)((()=>new me.Z(p,t.pointer.spaceId))),x=(0,mn.E)("block_reactions"),v=t.id,b=(0,c.VK)((()=>t.getCommentStores().length>0),[t]),S=(0,c.VK)((()=>t.getReactionStores().length>0),[t]),y=(0,n.useMemo)((()=>[`.${(0,un.dk)({discussionId:v})}`,`.${Ve.mJW}`,`.${Ve.S9A}`]),[v]),C=(0,n.useCallback)((async()=>{const e=H.Z.find((e=>e.isEditing()));if(e){if(!(await e.handleCancelEdit()))return}k.LZ()}),[]);(0,ln.O)({active:a&&l,closeHandler:C,ref:m,excludedSelectors:y,ignoreKeydown:!0});const w=(0,u.yK)((e=>({discussion:{border:l?void 0:`1px solid ${e.lightDividerColor}`,borderRadius:6,padding:l?"1px":void 0,background:l?e.selectedMarginDiscussionBackground:d?e.hoveredMarginDiscussionBackground:e.contentBackground,boxShadow:l?e.marginDiscussionSelectedShadow:void 0,width:Gi.Z,cursor:l?void 0:"pointer"},wrapper:{willChange:"transform",transition:"transform 200ms ease",transform:l?"translateX(-20px)":d?"translateX(-5px)":void 0}})),[d,l]),j=(0,n.useCallback)((async e=>{var o;l||(Bo.Uw(p,{discussion_id:t.id,from:"margin_comments",parent_block_id:t.getParentId(),parent_collection_id:null===(o=t.getParentStore())||void 0===o?void 0:o.getParentCollectionIdUpToTwoLevels()}),await s(e,t))}),[s,t,l,p]);return(0,f.jsxs)("div",{className:Ve.S9A,ref:m,style:w.wrapper,onClick:j,children:[S&&x&&(0,f.jsx)("div",{style:{width:Gi.Z},children:(0,f.jsx)(gt,{focused:l,parentStore:t,discussionLocation:"margin_comments"})}),b&&(0,f.jsx)("div",{style:w.discussion,children:(0,f.jsx)(Wi,{store:t,blockStore:o,format:ue.DiscussionFormat.Margin,isFirst:!1,isOnly:!1,showResolveButtonByDefaultIfPossible:!1,discussionLocation:"margin_comments",showAllRepliesAfterTimestamp:i,discussionInputStore:g,collapsed:!l})})]})}const gn=n.memo(pn);function hn(e){const{discussionData:t,isLastItem:o,isDiscussionSelected:i,discussionItemElementMap:s}=e,r=(0,u.yK)((()=>({discussionContainer:{transition:"background 300ms ease\n\t\t\t\t"+(t.hide?"":", top 200ms ease-in-out"),top:t.offsetTop,position:"absolute",paddingBottom:o?Gi.Vs:Gi.wo,zIndex:i?1:void 0,opacity:t.hide?0:1,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",pointerEvents:"auto"}})),[t.hide,t.offsetTop,i,o]);let a;const l=t.type;"existing"===l?a=(0,f.jsx)(gn,{...e,discussionData:t}):"new"===l?a=(0,f.jsx)(cn,{...e,discussionData:t}):"grouped"===l?a=(0,f.jsx)(an,{...e,discussionData:t}):(0,Le.t1)(l);const d=(0,n.useCallback)((()=>{nn.Z.setState({source:"margin_comments",discussionIds:[t.id]})}),[t.id]),c=(0,n.useCallback)((()=>{nn.Z.setState({discussionIds:[]})}),[]),m=(0,n.useCallback)((e=>{s.set(t.id,e)}),[t.id,s]);return(0,f.jsx)("div",{style:r.discussionContainer,onMouseEnter:d,onMouseLeave:c,ref:m,children:a})}const fn=n.memo(hn),xn=`.${Xi.zd}, .${Xi.FB}`;function vn(e){let{pageBlockStore:t,timeMounted:o,isVisible:i,animating:s,pageViewBlockAccessor:a,width:l}=e;const d=(0,r.O7)(),m=(0,n.useRef)(null),p=(0,n.useRef)(new Map),g=(0,n.useRef)(new Map),h=(0,c.VK)((()=>nn.Z.getFirstSelectedDiscussionId()),[]),x=(0,n.useCallback)((async(e,o)=>{(0,Ji.X9)()||e.target instanceof Element&&e.target.closest(xn)||await J.Ri({discussionStore:o,currentBlockStore:t,environment:d,analyticsFrom:"margin_comments",currentEl:m.current})}),[t,d]),[v,b]=(0,n.useState)({data:[],hasNewDiscussion:!1,selectedDiscussion:void 0}),[S,y]=(0,n.useState)(!1),{WindowSizeStore:C}=d,w=qi.R6(d.device.isElectronMac);(0,n.useEffect)((()=>{if(!i)return;const e=new $i.Z((()=>({selectableRectMap:on.Z.state.selectableRectMap,pageContentStores:t.getContentStores(),sidebarIsAnimating:en.ZP.state.isAnimating,windowHeight:C.state.height})),{debugName:"effectDataStore"}),o=new $i.Z((()=>Gi.EM.state),{debugName:"discussionStoresStore"}),n=new $i.Z((()=>{const e=sn.Z.state;if(e.open&&e.rect&&"comment"===e.content&&Qi.Z.isBlockInFrame(e.blockStore))return{blockStore:e.blockStore,discussionInputStore:e.discussionInputStore}}),{debugName:"newMarginDiscussionArgsStore"}),r=new $i.Z((()=>tn.Z.getFramePageFirstSelectedDiscussionId()),{debugName:"selectedDiscussionIdStore"});let l=!1;const d=(0,Me.Ds)((()=>{const{selectableRectMap:i,pageContentStores:d,sidebarIsAnimating:c,windowHeight:u}=e.state,h=o.state,f=n.state,x=r.state;if(s||c)return;const C=a();if(!(C&&m.current&&i&&i.size))return;(0,Gi.H0)({discussionStores:h,pageContentStores:d,marginDiscussionItemRefs:p.current,selectedDiscussionId:x,newMarginDiscussionArgs:f,marginContainerElement:m.current,pageViewBlockElement:C,onComputeComplete:(e,t)=>{l||(g.current=t,S||y(!0),b(e))},computedOnce:S,topbarHeight:w,windowHeight:u,isFullWidth:t.isFullWidth(),prevSelectedDiscussionId:v.selectedDiscussion,previousDiscussionElements:g.current})}),5);return e.addListener(d),o.addListener(d),r.addListener(d),n.addListener(d),()=>{l=!0,e.removeListener(d),o.removeListener(d),r.removeListener(d),n.removeListener(d)}}),[i,s,a,S,t,v.selectedDiscussion,C,w]);const j=(0,u.yK)((()=>({marginCommentsContainer:{display:"flex",flexDirection:"column",paddingTop:8,paddingBottom:8,paddingLeft:Gi.fS,paddingRight:Gi.fS,width:l-2*Gi.fS,flexShrink:0,height:"100%",position:"relative",pointerEvents:"none",zIndex:Yi.p8}})),[l]);return(0,f.jsx)("div",{style:j.marginCommentsContainer,ref:m,children:v.data.map(((e,t)=>(0,f.jsx)(fn,{discussionData:e,timeMounted:o,onClick:x,isVisible:i,discussionItemElementMap:p.current,isDiscussionSelected:e.selected||"new"===e.type,isDiscussionHovered:e.id===h,isLastItem:t===v.data.length-1},`margin-discussion-${e.id}`)))})}const bn=n.memo(vn);function Sn(e){let{pageBlockStore:t,isVisible:o,pageViewBlockAccessor:i,context:s,isCollapsedAnchor:a}=e;const[l,d]=(0,n.useState)(!1),m=(0,r.O7)(),p=(0,n.useMemo)((()=>(new Date).getTime()),[]),g=(0,c.VK)((()=>t.isFullWidth()||s===Oi.S.CollectionPageView),[s,t]),h=(0,c.VK)((()=>a?{paddingLeft:g?96:42,height:0}:g?void 0:{position:"absolute",right:(0,Gi.oS)(m,(0,Hi.en)(t),(0,Hi.Ks)(t))}),[g,m,t,a]),x=(0,n.useCallback)((()=>{d(!0)}),[]),v=(0,n.useCallback)((()=>{d(!1)}),[]),b=(0,u.yK)((()=>({marginCommentsSection:{display:o||l?"flex":"none",flexShrink:0,pointerEvents:"none",width:o?Gi.QB:0,...h}})),[o,l,h]);return(0,f.jsx)(Ge.Z,{isVisible:!0,animationStyle:{opacity:o?1:0},onAnimationStart:x,onAnimationEnd:v,render:()=>(0,f.jsx)("div",{style:b.marginCommentsSection,children:(0,f.jsx)(bn,{pageBlockStore:t,timeMounted:p,isVisible:o,animating:l,pageViewBlockAccessor:i,width:Gi.QB})})})}var yn=o(36488),Cn=o(56940),wn=o(53437),jn=o(3553),kn=o(83355),Mn=o(72402),Ln=o(49085);class Dn extends Ln.default{getInitialState(){return{}}}const Rn=Dn;class In extends kn.Z{constructor(){super(...arguments),this.storeTypes={store:Rn},this.rootNode=void 0,this.observer=void 0,this.handleMutation=()=>{this.rootNode&&this.stores.store.setState({node:this.rootNode})}}get registries(){return[Mn.Z]}didMount(){this.props.capture&&this.startListeners()}UNSAFE_willUpdate(e){e.capture&&!this.props.capture?this.startListeners():!e.capture&&this.props.capture&&this.stopListeners()}willUnmount(){this.stopListeners()}startListeners(){const e=We.findDOMNode(this);e&&(this.rootNode=e,this.observer=new MutationObserver(this.handleMutation),this.observer.observe(this.rootNode,{attributes:!0,subtree:!0}))}stopListeners(){this.observer&&(this.observer.disconnect(),this.rootNode=void 0,this.observer=void 0)}renderComponent(){return n.Children.only(this.props.children)}}In.displayName="SlideUpInputArea";const Bn=In;const Fn=function(){const e=(0,c.VK)((()=>$.default.checkGate("comments_density_image_handling")),[]),t=(0,r.O7)(),{device:o,WindowSizeStore:i}=t,n=(0,c.VK)((()=>sn.Z.state.rect),[]),s=(0,c.VK)((()=>{if(sn.Z.state.open&&"comment"===sn.Z.state.content){const{blockStore:e,discussionInputStore:o}=sn.Z.state;return{blockStore:e,discussionInputStore:o,canMarginCommentsRender:(0,Gi.az)(t,e)}}return null}),[t]),a=(0,c.VK)((()=>e?{paddingLeft:o.isMobileNative?i.getSafePaddingLeftCSS(12):12,paddingRight:o.isMobileNative?i.getSafePaddingRightCSS(8):8}:{paddingLeft:o.isMobileNative?i.getSafePaddingLeftCSS(10):10,paddingRight:o.isMobileNative?i.getSafePaddingRightCSS(10):10}),[i,o.isMobileNative,e]),l=(0,u.yK)((()=>({inputWrapper:{width:o.isMobileNative?"100%":470,maxWidth:o.isMobileBrowser?"90vw":"100%",paddingTop:e?9:8,paddingBottom:o.isAndroid?12:8,paddingLeft:a.paddingLeft,paddingRight:a.paddingRight}})),[o,a,e]),d=()=>{dn.Dc(t)},m=()=>{s&&dn.uK({discussionInputStore:s.discussionInputStore,environment:t,discussionHelpers:ue})};return null!=s&&s.canMarginCommentsRender?null:(0,f.jsx)(wn.ZP,{popupType:o.isMobileNative?wn.ZP.PopupType.SlideUp:wn.ZP.PopupType.Popup,keepFocus:!0,open:null!==s,originRect:n,placementToOrigin:wn.ZP.Placement.Bottom,alignmentToOrigin:wn.ZP.Alignment.Center,originGap:4,onDismiss:m,render:()=>{if(s){const{blockStore:e,discussionInputStore:t}=s;return(0,f.jsx)(Cn.Z,{capture:!0,ignoreBlockSelection:!0,restoreSelection:!0,render:()=>(0,f.jsx)(Bn,{capture:!0,children:(0,f.jsx)(yn.Z,{capture:!0,allowOpenLinkMenu:!0,render:()=>(0,f.jsx)(jn.Z,{store:e,droppable:!0,render:()=>(0,f.jsx)("div",{style:l.inputWrapper,children:(0,f.jsx)(ci,{showAvatar:!0,parentStore:e,onCancel:m,onSubmit:d,discussionInputStore:t,isMobileSlideUpMenu:!0,shouldSaveUnsentComments:!1,discussionFormat:ue.DiscussionFormat.Page,blockStore:e,canDrop:!0})})},e.id)})})})}}})};var Tn=o(9080);const Zn=function(){const e=(0,r.O7)(),{device:t}=e,{open:o,rect:i}=(0,c.VK)((()=>Tn.Z.state),[]);return(0,f.jsx)(wn.ZP,{popupType:t.isMobile?wn.ZP.PopupType.SlideUp:wn.ZP.PopupType.Popup,open:o,originRect:i,placementToOrigin:wn.ZP.Placement.Bottom,alignmentToOrigin:wn.ZP.Alignment.Center,originGap:4,onDismiss:()=>Q.UZ(e),render:()=>(0,f.jsx)(_n,{})})};function _n(){const e=(0,r.O7)(),{device:t}=e,o=(0,c.VK)((()=>Tn.Z.state),[]);if(o.open){const{discussionStore:i,discussionInputStore:n,blockStore:s,discussionLocation:r}=o;let a;return a=t.isMobile?{menuType:ze.og.Modal,title:(0,f.jsx)(C.FormattedMessage,{defaultMessage:"Comments",id:"discussion.mobileReplyMenu.title"}),right:(0,f.jsx)(C.FormattedMessage,{defaultMessage:"Close",id:"discussion.mobileReplyMenu.closeButton.label"}),onClickRight:()=>Q.UZ(e),whiteBackground:!0}:{menuType:ze.og.Popup,width:420,maxWidth:t.isMobileBrowser?"80vw":"100%"},(0,f.jsx)(Fe.Z,{className:Ve.LoZ,...a,children:(0,f.jsx)(yn.Z,{capture:!0,allowMobileAutoScroll:!0,render:()=>(0,f.jsx)(Wi,{store:i,discussionInputStore:n,onDismiss:()=>Q.UZ(e),format:ue.DiscussionFormat.Menu,isFirst:!0,isOnly:!0,discussionLocation:r,showResolveButtonByDefaultIfPossible:!0,blockStore:s})})})}return null}},10417:(e,t,o)=>{o.r(t),o.d(t,{DiscussionFormat:()=>R,DiscussionLocationToAvatarSize:()=>$,anyDiscussionCommentsLoading:()=>N,commentComparator:()=>A,discussionLocationToDiscussionFormat:()=>H,formatFileSize:()=>X,getAndSortCommentStoresByTime:()=>V,getDiscussions:()=>Z,getDiscussionsForSidebar:()=>_,getFirstComment:()=>z,getIcon:()=>D,getLatestRelevantComment:()=>I,getSetOfUsersInDiscussions:()=>O,hasCommentChanged:()=>U,inputIsEmpty:()=>W,isCommentAllEmojis:()=>G,lineClampForCommentCount:()=>T,sortDiscussionStoresByLatestComment:()=>K});var i=o(66897),n=o(12436),s=(o(67294),o(45238)),r=o(85893);const a=(0,s.IU)("codeFile",{viewBox:"0 0 23 24",svg:(0,r.jsx)("path",{d:"M4.195 11.86c0-.266.078-.488.235-.665.156-.182.38-.3.672-.351.494-.089.849-.271 1.062-.547.214-.281.32-.73.32-1.344V6.961c0-1.115.263-1.938.79-2.469.525-.536 1.333-.804 2.421-.804.203 0 .375.023.516.07.177.057.31.146.398.265a.646.646 0 01.141.422c0 .339-.148.558-.445.657a1.14 1.14 0 01-.157.039l-.171.015c-.625.047-1.066.222-1.32.524-.256.302-.384.8-.384 1.492v2.414c0 .672-.182 1.198-.546 1.578-.36.38-.86.604-1.5.672-.032 0-.047.013-.047.039.005.02.02.034.047.04.64.062 1.14.283 1.5.663.364.38.546.906.546 1.578v2.414c0 .693.128 1.19.383 1.492.255.303.696.48 1.32.532.053 0 .1.002.141.008l.133.03c.333.09.5.308.5.657a.68.68 0 01-.14.43.816.816 0 01-.407.273 1.48 1.48 0 01-.437.063c-1.12 0-1.948-.266-2.485-.797-.531-.526-.797-1.352-.797-2.477V14.79c0-.614-.106-1.062-.32-1.344-.213-.28-.568-.463-1.062-.547-.292-.062-.516-.182-.672-.359-.157-.177-.235-.404-.235-.68zm15.602 0c0 .275-.078.502-.235.68-.156.176-.382.296-.68.358-.5.084-.856.266-1.07.547-.208.282-.312.73-.312 1.344v1.992c0 1.125-.266 1.95-.797 2.477-.531.531-1.36.797-2.484.797-.151 0-.297-.021-.438-.063a.757.757 0 01-.414-.265.715.715 0 01-.133-.438c0-.182.042-.328.125-.437a.674.674 0 01.383-.22l.117-.03c.047-.006.097-.008.149-.008.625-.052 1.065-.23 1.32-.532.255-.302.383-.799.383-1.492v-2.414c0-.672.182-1.208.547-1.61.364-.405.864-.616 1.5-.632.026-.005.039-.018.039-.039 0-.026-.013-.04-.04-.04-.635-.015-1.135-.226-1.5-.632-.364-.406-.546-.945-.546-1.617V7.172c0-.693-.128-1.193-.383-1.5-.255-.307-.695-.48-1.32-.516l-.18-.015a1.233 1.233 0 01-.148-.04c-.297-.109-.446-.328-.446-.656 0-.166.045-.307.133-.422a.777.777 0 01.414-.265c.14-.047.31-.07.508-.07 1.089 0 1.896.268 2.422.804.526.531.789 1.354.789 2.469v1.992c0 .615.107 1.06.32 1.336.214.276.568.461 1.063.555.297.052.523.169.68.351a.967.967 0 01.234.664z"})}),l=(0,s.IU)("compressedFile",{viewBox:"0 0 23 24",svg:(0,r.jsx)("path",{d:"M5.297 17.758V5.968c0-.838.213-1.473.64-1.905.428-.438 1.06-.657 1.899-.657h8.32c.839 0 1.472.219 1.899.656.427.433.64 1.068.64 1.907v11.789c0 .844-.213 1.482-.64 1.914-.427.432-1.06.648-1.899.648h-8.32c-.839 0-1.471-.216-1.899-.648-.427-.432-.64-1.07-.64-1.914zm1.539-.094c0 .36.094.635.281.828.188.193.472.29.852.29h8.062c.38 0 .664-.097.852-.29.187-.193.281-.469.281-.828V6.07c0-.364-.094-.643-.281-.836-.188-.198-.471-.296-.852-.296H7.97c-.38 0-.664.098-.852.296-.187.193-.281.472-.281.836v11.594zm4.617 1.906V8.648h1.086V19.57h-1.086zM12 8.953c-.62 0-1.107-.17-1.46-.508-.35-.338-.524-.804-.524-1.398 0-.115.005-.23.015-.344.016-.114.037-.226.063-.336l.734-3.21a.637.637 0 01.242-.384.709.709 0 01.438-.14h.984a.68.68 0 01.43.14.672.672 0 01.25.383l.734 3.211c.021.11.037.222.047.336.016.115.024.23.024.344 0 .594-.175 1.06-.524 1.398-.349.339-.833.508-1.453.508zm0-1.125c.24 0 .438-.08.594-.242a.826.826 0 00.242-.61.82.82 0 00-.242-.593.795.795 0 00-.594-.25c-.24 0-.44.083-.602.25a.825.825 0 00-.242.594c0 .24.078.442.235.609a.826.826 0 00.609.242zm0 2.89V9.696h1.828c.146 0 .268.05.367.149a.464.464 0 01.149.351c0 .146-.05.271-.149.375a.498.498 0 01-.367.149H12zm-1.836 1.024a.516.516 0 01-.367-.148.525.525 0 01-.149-.375c0-.14.05-.258.149-.352a.516.516 0 01.367-.148H12v1.023h-1.836zM12 12.79v-1.023h1.828c.146 0 .268.05.367.148a.49.49 0 01.149.36.5.5 0 01-.149.367.498.498 0 01-.367.148H12zm-1.836 1.024a.516.516 0 01-.367-.149.516.516 0 01-.149-.367c0-.14.05-.258.149-.352a.516.516 0 01.367-.148H12v1.015h-1.836zM12 14.867v-1.023h1.828c.146 0 .268.05.367.148a.473.473 0 01.149.36.5.5 0 01-.149.367.499.499 0 01-.367.148H12zm-1.836 1.024a.508.508 0 01-.516-.523.48.48 0 01.149-.352.516.516 0 01.367-.149H12v1.024h-1.836zM12 16.945v-1.023h1.828c.146 0 .268.05.367.148a.473.473 0 01.149.36c0 .14-.05.263-.149.367a.499.499 0 01-.367.148H12zm-1.836 1.04a.516.516 0 01-.367-.15.499.499 0 01-.149-.366c0-.146.05-.266.149-.36a.516.516 0 01.367-.148H12v1.023h-1.836z"})});var d=o(40304);const c=(0,s.IU)("executable",{viewBox:"0 0 23 23.5",svg:(0,r.jsx)("path",{d:"M5.164 16.883c-.37-.209-.651-.448-.844-.719-.187-.276-.28-.69-.28-1.242V8.609c0-.416.08-.763.241-1.039.162-.28.417-.52.766-.718l5.492-3.079c.484-.27.971-.406 1.461-.406.49 0 .974.136 1.453.406l5.492 3.079c.35.197.604.437.766.718.161.276.242.623.242 1.04v6.312c0 .552-.094.966-.281 1.242-.188.27-.469.51-.844.719l-6.047 3.39c-.52.287-1.044.287-1.57 0l-6.047-3.39zm.844-1.203l5.265 2.976v-6.265L5.43 9.094v5.687c0 .203.041.375.125.516.088.14.24.268.453.383zm11.976 0c.214-.115.362-.242.446-.383a.95.95 0 00.133-.516V9.094l-5.844 3.297v6.265l5.265-2.976zM12 11.11l5.773-3.235-4.937-2.781c-.552-.318-1.112-.318-1.68 0l-4.93 2.781L12 11.109z"})}),u=(0,s.IU)("file3D",{viewBox:"0 0 23 24",svg:(0,r.jsx)("path",{d:"M5.648 16.352l5.61-2.82v-6.65h1.492v6.65l5.61 2.82-.75 1.273-5.61-2.82-5.61 2.82-.742-1.273zm-1.945 1.195l1.32-2.985c.105-.25.243-.427.415-.53a.643.643 0 01.539-.071c.187.052.349.198.484.437l1.937 3.352c.146.245.196.46.149.648a.61.61 0 01-.336.43c-.177.1-.404.133-.68.102l-3.242-.36c-.297-.036-.5-.146-.61-.328-.103-.182-.096-.414.024-.695zm16.594 0c.12.281.125.513.015.695-.104.182-.304.292-.601.328l-3.242.36c-.271.03-.498-.003-.68-.102a.634.634 0 01-.344-.43c-.041-.187.01-.403.157-.648l1.937-3.352c.135-.24.294-.385.477-.437a.638.638 0 01.539.07c.177.104.32.281.43.531l1.312 2.985zm-8.89-12.985c.181-.25.377-.372.585-.367.208 0 .404.123.586.367l1.93 2.618c.167.229.252.445.258.648a.596.596 0 01-.204.5c-.14.13-.354.195-.64.195h-3.86c-.276 0-.486-.065-.632-.195a.637.637 0 01-.203-.508c.005-.208.088-.422.25-.64l1.93-2.617z"})});var m=o(52455);const p=(0,s.IU)("font",{viewBox:"0 0 24 24",svg:(0,r.jsx)("path",{d:"M17.008 17.766c-.724 0-1.354-.185-1.89-.555-.537-.37-.957-.888-1.259-1.555-.296-.672-.445-1.458-.445-2.36 0-.895.149-1.676.445-2.343.303-.672.722-1.193 1.258-1.562.537-.375 1.167-.563 1.89-.563.433 0 .834.07 1.204.211.375.14.7.344.977.61.28.26.5.572.656.937h.062V9.64c0-.256.073-.459.219-.61a.738.738 0 01.555-.226c.234 0 .424.075.57.226.146.151.219.354.219.61v7.312c0 .255-.073.453-.219.594a.771.771 0 01-.57.219.773.773 0 01-.547-.203c-.146-.136-.221-.331-.227-.586v-.954h-.062a2.688 2.688 0 01-1.094 1.29c-.495.302-1.076.453-1.742.453zm.453-1.368c.484 0 .906-.125 1.266-.375.364-.255.643-.611.835-1.07.198-.463.297-1.01.297-1.64 0-.63-.099-1.178-.297-1.641-.197-.469-.476-.83-.835-1.086a2.1 2.1 0 00-1.266-.39 2.13 2.13 0 00-1.266.382c-.354.25-.627.607-.82 1.07-.193.464-.29 1.014-.29 1.649s.097 1.185.29 1.648c.193.464.466.823.82 1.078.36.25.782.375 1.266.375zm-14.07 1.32c-.271 0-.485-.072-.641-.218-.151-.146-.227-.349-.227-.61 0-.156.034-.335.102-.538l3.477-9.375C6.33 6.326 6.784 6 7.46 6c.36 0 .651.08.875.242.23.162.404.406.523.735l3.454 9.335c.072.204.109.391.109.563 0 .26-.084.466-.25.617-.162.151-.38.227-.656.227-.26 0-.466-.06-.618-.18-.145-.115-.26-.312-.343-.594l-.867-2.422H5.226l-.868 2.422c-.083.282-.2.48-.351.594-.146.12-.352.18-.617.18zM5.68 13.07h3.57L7.484 7.992h-.039L5.68 13.07z"})});var g=o(87292);const h=(0,s.IU)("presentation",{viewBox:"0 0 24 24",svg:(0,r.jsx)("path",{d:"M6.305 20.703c-.844 0-1.482-.213-1.914-.64-.433-.428-.649-1.06-.649-1.899v-8.031c0-.839.216-1.472.649-1.899.432-.427 1.07-.64 1.914-.64h11.383c.843 0 1.481.216 1.914.648.437.427.656 1.057.656 1.89v8.032c0 .833-.219 1.464-.656 1.89-.433.433-1.07.65-1.915.65H6.306zm.093-1.531h11.196c.36 0 .635-.096.828-.29.198-.187.297-.47.297-.85v-7.766c0-.38-.1-.664-.297-.852-.193-.193-.469-.289-.828-.289H6.398c-.364 0-.643.096-.835.29-.188.187-.282.47-.282.85v7.766c0 .38.094.664.282.852.192.193.47.289.835.289zM5.461 6.32c.057-.37.185-.656.383-.86.203-.202.513-.304.93-.304h10.453c.416 0 .724.102.921.305.204.203.334.49.391.86H5.461zm1.594-2.258c.02-.348.133-.611.336-.789.208-.182.5-.273.875-.273h7.468c.375 0 .664.091.868.273.203.178.32.44.351.79H7.055z"})});var f=o(61646),x=o(62261),v=o(19035),b=o(70691),S=o(53965),y=o(1898),C=o(18265),w=o(65598),j=o(77080),k=o(67926);const M=o(60809),L={doc:d.w,docx:d.w,pages:d.w,md:d.w,txt:d.w,rtf:d.w,xls:f.Y,xlsx:f.Y,csv:f.Y,tsv:f.Y,ods:f.Y,pdf:g.B,pptx:h,ppt:h,zip:l,br:l,bz2:l,gz:l,"7z":l,dmg:l,pkg:l,jar:l,rar:l,tar:l,xar:l,stl:u,obj:u,fbx:u,amf:u,iges:u,mp3:n.l,m4a:n.l,wav:n.l,aac:n.l,ogg:n.l,flac:n.l,alac:n.l,wma:n.l,exe:c,otf:p,ttf:p,woff:p,eof:p,py:a,java:a,js:a,ts:a,tsx:a,c:a,h:a,cpp:a,go:a,rs:a,css:a,php:a,swift:a,kt:a,lua:a,m:a,bash_profile:a,bashrc:a,zshrc:a,vimrc:a,vim:a};function D(e){const t=function(e){if(!e)return"";const{pathname:t}=C.Qc(e);if(!t)return"";const o=t.split(".");return o[o.length-1]}(e).toLowerCase();return L[t]??m.X}let R=function(e){return e[e.Menu=0]="Menu",e[e.Page=1]="Page",e[e.Sidebar=2]="Sidebar",e[e.Margin=3]="Margin",e[e.Unfurl=4]="Unfurl",e}({});function I(e){let{recordStore:t,currentUserId:o,timestamp:i}=e;return P({recordStore:t,currentUserId:o,timestamp:i})||z(t)}const B=6,F=3;function T(e){return e>1?F:B}function Z(e){return e?w.al(e,{recursivelyLoadAllDiscussions:!0,includeLoadingDiscussions:!0}):[]}function _(e){let{blockStore:t,currentUserId:o,ignoreAfterTime:i}=e;if(!t)return[];return w.al(t,{recursivelyLoadAllDiscussions:!0,includeLoadingDiscussions:!0}).sort(((e,t)=>{const n=I({recordStore:e,currentUserId:o,timestamp:i}),s=I({recordStore:t,currentUserId:o,timestamp:i});return null!=n&&n.isDefined()?null!=s&&s.isDefined()?-(n.getCreatedTime()-s.getCreatedTime()):1:-1}))}function A(e,t){return e&&e.isDefined()?t&&t.isDefined()?e.getCreatedTime()-t.getCreatedTime():1:-1}function V(e){return w.D4(e).sort(((e,t)=>A(e,t)))}function z(e){return V(e)[0]}function E(e){return P({recordStore:e,currentUserId:void 0})}function P(e){let{recordStore:t,currentUserId:o,timestamp:i}=e;const n=w.D4(t).filter((e=>j.default.checkGate("comments_pane_improvements")?i?e.isDefined()&&e.getCreatedTime()<i:e.isDefined():e.isDefined()&&e.getCreatedById()!==o)).sort(((e,t)=>A(e,t)));return n[n.length-1]}function K(e){return e.sort(((e,t)=>A(E(e),E(t))))}function W(e){const t=e.state.textStore.getValue(),o=(e.state.files??[]).length>0,i=t&&t.length>0;return!o&&!i}function U(e,t){const o=e.state.textStore.getValue(),i=e.state.files;if(!t)return o&&0!==o.length||i&&i.length>0;const n=w.zP(t).getValue();return!S.Xy(n,o)||function(e,t){const o=e.state.files,i=w.le(t);if(i.length!==o.length)return!0;return i.some(((e,t)=>e.id!==o[t].id))}(e,t)}function N(e){if(e.some((e=>!e.isReady())))return!0;return!!e.map((e=>w.D4(e))).flat().some((e=>!e.isReady()||!e.getCreatedTime()))}function H(e){switch(e){case"block_menu":case"reply_menu_mentions_comments":case"reply_menu_all_updates":case"reply_menu_archive":case"reply_menu_updates_sidebar":case"updates_menu_mentions_comments":case"updates_menu_all_updates":case"updates_menu_archive":return R.Menu;case"page_discussion":return R.Page;case"updates_sidebar":return R.Sidebar;case"margin_comments":return R.Margin;case"comment_unfurl":return R.Unfurl;default:(0,y.t1)(e)}}function O(e){return S.mN(S.VS(e,(e=>w.D4(e).map((e=>({store:e,pointer:e.getCreatedByPointer()}))))),(e=>{var t;return null===(t=e.pointer)||void 0===t?void 0:t.id})).filter((e=>(0,y.$K)(e.pointer))).map((e=>{let{store:t,pointer:o}=e;return k.t.createChildStore(t,o)})).map((e=>e.getModel())).filter(y.$K).map((e=>e instanceof b.T?(0,i.dp)(e):e instanceof v.L?(0,i.D$)(e):e instanceof x.R?(0,i.Jp)(e):void(0,y.t1)(e))).filter(y.$K)}function G(e){var t;if(e.length>1)return!1;const o=e[0];if(!o.length)return!1;const i=o[0].trim(),n=M();return(null===(t=i.match(n))||void 0===t?void 0:t.join(""))===i}const $={updates_menu_all_updates:28,updates_menu_mentions_comments:28,updates_menu_archive:28,block_menu:20,reply_menu_all_updates:20,reply_menu_mentions_comments:20,reply_menu_archive:20,reply_menu_updates_sidebar:20,page_discussion:20,updates_sidebar:23,margin_comments:20,comment_unfurl:32};function X(e){return((null==e?void 0:e.match(/[0-9.]+|[a-z]+/gi))??[]).join(" ")}},72402:(e,t,o)=>{o.d(t,{Z:()=>s});var i=o(35431);class n extends i.Z{}const s=new n},69475:(e,t,o)=>{o.d(t,{A:()=>x,l:()=>v});o(21703),o(57658);var i=o(28084),n=o(68626),s=o(55652),r=o(45953),a=o(21202),l=o(49984),d=o(35092),c=o(12139),u=o(66504),m=o(49051),p=o(53965),g=o(52629),h=o(84693);let f=1;class x{constructor(e){let{connection:t,maxSize:o,verifyRecordPointerMismatches:a}=e;this.trackWithDynamicSampling=void 0,this.getLatency=new s.s,this.isBrowser=void 0,this.batchReadWorkers=15,this.connection=void 0,this.maxSize=void 0,this.verifyRecordPointerMismatches=void 0,this.pendingWrites=r.Ao.create(),this.getManyFromDisk=async e=>{const t=r.Ao.create();e.forEach(((e,o)=>{let{pointer:i}=e;t.set(i,o)}));const o=await h.Q6(this.connection,e),i=r.Ao.create();for(const n of o)this.setCachedRecordMap(i,n);return e.map((e=>{let{pointer:t,userId:o}=e;const n=this.getInMemory(t,o);if(n)return n;const s=i.get(t);return s&&s[o]}))},this.diskReadQueue=new i.Z({batchSize:Math.floor(d.mz/3)-1,maxWorkers:this.batchReadWorkers>0?this.batchReadWorkers:1,performRequests:this.getManyFromDisk}),this.flushWrites=async()=>{const e=this.pendingWrites;this.pendingWrites=r.Ao.create();const t=p.VS(Array.from(e),(e=>{let{value:t}=e;return t?Object.values(t):[]}));try{var o;await h.Y3(this.connection,this.maxSize,t),null===(o=this.trackWithDynamicSampling)||void 0===o||o.call(this,{eventName:"sqlite_record_cache.flush_writes",eventProperties:{status:"success"},options:{preboot:!0,defaultSampleRateOverride:0}})}catch(s){var i;n.log({level:"warning",from:"SqliteRecordCache",type:"applyRecordCacheOperationsError",error:(0,g.Ui)(s),data:this.getExtraDataForReadOrWriteError(s)},{forceSuppressConsoleLog:!0}),null===(i=this.trackWithDynamicSampling)||void 0===i||i.call(this,{eventName:"sqlite_record_cache.flush_writes",eventProperties:{status:"error"},options:{preboot:!0,defaultSampleRateOverride:0}})}},this.debouncedFlushWrites=p.Ds(this.flushWrites,500,{maxWait:3e3}),this.connection=t,this.maxSize=o,this.verifyRecordPointerMismatches=a}waitForInitialize(){var e,t;return(null===(e=(t=this.connection).waitForInitialize)||void 0===e?void 0:e.call(t))||Promise.resolve()}set(e,t,o,i,s){if(void 0===e||void 0===e.id){const t=new Error("Attempting to set a record with an invalid pointer.");return n.log({level:"error",from:"SqliteRecordCache",type:"SqliteRecordCache.setBadPointer",error:{message:"Attempting to set a record with an invalid pointer.",stack:t.stack},data:{pointer:e}}),void c.IE(t)}const r={pointer:e,userId:i=i||u.I,value:t,timestamp:Date.now(),importance:o};this.removePendingWrite(e,i,"delete"),this.enqueueWrite({type:"set",record:r,maybeStaleRecord:s})}async get(e,t){const o=`get ${f}`;t=t||u.I,f++,this.getLatency.start(o);try{const n=this.getInMemory(e,t);if(n)return this.enqueueWrite({type:"access",record:n}),this.getLatency.end(o,"memory"),n.value;const s=await(this.batchReadWorkers>0?this.diskReadQueue.enqueue({pointer:e,userId:t}):this.getFromDiskUnbatched(e,t));var i;if(s)return this.enqueueWrite({type:"access",record:s}),this.getLatency.end(o,"disk"),null===(i=this.trackWithDynamicSampling)||void 0===i||i.call(this,{eventName:"sqlite_record_cache.get_record",eventProperties:{status:"success"},options:{preboot:!0,defaultSampleRateOverride:0}}),s.value&&"comment"===s.pointer.table&&v.commentIds.add(s.pointer.id),s.value&&"notion_user"===s.pointer.table&&v.userIds.add(s.pointer.id),s.value}catch(r){var s;return n.log({level:"warning",from:"SqliteRecordCache",type:"getError",error:(0,g.Ui)(r),data:this.getExtraDataForReadOrWriteError(r)},{forceSuppressConsoleLog:!0}),void(null===(s=this.trackWithDynamicSampling)||void 0===s||s.call(this,{eventName:"sqlite_record_cache.get_record",eventProperties:{status:"error"},options:{preboot:!0,defaultSampleRateOverride:0}}))}finally{this.getLatency.end(o,"miss")}}deleteRecord(e,t){t=t||u.I,this.removePendingWrite(e,t,"set"),this.enqueueWrite({type:"delete",record:{pointer:e,userId:t}})}async getBlocksWithParent(e){const t=Date.now(),o=e.userId||u.I,i=await h.lR(this.connection,{...e,timestamp:t,userId:o}),n=r.Ao.create(),s=p.oA(Array.from(this.pendingWrites).map((i=>{const s=i&&i.value&&o&&i.value[o];if(!s||"set"!==s.type)return;const r=s.record.value?s.record.value.value:void 0;if(!r)return;if(s.record.pointer.table!==a.iU)return;const l=r;return l.parent_id===e.parent.id&&l.parent_table===e.parent.table?(n.set(s.record.pointer,!0),s.record.timestamp<t&&(s.record.timestamp=t),s.record.value):void 0})));for(const r of i)n.get(r.pointer)||this.getInMemory(r.pointer,r.userId)||s.push(r.value);return s}async getPageBlocksByParent(e){const t=Date.now(),o=e.userId||u.I,i=await h.GF(this.connection,{...e,timestamp:t,userId:o});return i.forEach((e=>{this.enqueueWrite({type:"access",record:{pointer:e.pointer,timestamp:t,userId:o,importance:void 0,value:e.value}})})),i}async reset(){this.pendingWrites=r.Ao.create(),await h.G$(this.connection)}setTrackWithDynamicSampling(e){this.trackWithDynamicSampling=e}setIsBrowser(e){this.isBrowser=e}enqueueWrite(e){this.debouncedFlushWrites();const{pointer:t,userId:o}=e.record,i=this.pendingWrites.get(t),n=i&&i[o];if(n){if("set"===n.type&&"access"===e.type){const t={type:"set",record:{...n.record,timestamp:e.record.timestamp}};return void this.setCacheOperationMap(this.pendingWrites,t)}const t="set"===n.type&&!n.maybeStaleRecord&&n.record.value&&n.record.value.value?n.record.value.value.version:void 0,o="set"===e.type&&e.maybeStaleRecord&&e.record.value&&e.record.value.value?e.record.value.value.version:void 0;if("number"==typeof t&&"number"==typeof o&&t>=o)return}this.setCacheOperationMap(this.pendingWrites,e)}async getFromDiskUnbatched(e,t){const[o]=await this.getManyFromDisk([{pointer:e,userId:t}]);return o}getInMemory(e,t){const o=this.pendingWrites.get(e),i=o&&o[t];if(i&&"set"===i.type)return i.record}setCacheOperationMap(e,t){const o=t,{pointer:i,userId:n}=o.record,s=e.get(i)||{};e.set(i,{...s,[n]:o})}setCachedRecordMap(e,t){const{pointer:o,userId:i}=t,n=e.get(o)||{};e.set(o,{...n,[i]:t})}removePendingWrite(e,t,o){const i=this.pendingWrites.get(e);i&&i[t]&&i[t].type===o&&this.pendingWrites.delete(e)}getExtraDataForReadOrWriteError(e){return{errorSql:(0,l.l)(e)?e.debugInfo.errorSql:void 0,lastSuccessfulSqlBatch:e instanceof l.q2?e.debugInfo.lastSuccessfulSqlBatch:void 0,sqliteCode:(0,l.l)(e)?e.debugInfo.sqliteCode:void 0,wasmSqliteDbVersion:this.isBrowser?m.wE:void 0}}}const v={commentIds:new Set([]),userIds:new Set([])}},31505:(e,t,o)=>{o.d(t,{Y:()=>s});o(67294);var i=o(45238),n=o(85893);const s=(0,i.IU)("collectionTimelineArrowLeft",{viewBox:"0 0 9 7",svg:(0,n.jsx)("path",{d:"M0 3.5021C0 3.70786 0.0939831 3.93041 0.237195 4.06479L3.11934 6.76065C3.28493 6.91602 3.48633 7 3.67877 7C4.17106 7 4.48881 6.68506 4.48881 6.27774C4.48881 6.03839 4.37245 5.86203 4.22029 5.72345L3.19095 4.77025L2.56887 4.22855L3.47737 4.27055L8.13625 4.27055C8.6554 4.27055 9 3.96401 9 3.5021C9 3.04019 8.6554 2.73365 8.13625 2.73365L3.47737 2.73365L2.56887 2.77564L3.19095 2.23395L4.22029 1.27654C4.37245 1.13377 4.48881 0.961608 4.48881 0.722255C4.48881 0.314937 4.17106 0 3.67877 0C3.48633 0 3.28493 0.0839832 3.11487 0.239352L0.237195 2.93941C0.0939831 3.07378 0 3.29634 0 3.5021Z"})})},39301:(e,t,o)=>{o.d(t,{n:()=>s});o(67294);var i=o(45238),n=o(85893);const s=(0,i.IU)("collectionTimelineArrowRight",{viewBox:"0 0 9 7",svg:(0,n.jsx)("path",{d:"M9 3.4979C9 3.29214 8.90602 3.06959 8.7628 2.93521L5.88066 0.239352C5.71507 0.0839835 5.51368 3.13148e-07 5.32123 2.96324e-07C4.82894 2.53287e-07 4.51119 0.314937 4.51119 0.722256C4.51119 0.961608 4.62755 1.13797 4.77971 1.27654L5.80905 2.22975L6.43113 2.77145L5.52263 2.72945L0.863749 2.72945C0.344604 2.72945 -6.62078e-07 3.03599 -7.02459e-07 3.4979C-7.4284e-07 3.95981 0.344604 4.26635 0.863749 4.26635L5.52263 4.26635L6.43113 4.22436L5.80905 4.76605L4.77971 5.72346C4.62755 5.86623 4.51119 6.03839 4.51119 6.27774C4.51119 6.68506 4.82894 7 5.32123 7C5.51367 7 5.71507 6.91602 5.88513 6.76065L8.7628 4.06059C8.90602 3.92622 9 3.70366 9 3.4979Z"})})},40304:(e,t,o)=>{o.d(t,{w:()=>s});o(67294);var i=o(45238),n=o(85893);const s=(0,i.IU)("document",{viewBox:"0 0 23.5 23.5",svg:(0,n.jsx)("path",{d:"M9.14 8.156a.494.494 0 01-.5-.5c0-.14.047-.258.141-.351a.487.487 0 01.36-.14h5.718a.477.477 0 01.492.492.494.494 0 01-.14.35.464.464 0 01-.352.15H9.141zm0 2.664a.487.487 0 01-.359-.14.504.504 0 01-.14-.36c0-.135.046-.25.14-.343a.487.487 0 01.36-.141h5.718a.477.477 0 01.493.484c0 .14-.047.26-.141.36a.477.477 0 01-.352.14H9.141zm0 2.672a.487.487 0 01-.359-.14.468.468 0 01-.14-.344c0-.14.046-.258.14-.352a.473.473 0 01.36-.148h2.765c.146 0 .266.05.36.148a.48.48 0 01.14.352c0 .135-.047.25-.14.344a.487.487 0 01-.36.14H9.141zm-3.843 4.266V5.968c0-.838.213-1.473.64-1.905.428-.438 1.06-.657 1.899-.657h8.32c.839 0 1.472.219 1.899.656.427.433.64 1.068.64 1.907v11.789c0 .844-.213 1.482-.64 1.914-.427.432-1.06.648-1.899.648h-8.32c-.839 0-1.471-.216-1.899-.648-.427-.432-.64-1.07-.64-1.914zm1.539-.094c0 .36.094.635.281.828.188.193.472.29.852.29h8.062c.38 0 .664-.097.852-.29.187-.193.281-.469.281-.828V6.07c0-.364-.094-.643-.281-.836-.188-.198-.471-.296-.852-.296H7.97c-.38 0-.664.098-.852.296-.187.193-.281.472-.281.836v11.594z"})})},52455:(e,t,o)=>{o.d(t,{X:()=>s});o(67294);var i=o(45238),n=o(85893);const s=(0,i.IU)("fileAttachment",{viewBox:"0 0 28 28",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("rect",{width:"28",height:"28",fill:"none"}),(0,n.jsx)("path",{d:"M7.70703 27.3799H21.2783C23.7412 27.3799 24.9854 26.1104 24.9854 23.6348V11.7266C24.9854 10.3555 24.8076 9.74609 23.9697 8.88281L16.5049 1.3418C15.6924 0.516602 15.0322 0.326172 13.8008 0.326172H7.70703C5.26953 0.326172 4 1.58301 4 4.05859V23.6348C4 26.1104 5.25684 27.3799 7.70703 27.3799ZM7.7832 25.8057C6.32324 25.8057 5.57422 25.0312 5.57422 23.5967V4.09668C5.57422 2.7002 6.32324 1.8877 7.7959 1.8877H13.7246V9.53027C13.7246 10.9775 14.4609 11.6631 15.8701 11.6631H23.4238V23.5967C23.4238 25.0312 22.6621 25.8057 21.2021 25.8057H7.7832ZM16.0352 10.1777C15.4512 10.1777 15.21 9.94922 15.21 9.36523V2.20508L23.1064 10.1777H16.0352Z"})]})})},61646:(e,t,o)=>{o.d(t,{Y:()=>s});o(67294);var i=o(45238),n=o(85893);const s=(0,i.IU)("spreadsheet",{viewBox:"0 0 23 24",svg:(0,n.jsx)("path",{d:"M3.32 10.43V8.96h17.422v1.47H3.32zm0 4.343v-1.468h17.422v1.468H3.32zm7.93 3.758V5.203h1.5v13.328h-1.5zm-5.945.625c-.844 0-1.482-.213-1.914-.64-.433-.427-.649-1.058-.649-1.891V7.109c0-.833.216-1.463.649-1.89.432-.433 1.07-.649 1.914-.649H18.68c.849 0 1.49.216 1.922.649.432.427.648 1.057.648 1.89v9.516c0 .833-.216 1.463-.648 1.89-.433.428-1.073.641-1.922.641H5.305zm.093-1.531h13.196c.36 0 .635-.094.828-.281.193-.193.289-.477.289-.852v-9.25c0-.375-.096-.656-.29-.844-.192-.192-.468-.289-.827-.289H5.398c-.364 0-.643.097-.835.29-.188.187-.282.468-.282.843v9.25c0 .375.094.659.282.852.192.187.47.281.835.281z"})})},49051:(e,t,o)=>{o.d(t,{HA:()=>i,wE:()=>n});const i={CHROME:{TOKEN:"ArlWUsTSaH+4IS65MeoOwbwM1RkZx0YWwbDOsbbhEO5z4EsRp080qH8QB0XBn5XywqlgmNGT/LT4ZgQ86H+uxg4AAABzeyJvcmlnaW4iOiJodHRwczovL25vdGlvbi5zbzo0NDMiLCJmZWF0dXJlIjoiVW5yZXN0cmljdGVkU2hhcmVkQXJyYXlCdWZmZXIiLCJleHBpcnkiOjE3MTkzNTk5OTksImlzU3ViZG9tYWluIjp0cnVlfQ==",MIN_CHROME_VERSION:92,MAX_CHROME_VERSION:124},EDGE:{TOKEN:"As03mCvy9PkdYPuaxaAQd49kbGn160q43XejPevCbQpnYeq3h4xvFd8/n1720wNf5ZQNzIvbbhDIBUZAJafg/5oAAABzeyJvcmlnaW4iOiJodHRwczovL25vdGlvbi5zbzo0NDMiLCJpc1N1YmRvbWFpbiI6dHJ1ZSwiZmVhdHVyZSI6IlVucmVzdHJpY3RlZFNoYXJlZEFycmF5QnVmZmVyIiwiZXhwaXJ5IjoxNzE0MDY5NDUyfQ=="}},n="v2"}}]);