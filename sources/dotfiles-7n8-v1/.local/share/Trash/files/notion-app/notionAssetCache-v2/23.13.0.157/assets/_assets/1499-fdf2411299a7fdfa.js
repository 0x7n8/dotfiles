"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[1499],{3553:(e,t,o)=>{o.d(t,{Z:()=>ke});var n=o(67294),r=o(18466),i=o(1302),s=o(480),l=o(33125),a=o(86628),c=o(24405),d=o(31701),u=o(53965),p=o(87420),h=o(52989),f=o(24677),b=o(98104),m=o(13447),g=o(75330),v=o(84064),S=o(43250),C=o(12534),k=o(39500),w=o(16339),A=o(44534),x=o(69784),M=o(50628),y=o(27724),T=o(4827),j=o(83355),R=o(6287),Z=o(77080),E=o(86486),I=o(23063),B=o(9612),O=o(51454),P=o(73744),N=o(17504),D=o(77546),F=o(439),_=o(48779),H=o(94841),z=o(95802),L=o(80444),V=o(807),K=o(47453),G=o(9291),W=o(36610),U=o(42858),$=o(84084),J=o(28314),Y=o(50627),q=o(65598),X=o(64921),Q=o(26388),ee=o(65200),te=o(85893);const oe=2,ne=24,re=(0,G.defineMessages)({ariaLabelApple:{id:"block.selectableAddMenu.ariaLabel.apple",defaultMessage:"Click to add below. Option-click to add a block above"},ariaLabelWindows:{id:"block.selectableAddMenu.ariaLabel.windows",defaultMessage:"Click to add below. Alt-click to add a block above"}});const ie=function(e){let{store:t,offsetTop:o}=e;const n=(0,G.useIntl)(),r=(0,c.Fg)(),i=(0,s.O7)();return(0,s.MO)()?null:(0,te.jsx)(Q.ZP,{placement:Q.ug.Bottom,delayThreshold:300,renderTooltip:()=>(0,te.jsx)(le,{}),render:e=>(0,te.jsx)(X.Z,{disallowTabbing:!0,onClick:()=>function(e,t){const o=J.lF.state.option,n=z.C.findSelectablesFromStore(t).find((e=>Boolean(e.props.onInsertRowBelow)));if((0,Y.Wt)(t))return;o?n&&n.props.onInsertRowAbove?m.createAndCommit({userAction:"SelectableAddMenu.handleClick.onInsertRowBelow",environment:e,perform:e=>{n.props.onInsertRowAbove&&n.props.onInsertRowAbove({transaction:e})}}):m.createAndCommit({environment:e,userAction:"SelectableAddMenu.handleClick.addAbove",perform:o=>{U.uE({environment:e,blocks:[t],transaction:o})}}):q.PF(t)?$.hb({environment:e,blockStore:t}):n&&n.props.onInsertRowBelow?m.createAndCommit({userAction:"SelectableAddMenu.handleClick.onInsertRowBelow",environment:e,perform:e=>{n.props.onInsertRowBelow&&n.props.onInsertRowBelow({transaction:e})}}):m.createAndCommit({environment:e,userAction:"SelectableAddMenu.handleClick.addBelow",perform:o=>{U.ZJ({environment:e,blocks:[t],transaction:o})}});W.eT(e),E.default.reset()}(i,t),style:se(o,t,i,r),ariaLabel:n.formatMessage(i.device.isApple?re.ariaLabelApple:re.ariaLabelWindows),...e,children:(0,K.R)({width:16})})})};function se(e,t,o,n){const r=(0,F.zt)(e,t),i=(0,F.tx)(o,ne+oe+ee.Z.width,t);return{display:"flex",alignItems:"center",justifyContent:"center",fill:n.lightIconColor,position:"absolute",top:r,left:-i,width:ne,height:ne,borderRadius:4,pointerEvents:"auto",cursor:"-webkit-grab"}}function le(){const e=(0,c.Fg)(),t=(0,s.O7)(),o={color:e.mediumInvertedTextColor};return(0,te.jsxs)("div",{style:{textAlign:"center"},children:[(0,te.jsx)(G.FormattedMessage,{defaultMessage:"Click <mediumcolor>to add below</mediumcolor>",id:"block.selectableAddMenu.tooltip.addBlockBelow",values:{mediumcolor:e=>(0,te.jsx)("span",{style:o,children:e})}}),(0,te.jsx)("div",{children:t.device.isApple?(0,te.jsx)(G.FormattedMessage,{defaultMessage:"Option-click <mediumcolor>to add above</mediumcolor>",id:"block.selectableAddMenu.tooltip.addAbove",values:{mediumcolor:e=>(0,te.jsx)("span",{style:o,children:e})}}):(0,te.jsx)(G.FormattedMessage,{defaultMessage:"Alt-click <mediumcolor>to add a block above</mediumcolor>",id:"block.selectableAddMenu.tooltip.addAbove.windows",values:{mediumcolor:e=>(0,te.jsx)("span",{style:o,children:e})}})})]})}var ae=o(95855),ce=o(18821),de=o(73063);const ue=function(e){const t=(0,s.O7)(),o=(0,s.Fy)(),{mediumInvertedTextColor:r}=(0,c.Fg)(),i=(0,G.useIntl)(),{store:l,shouldOffsetLeft:d}=e,u=(0,a.VK)((()=>d?(0,F.tx)(t,26+ee.Z.width,l):ne+8),[t,l,d]),p=(0,n.useCallback)((()=>{ce.yw({environment:t,blockStore:l})}),[t,l]);return o.isMobile?null:(0,te.jsx)("div",{style:pe(e.offsetTop,u),onMouseDown:C.$0,children:(0,te.jsx)(Q.ZP,{placement:Q.ug.Bottom,delayThreshold:300,renderTooltip:()=>(0,te.jsx)(G.FormattedMessage,{defaultMessage:"Click <invertedcolor>to add a comment</invertedcolor>",id:"selectableCommentMenu.addCommentPrompt.tooltip",values:{invertedcolor:e=>(0,te.jsx)("span",{style:{color:r},children:e})}}),render:e=>(0,te.jsx)(de.Z,{ariaLabel:i.formatMessage({id:"selectableCommentMenu.iconButton",defaultMessage:"Comment"}),disallowTabbing:!0,icon:ae.z,onClick:p,isLightIconColor:!0,...e})})})};function pe(e,t){return{position:"absolute",top:e,left:-t}}class he extends j.Z{constructor(){super(...arguments),this.verticalScrollableAncestor=void 0,this.horizontalScrollableAncestor=void 0,this.isCommentMenu=!1,this.showHoverMenu=!1,this.disableHoverMenuDrag=!1,this.targetSelectableStore=this.createComputedStore((()=>{const{target:e}=this.props;return z.C.findSelectablesFromStore(e).find((e=>Boolean(e.props.shouldShowHoverMenu||e.props.shouldShowCommentMenu)))})),this.targetRectStore=this.createComputedStore((()=>{var e;return null===(e=this.targetSelectableStore.state)||void 0===e||null===(e=e.getNode())||void 0===e?void 0:e.getBoundingClientRect()})),this.isSuggestModeStore=this.createComputedStore((()=>{const{target:e}=this.props;return!!Z.default.checkGate("human_suggested_edits")&&"suggest"===V.Z.getMode(e)})),this.handleScroll=()=>{this.targetRectStore.enqueueRecompute()}}UNSAFE_willMount(e){super.UNSAFE_willMount(e);const t=this.targetSelectableStore.state;if(!t)return;this.isCommentMenu=Boolean(t.props.shouldShowCommentMenu),this.showHoverMenu=Boolean(t.props.shouldShowHoverMenu);const o=t.getNode();o&&(this.verticalScrollableAncestor=(0,D.VW)(o),this.verticalScrollableAncestor&&(0,P.lj)(this.verticalScrollableAncestor,"scroll",this.handleScroll),this.horizontalScrollableAncestor=(0,D.xH)(o),this.horizontalScrollableAncestor&&this.horizontalScrollableAncestor!==this.verticalScrollableAncestor&&(0,P.lj)(this.horizontalScrollableAncestor,"scroll",this.handleScroll),this.handleScroll())}willUnmount(){super.willUnmount(),this.verticalScrollableAncestor&&(0,P.ZV)(this.verticalScrollableAncestor,"scroll",this.handleScroll),this.horizontalScrollableAncestor&&(0,P.ZV)(this.horizontalScrollableAncestor,"scroll",this.handleScroll)}renderComponent(){var e;const{target:t,container:o}=this.props,n=o?o.getBoundingClientRect():void 0,r=this.targetRectStore.state,i=this.isSuggestModeStore.state,s=r?r.top-(n?n.top:0):void 0,l=r?r.left-(n?n.left:0):void 0,a=(0,_.Fn)(this.environment),c="editor"===this.props.target.getRole()||"read_and_write"===this.props.target.getRole()||"edit"===(null===(e=this.pageContext)||void 0===e||null===(e=e.publicEditModeStore.state)||void 0===e?void 0:e.permission),d="external_object_instance_page"===t.getType(),u=this.pageContext&&(0,H.Kj)(this.pageContext.pageStore.id),p=L.default.getState().mainEditorCurrentBlockStore,h=Boolean(p&&p.pathIsDead()&&Z.default.checkGate("prevent_edits_trash"));return(0,N.Z)((e=>{var o;return(0,te.jsxs)("div",{style:{position:"absolute",left:l,top:s,zIndex:O.Mo},...e,children:[this.isCommentMenu&&!t.isNavigableAncestorNonEditableState()&&!h&&(0,te.jsx)(ue,{store:t,offsetTop:(0,F.oJ)(t),shouldOffsetLeft:this.showHoverMenu||a}),this.showHoverMenu&&(0,te.jsx)(ee.Z,{store:t,offsetTop:(0,F.oJ)(t),disableDrag:this.disableHoverMenuDrag||i,isWorkspaceAdmin:a,hasEditorPermissions:c}),(!t.isNavigableAncestorNonEditableState()||"collection"===(null===(o=t.getParentStore())||void 0===o?void 0:o.table))&&!this.isCommentMenu&&c&&!d&&!t.isNavigableAncestorExternallyImportedPage()&&!u&&!i&&!h&&(0,te.jsx)(ie,{store:t,offsetTop:(0,F.oJ)(t)})]})}))}}he.displayName="SelectableHoverMenuOverlayItem";const fe=he,be={position:"absolute",top:0,left:0};class me extends j.Z{constructor(){super(...arguments),this.container=void 0,this.targetStore=this.createComputedStore((()=>{const e=E.default.state;if(e.isOpen&&e.container===this.props.selectableContainer)return e.currentStore})),this.handleContainerMount=e=>{e&&(this.container=e)}}renderComponent(){return(0,te.jsx)("div",{style:be,ref:this.handleContainerMount,children:(0,te.jsx)(B.Z,{className:S.$Ot,render:()=>u.oA([this.renderCurrentTarget()])})})}renderCurrentTarget(){const e=this.targetStore.state;if(!e)return;if(Z.default.checkGate("prevent_edits_trash")){const t=e.getParentStore();if(!t)return this.renderAnimatedComponent({target:e});if(t.table===R.vF&&t.isNonEditableState())return}return this.renderAnimatedComponent({target:e})}renderAnimatedComponent(e){const{target:t}=e;return(0,te.jsx)(I.Z,{isVisible:!0,animationStyle:{opacity:1},enterAnimationStyle:{opacity:1},exitAnimationStyle:{opacity:0},render:()=>(0,te.jsx)(fe,{container:this.container,target:t})},t.id)}}me.displayName="SelectableHoverMenuOverlay";const ge=me,ve=10;function Se(e){let t=!0;if(e.length<=ve){const{selectableElementRectMap:o}=r.Z.withListenerIgnored((()=>M.Z.getState()));t=e.some((e=>function(e,t){const o=t.target instanceof Element?t.target:t.target.parentElement;if(!o)return!0;if(o.closest(`.${S.$Ot}`))return!1;const n=o.closest(`.${S.euV}`);if(!n)return!0;const r=e.get(n);if(!r)return!0;const i=n.getBoundingClientRect();return!(r.x===i.x&&r.y===i.y&&r.width===i.width&&r.height===i.height)}(o,e)))}t&&f.Ch()}function Ce(e){const{isDefaultContainer:t}=e,{currentRect:o,isActive:n,showSelectionRect:r}=(0,a.VK)((()=>x.default.state.isActive?x.default.state:{currentRect:void 0,isActive:!1,showSelectionRect:!1}),[]),i=(0,c.yK)((()=>({selection:{position:"absolute",pointerEvents:"none",backgroundColor:d.ZP.blueWithAlpha(.14),border:"1px solid transparent",left:null==o?void 0:o.left,top:null==o?void 0:o.top,width:o?o.right-o.left:0,height:o?o.bottom-o.top:0}})),[o]);return n&&r&&t?(0,te.jsx)("div",{style:i.selection}):null}const ke=function(e){const t=(0,n.useRef)(null),o=(0,n.useRef)({isPeekRenderer:()=>e.isPeekRenderer??!1,getProps:()=>e,getNode:()=>t.current});(0,n.useLayoutEffect)((()=>{o.current.isPeekRenderer=()=>e.isPeekRenderer??!1,o.current.getProps=()=>e,o.current.getNode=()=>t.current}),[e]);const r=(0,s.O7)();(0,l.c)(w.Z,(()=>o.current),[]),(0,n.useLayoutEffect)((()=>{const n=o.current;if(e.isDefaultContainer){const t=e.isRootContainer?u.G0([n],y.default.state.defaultContainerStack||[]):u.G0(y.default.state.defaultContainerStack||[],[n]);y.default.setState({...y.default.state,defaultContainerStack:t,pivot:void 0,anchor:void 0,anchorContainer:void 0})}if(e.droppable){const t=e.isRootContainer?u.G0([n],y.default.state.droppableContainerStack||[]):u.G0(y.default.state.droppableContainerStack||[],[n]);y.default.setState({...y.default.state,droppableContainerStack:t})}let r;return f.Jy(),t.current&&(r=new MutationObserver(Se),r.observe(t.current,{attributes:!0,childList:!0,characterData:!0,subtree:!0})),()=>{if(e.isDefaultContainer){const e=u.zu(y.default.state.defaultContainerStack||[],n);y.default.setState({...y.default.state,defaultContainerStack:e,pivot:void 0,anchor:void 0,anchorContainer:void 0})}if(e.droppable){const e=u.zu(y.default.state.droppableContainerStack||[],n);y.default.setState({...y.default.state,droppableContainerStack:e})}r&&r.disconnect()}}),[o,e.droppable,e.isDefaultContainer,e.isRootContainer]);const{closestSelectable:c}=(0,n.useContext)(v.aT)??{},d=(0,n.useCallback)((t=>{const{device:o}=r;e.disableRectangularSelection||(o.isPhone?(0,C.ZP)({event:t,context:C.Af.EditorMouseDown,callback:()=>{f.ZH(r),g.wG(),A.HM.clearSelection()}}):(0,C.ZP)({event:t,context:C.Af.EditorMouseDown,callback:()=>{if(t.target instanceof Element){if(t.target.closest("button")||t.target.closest('[role="button"]'))return}1!==t.button&&(t.preventDefault(),h.AI({environment:r,target:t.target,startX:t.clientX,startY:t.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!1}))}}))}),[r,e.disableRectangularSelection]),S=(0,n.useCallback)((t=>{(function(e){return M.Z.hasBeenUpdatedSince(e.timeStamp)})(t)||e.store.canEdit()&&(0,C.ZP)({event:t,context:C.Af.EditorClick,callback:()=>{var o;if(null!==(o=y.default.getDefaultContainerFromTarget(t.target))&&void 0!==o&&o.isPeekRenderer()||p.E5(r),!k.X9()&&!e.disableEditNearestBlock){const{clientX:e,clientY:o,target:n}=t;i.default.afterNextFlush((()=>{m.createAndCommit({userAction:"SelectableContainer.click",environment:r,perform:t=>b.jh(r,{x:e,y:o,target:n instanceof Element?n:void 0},t)})}))}}})}),[r,e.disableEditNearestBlock,e.store]),j=(0,a.VK)((()=>Boolean(x.default.state.isActive&&x.default.state.defaultContainer===o.current)),[]),R=(0,a.VK)((()=>(0,te.jsx)("div",{style:{display:"contents"},ref:t,children:e.render({selectableEvents:{onMouseDown:d,onClick:S},selectableHoverMenuOverlay:(0,te.jsx)(ge,{selectableContainer:o.current})})})),[S,d,e]);return(0,te.jsx)(v.ld,{value:{selectableContainer:o.current,closestSelectable:c},children:(0,te.jsx)(T.Z,{open:j,origin:R,children:(0,te.jsx)(Ce,{isDefaultContainer:e.isDefaultContainer})})})}},65200:(e,t,o)=>{o.d(t,{Z:()=>k});var n=o(67294),r=o(480),i=o(86628),s=o(24405),l=o(36610),a=o(24677),c=o(439),d=o(77907),u=o(69454),p=o(86486),h=o(31945),f=o(50478),b=o(53437),m=o(79954),g=o(85893);const v=f.C$,S=f.GN;function C(e){const{store:t,disableDrag:o,hasEditorPermissions:C,isWorkspaceAdmin:k,offsetTop:w}=e,A=(0,r.O7)(),x=(0,r.MO)(),M=(0,n.useRef)(null),y=v,T=S,j=(0,i.VK)((()=>(0,c.zt)(w,t)),[w,t]),R=(0,i.VK)((()=>(0,c.tx)(A,y+2,t)),[A,y,t]),Z=(0,i.VK)((()=>t.isNavigableAncestorNonEditableState()&&!t.isInsideCollection()),[t]),E=!o&&C&&!Z,I=(0,s.yK)((()=>({div:{position:"absolute",top:j,left:-R,width:y,height:T,pointerEvents:"auto",cursor:E?"-webkit-grab":void 0},popup:{width:265,overflow:"hidden"}})),[E,R,j,T,y]),[B,O]=(0,n.useState)(""),P=(0,i.VK)((()=>{const e=p.default.state;return e.isOpen&&e.menuIsOpen&&e.currentStore===t}),[t]);(0,n.useEffect)((()=>()=>{P&&p.default.reset()}),[]);const N=(0,n.useCallback)((()=>{const e=p.default.state,o=u.Z.state;if(e.isOpen){O(""),x&&o.phase===u.i.shown?u.Z.onHide((()=>p.default.setState({...e,menuIsOpen:!0}))):p.default.setState({...e,menuIsOpen:!0}),a.Ys({environment:A,store:t});const n=t.getType();n&&l.YM(A,{blockType:n})}}),[A,x,t]),D=(0,n.useCallback)((()=>p.default.reset()),[]);return x?null:(0,g.jsx)("div",{style:I.div,ref:M,children:(0,g.jsx)(b.ZP,{popupType:x?h.Z4.SlideUp:h.Z4.Popup,open:P,placementToOrigin:h.pO.Left,alignmentToOrigin:h.vR.Center,onDismiss:D,originGap:5,forceInitialInbound:!0,style:I.popup,render:()=>(0,g.jsx)(d.LazySelectableHoverMenuPopup,{hasEditorPermissions:C,isWorkspaceAdmin:k,store:t,onDismiss:D,containerRef:M,query:B,setQuery:O}),origin:(0,g.jsx)(m.Z,{store:t,isHoverMenu:!0,canDrag:E,canSelect:!1,analyticsName:"selection_menu",disableForceTouch:!0,disableHorizontalDragEdgeScroll:!0,children:(0,g.jsx)(f.ZP,{width:y,height:T,disallowTabbing:!0,onClick:N,disableDrag:!E})}),trapFocus:P})})}C.width=v,C.height=S;const k=C},98321:(e,t,o)=>{o.d(t,{Z:()=>r});var n=o(67294);const r=function(e,t){if(e.ref&&t.ref){const o=t.ref;t.ref=t=>{e.ref(t),o(t)}}return n.cloneElement(e,t)}},439:(e,t,o)=>{o.d(t,{oJ:()=>h,tx:()=>u,zt:()=>p});var n=o(49271),r=o(41432),i=o(92650),s=o(16472),l=o(44534),a=o(6258),c=o(49117),d=o(98165);function u(e,t,o){if(o.isQuoteBlockChild())return t+s.nr+s.NE+n.ZD.paddingLeft;if(o.isTransclusionType()||o.isInsideTransclusion()||"ai_block"===o.getType()||o.isInsideAiBlock())return t+4;if(o.getType()===r.Ti.table){const n=l.g$.getNumberOfUnresolvedComments({simpleTableStore:o,environment:e,includeInline:!(0,i.fg)(e,o)}),r=o.isImmediateColumnChild();return 0!==n||r?t+8:t}const u=d.qA(o).filter((e=>e instanceof a.zq&&e.isType("duplicate_blocks"))).length;return u>0?t+c.pZ*u:t}function p(e,t){return t.isTransclusionType()?e+5:"ai_block"===t.getType()?t.hasContent()?e+9:e+15:t.getType()===r.Ti.button?e+3:e}function h(e){const t=e.getType(),o=e.getNavigableAncestorFormat(),n=Boolean(o.page_small_text);return t===r.Ti.divider?-6:t===r.Ti.header?n?7:10:t===r.Ti.subHeader?n?4:6:t===r.Ti.collectionView?8:t===r.Ti.table?14:3}}}]);