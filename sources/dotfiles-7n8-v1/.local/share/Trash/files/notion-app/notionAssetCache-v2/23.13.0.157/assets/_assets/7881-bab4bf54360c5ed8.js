"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[7881],{20993:(e,t,n)=>{n.d(t,{Z:()=>f,a:()=>b});var a=n(30120),o=n(67294),s=n(86628),i=n(24405),r=n(60897),u=n(9291),c=n(37810),l=n(35253),d=n(91376),p=n(21051),m=n(88893),y=n(91754),v=n(85893);function b(){const e=(0,i.yK)((e=>({bannerContent:{alignItems:"center",display:"flex",flexWrap:"wrap",gap:6,justifyContent:"space-between",padding:"12px 6px",whiteSpace:"normal",width:"100%",lineHeight:1.35},callToAction:{cursor:"pointer",fontWeight:c.Z.fontWeight.semibold}})),[]);return(0,v.jsxs)("div",{style:e.bannerContent,children:[(0,v.jsx)("div",{children:(0,v.jsx)(u.FormattedMessage,{id:"app.banner.trial_subscription.add_payment_method",defaultMessage:"Add a payment method to continue using your free trial. You will not be charged until the end of your trial period."})}),(0,v.jsx)("div",{style:e.callToAction,onClick:()=>d.r$({currentTab:"billing"}),children:(0,v.jsx)(u.FormattedMessage,{id:"app.banner.trial_subscription.add_payment_method.call_to_action",defaultMessage:"Add payment method"})})]})}function f(e){const{subscriptionDataStore:t}=e,{showBanner:n}=(0,s.VK)((()=>{const e=m.XX(t.state);return e&&e.trialEnd?r.Sf.includes(e.plan)||e.paymentMethodType?{showBanner:!1}:{showBanner:a.ou.now()>a.ou.fromSeconds(e.trialEnd).minus({days:15})}:{showBanner:!1}}),[t]);return o.useEffect((()=>(n?l.Bw({bannerStore:p.Z,id:"SubscriptionTrialAddPaymentMethodBanner",contentKey:"subscription_trial_add_payment_method",styleKey:y.v.Yellow,prepend:!0}):l.qL({bannerStore:p.Z,id:"SubscriptionTrialAddPaymentMethodBanner"}),()=>{l.qL({bannerStore:p.Z,id:"SubscriptionTrialAddPaymentMethodBanner"})})),[n]),null}},26907:(e,t,n)=>{n.d(t,{B:()=>i,H:()=>o});n(57658);var a=n(33728);function o(e){const{target:t,inviteTargetsStore:n}=e;return n.state.inviteTargets.some((e=>"newUser"===t.type?e.type===t.type&&t.value.email===e.value.email:"invalidUser"===t.type?e.type===t.type&&t.value.text===e.value.text:e.type===t.type&&e.value.id===t.value.id))}function s(e){return"invalidUser"!==e.type}function i(e){const{inviteTargetsStore:t,includeInputFieldText:n}=e,i=[...t.state.inviteTargets];if(n){const e=function(e){const t=e.state.tokenQuery.trim();if(!(0,a.oH)(t))return;const n={type:"newUser",value:{email:t},source:"email"};return o({target:n,inviteTargetsStore:e})?void 0:n}(t);e&&i.push(e)}return i.filter(s)}},1404:(e,t,n)=>{n.d(t,{Z:()=>O,k:()=>W});var a=n(30120),o=n(67294),s=n(480),i=n(86628),r=n(24405),u=n(92595),c=n(26929),l=n(9291),d=n(1898),p=n(37810),m=n(86572),y=n(35253),v=n(91376),b=n(91754),f=(n(95477),n(48779)),g=n(80444),_=n(21051),w=n(70060),h=n(88893),T=n(88280),x=n(85893);const S={updatePaymentMethod:(0,x.jsx)(l.FormattedMessage,{id:"subscription.payment_status_banner.update_payment_method",defaultMessage:"View unpaid invoice"}),viewWorkspaceOwner:(0,x.jsx)(l.FormattedMessage,{id:"subscription.payment_status_banner.view_workspace_owner",defaultMessage:"View workspace owner"}),confirmPayment:(0,x.jsx)(l.FormattedMessage,{id:"subscription.payment_status_banner.confirm_payment",defaultMessage:"Confirm payment"})};function k(e){const{messageType:t,overdueInvoiceCount:n=1}=e;switch(t){case"past_due_owner":return(0,x.jsx)(l.FormattedMessage,{id:"subscription.payment_status_banner.payment_failed.past_due.workspace_owner",defaultMessage:"We couldn’t process {overdueInvoiceCount, plural, one {your last payment} other {{overdueInvoiceCount} payments}}. Please update your payment method or you may lose access to Notion soon.",values:{overdueInvoiceCount:n}});case"past_due_member":return(0,x.jsx)(l.FormattedMessage,{id:"subscription.payment_status_banner.payment_failed.past_due.member",defaultMessage:"Please contact a workspace owner to update your payment method or you may lose access to Notion soon."});case"unpaid_owner":return(0,x.jsx)(l.FormattedMessage,{id:"subscription.payment_status_banner.payment_failed.unpaid.workspace_owner",defaultMessage:"Access to Notion is limited to viewing because we couldn’t process {overdueInvoiceCount, plural, one {your last payment} other {{overdueInvoiceCount} payments}}. Update your payment information to restore full access.",values:{overdueInvoiceCount:n}});case"unpaid_member":return(0,x.jsx)(l.FormattedMessage,{id:"subscription.payment_status_banner.payment_failed.unpaid.member",defaultMessage:"Access to Notion is limited to viewing. Contact a workspace owner to update your workspace’s payment method."});default:(0,d.t1)(t)}}function C(e){const{messageType:t,overdueInvoiceCount:n=1}=e;switch(t){case"past_due_owner":return(0,x.jsx)(l.FormattedMessage,{id:"subscription.payment_status_banner.confirmation_required.past_due.workspace_owner",defaultMessage:"Please confirm {overdueInvoiceCount, plural, one {your subscription payment} other {{overdueInvoiceCount} payments}} or you may lose access to Notion soon.",values:{overdueInvoiceCount:n}});case"unpaid_owner":return(0,x.jsx)(l.FormattedMessage,{id:"subscription.payment_status_banner.confirmation_required.unpaid.workspace_owner",defaultMessage:"Access to Notion is limited to viewing. Confirm {overdueInvoiceCount, plural, one {your subscription payment} other {{overdueInvoiceCount} payments}} to restore full access.",values:{overdueInvoiceCount:n}});case"unpaid_member":return(0,x.jsx)(l.FormattedMessage,{id:"subscription.payment_status_banner.confirmation_required.unpaid.member",defaultMessage:"Access to Notion is limited to viewing. Contact a workspace owner to update your workspace’s payment method."});default:(0,d.t1)(t)}}function I(){const e=(0,s.O7)();return(0,i.VK)((()=>{var t,n;if(!(0,w.IC)())return;const o=null===(t=g.default.state.currentSpaceStore)||void 0===t?void 0:t.getOverdueSubscription();if(!o)return;const s=(0,h.aS)(T.subscriptionDataStoreInstance.state),i=null==s||null===(n=s.testClock)||void 0===n?void 0:n.frozen_time,r=i?a.ou.fromSeconds(i):a.ou.now(),u=c.cS({now:r,overdueSubscription:o});if("paid"===u.paymentStatus)return;return{overdueSubscription:o,isWorkspaceOwner:(0,f.Fn)(e),paymentStatusWithReason:u}}),[e])}function j(){return()=>{v.r$()}}function M(e){if(void 0!==e)return()=>{e&&window.open(e,"_blank")}}function A(e){const{overdueSubscription:t,isWorkspaceOwner:n,paymentStatusWithReason:a}=e,{invoiceHostedUrl:o,overdueInvoiceCount:s}=t,{paymentStatus:i}=a;switch(i){case"past_due":return function(e){const{isWorkspaceOwner:t,invoiceHostedUrl:n,overdueInvoiceCount:a}=e,o=b.v.Yellow;return t?{bannerStyleKey:o,messageType:"past_due_owner",messageText:k({overdueInvoiceCount:a,messageType:"past_due_owner"}),callToActionText:S.updatePaymentMethod,callToActionHandler:M(n)}:{bannerStyleKey:o,messageType:"past_due_member",messageText:k({overdueInvoiceCount:a,messageType:"past_due_member"}),callToActionText:S.viewWorkspaceOwner,callToActionHandler:j()}}({isWorkspaceOwner:n,invoiceHostedUrl:o,overdueInvoiceCount:s});case"unpaid":return function(e){const{isWorkspaceOwner:t,invoiceHostedUrl:n,overdueInvoiceCount:a}=e,o=b.v.LightRed;return t?{bannerStyleKey:o,messageType:"unpaid_owner",messageText:k({overdueInvoiceCount:a,messageType:"unpaid_owner"}),callToActionText:S.updatePaymentMethod,callToActionHandler:M(n)}:{bannerStyleKey:o,messageType:"unpaid_member",messageText:k({overdueInvoiceCount:a,messageType:"unpaid_member"}),callToActionText:S.viewWorkspaceOwner,callToActionHandler:j()}}({isWorkspaceOwner:n,invoiceHostedUrl:o,overdueInvoiceCount:s});case"paid":return;default:(0,d.t1)(i)}}function K(e){const{overdueSubscription:t,isWorkspaceOwner:n,paymentStatusWithReason:a}=e,{invoiceHostedUrl:o}=t,{paymentStatus:s}=a;switch(s){case"past_due":return function(e,t,n){if(e)return{bannerStyleKey:b.v.Yellow,messageType:"past_due_owner",messageText:C({overdueInvoiceCount:n,messageType:"past_due_owner"}),callToActionText:S.confirmPayment,callToActionHandler:M(t)}}(n,o);case"unpaid":return function(e,t,n){const a=b.v.LightRed;return e?{bannerStyleKey:a,messageType:"unpaid_owner",messageText:C({overdueInvoiceCount:n,messageType:"unpaid_owner"}),callToActionText:S.confirmPayment,callToActionHandler:M(t)}:{bannerStyleKey:a,messageType:"unpaid_member",messageText:C({overdueInvoiceCount:n,messageType:"unpaid_member"}),callToActionText:S.viewWorkspaceOwner,callToActionHandler:j()}}(n,o);case"paid":return;default:(0,d.t1)(s)}}function B(e){if(void 0===e)return;const{overdueReason:t}=e.overdueSubscription;if(t)switch(t){case"payment_failed":return A(e);case"confirmation_required":return K(e);default:(0,d.t1)(t)}}function W(){var e;const t=I(),n=(0,o.useMemo)((()=>B(t)),[t]),a=null==n?void 0:n.messageType,i=null==n?void 0:n.callToActionText,u=null==n?void 0:n.callToActionHandler,c=(0,s.O7)(),l=(0,r.yK)((e=>({bannerContent:{alignItems:"center",display:"flex",flexWrap:"wrap",gap:6,justifyContent:"space-between",padding:"12px 6px",whiteSpace:"normal",width:"100%",lineHeight:1.35},callToAction:{cursor:"pointer",fontWeight:p.Z.fontWeight.semibold}})),[]),d=null==t||null===(e=t.overdueSubscription)||void 0===e?void 0:e.overdueReason,y=(0,o.useCallback)((e=>{void 0!==u&&u(e),a&&m.j(c,{name:"payment_status_banner_action",args:{overdueReason:d,messageType:a}})}),[c,u,a,d]);return n?(0,x.jsxs)("div",{style:l.bannerContent,children:[(0,x.jsx)("div",{children:n.messageText}),void 0!==u?(0,x.jsx)("div",{style:l.callToAction,onClick:y,children:i}):null]}):null}function O(){const e=(0,s.O7)(),t=I(),n=(0,o.useMemo)((()=>B(t)),[t]);return o.useEffect((()=>(["local","development","staging"].includes("production")&&(0,u.exposeDebugValue)("paymentStatus",t),void 0===n||void 0===t?y.qL({bannerStore:_.Z,id:"SubscriptionPaymentStatusBanner"}):(y.Bw({bannerStore:_.Z,id:"SubscriptionPaymentStatusBanner",contentKey:"subscription_payment_status",styleKey:n.bannerStyleKey,prepend:!0}),m.j(e,{name:"payment_status_banner_displayed",args:{overdueReason:t.overdueSubscription.overdueReason,messageType:n.messageType}})),()=>{y.qL({bannerStore:_.Z,id:"SubscriptionPaymentStatusBanner"})})),[e,n,t]),null}},67181:(e,t,n)=>{n.d(t,{T:()=>f,Z:()=>g});var a=n(67294),o=n(480),s=n(86628),i=n(24405),r=n(9291),u=n(1898),c=n(86572),l=n(35253),d=n(91754),p=n(80444),m=n(80148),y=n(21051),v=n(6258),b=n(85893);function f(){const e=(0,o.O7)(),t=(0,s.VK)((()=>e.currentUser.id),[e]),n=(0,i.yK)((e=>({bannerContent:{alignItems:"center",display:"flex",flexWrap:"wrap",gap:6,justifyContent:"space-between",padding:"12px 6px",whiteSpace:"normal",width:"100%",lineHeight:1.35}})),[]),a=(0,s.VK)((()=>p.default.state.currentSpaceStore),[]),c=(0,s.VK)((()=>m.Z.state.visible_banners),[]),l=(0,s.VK)((()=>{if(!a||!t)return null;const e=a.getModel();if(c&&c.length>0){const n=c[0],o=v.$I.createChildStore(a,{id:n,table:"subscription_banner",spaceId:a.id});if(!o.isDefined())return null;const s=o.getBannerText();if(s)return(0,b.jsx)("span",{children:s});const i=!(!e||!e.userIdIsAdmin(t));return function(e,t){switch(e){case"uncollectible_past_due":return t?(0,b.jsx)(r.FormattedMessage,{id:"subscription.payment_uncollectible.past_due.workspace_owner",defaultMessage:"Your workspace may lose editing capabilities soon due to past-due invoices. Please remit payment to avoid losing access to Notion. If you have any questions, please reach out to billing@makenotion.com."}):(0,b.jsx)(r.FormattedMessage,{id:"subscription.payment_uncollectible.past_due.member",defaultMessage:"Your workspace may lose editing capabilities soon due to past-due invoices. Please remit payment to avoid losing access to Notion. If you have any questions, please reach out to billing@makenotion.com."});case"uncollectible_unpaid":return t?(0,b.jsx)(r.FormattedMessage,{id:"subscription.payment_uncollectible.unpaid.workspace_owner",defaultMessage:"Your workspace is unable to edit due to past-due invoices. Please remit payment to avoid losing access to Notion. If you have any questions, please reach out to billing@makenotion.com."}):(0,b.jsx)(r.FormattedMessage,{id:"subscription.payment_uncollectible.unpaid.member",defaultMessage:"Your workspace is unable to edit due to past-due invoices. Please remit payment to avoid losing access to Notion. If you have any questions, please reach out to billing@makenotion.com."});default:(0,u.t1)(e)}}(o.getBannerKey(),i)}return null}),[a,t,c]);return l?(0,b.jsx)("div",{style:n.bannerContent,children:(0,b.jsx)("div",{children:l})}):null}function g(){const e=(0,o.O7)(),t=(0,s.VK)((()=>p.default.state.currentSpaceStore),[]),n=(0,s.VK)((()=>m.Z.state.visible_banners),[]),[i,r,b,f,g]=(0,s.VK)((()=>{if(!t)return[];if(n&&n.length>0){const e=n[0],a=v.$I.createChildStore(t,{id:e,table:"subscription_banner",spaceId:t.id});if(!a.isDefined())return[];const o=a.getBannerKey(),s=a.getAudience(),i=a.getBannerText();switch(o){case"uncollectible_past_due":return[e,d.v.Yellow,o,s,i];case"uncollectible_unpaid":return[e,d.v.LightRed,o,s,i];default:(0,u.t1)(o)}}return[]}),[t,n]);return a.useEffect((()=>{if(i&&r){if(l.Bw({bannerStore:y.Z,id:"SubscriptionUncollectibleBanner",contentKey:"subscription_uncollectible",styleKey:r,prepend:!0}),b&&f){const t={banner:b,audience:f,text:""};g&&(t.text=g),c.j(e,{name:"subscription_uncollectible_banner_displayed",args:t})}}else l.qL({bannerStore:y.Z,id:"SubscriptionUncollectibleBanner"});return()=>{l.qL({bannerStore:y.Z,id:"SubscriptionUncollectibleBanner"})}}),[e,i,r,b,f,g]),null}},59260:(e,t,n)=>{n.d(t,{U:()=>w,Z:()=>h});var a=n(30120),o=n(67294),s=n(480),i=n(86628),r=n(24405),u=n(37850),c=n(1898),l=n(54642),d=n(35253),p=(n(47307),n(91754)),m=n(68785),y=(n(95477),n(80444)),v=n(21051),b=n(81023),f=n(88893),g=n(88280),_=n(85893);function w(){const{testClock:e,billingInterval:t}=(0,i.VK)((()=>{const e=g.subscriptionDataStoreInstance.state,t=f.aS(e);return t?{testClock:t.testClock,billingInterval:t.interval}:{testClock:void 0,billingInterval:void 0}}),[]),n=(0,i.VK)((()=>{var e;return null===(e=y.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),[d,p]=(0,o.useState)(1),[v,w]=(0,o.useState)("second"),[h,x]=(0,o.useState)(!1),S=(0,s.O7)(),k=(0,r.yK)((e=>({bannerContent:{alignItems:"center",display:"flex",gap:6,justifyContent:"space-between",padding:"12px 6px",whiteSpace:"normal",width:"100%",lineHeight:1.35},message:{flexGrow:1,textWrap:"wrap"}})),[]);if(!e||!t||!n)return null;const C=a.ou.fromSeconds(e.frozen_time);return(0,_.jsxs)("div",{style:k.bannerContent,children:[(0,_.jsxs)("div",{style:k.message,children:["The clock time is currently frozen at ",C.toLocaleString(a.ou.DATETIME_FULL),h?(0,_.jsx)(m.Z,{}):null]}),(0,_.jsxs)("div",{children:[(0,_.jsx)("input",{disabled:h,type:"number",value:d,style:{width:75,textAlign:"right"},onChange:e=>p(parseInt(e.target.value))}),(0,_.jsxs)("select",{disabled:h,value:v,onChange:e=>{w(e.target.value)},children:[(0,_.jsx)("option",{value:"seconds",children:"seconds"}),(0,_.jsx)("option",{value:"minutes",children:"minutes"}),(0,_.jsx)("option",{value:"hours",children:"hours"}),(0,_.jsx)("option",{value:"days",children:"days"}),(0,_.jsx)("option",{value:"months",children:"months"}),(0,_.jsx)("option",{value:"years",disabled:"year"!==t,children:"years"})]}),(0,_.jsx)("button",{disabled:h,onClick:async()=>{const e=a.nL.fromObject({[v]:d}),o=function(e){switch(e){case"month":return a.nL.fromObject({months:2});case"year":return a.nL.fromObject({years:2});default:(0,c.t1)(e)}}(t);if(e>o)return void T(`Cannot advance test clock by more than two billing intervals. The current billing interval is ${t}.`);x(!0);"success"===(await l.stripeAdvanceTestClock(S,{spaceId:n,epochSeconds:C.plus(e).toSeconds()})).type?await async function(e,t){let n=await l.stripeGetTestClock(e,{spaceId:t});for(;"success"===n.type&&"advancing"===n.data.status;)await(0,u.Vs)(1e3),n=await l.stripeGetTestClock(e,{spaceId:t});if("failed"===n.type)return void T("Test clock poll request failed. Refresh page to see updated time.");switch(n.data.status){case"ready":await b.bi(e);break;case"advancing":T("Test clock still advancing");break;case"internal_failure":T("Test clock internal failure");break;case void 0:T("Test clock undefined");break;default:(0,c.t1)(n.data.status)}}(S,n):T("Failed to advance test clock. Check server logs for details."),x(!1)},children:"Advance clock"})]})]})}function h(){const e=(0,i.VK)((()=>{const e=g.subscriptionDataStoreInstance.state,t=f.aS(e);return f.DB(e)&&Boolean(null==t?void 0:t.testClock)}),[]);return o.useEffect((()=>(e?d.Bw({bannerStore:v.Z,id:"TestClockBanner",contentKey:"test_clock",styleKey:p.v.Yellow,prepend:!0}):d.qL({bannerStore:v.Z,id:"TestClockBanner"}),()=>{d.qL({bannerStore:v.Z,id:"TestClockBanner"})})),[e]),null}function T(e){}}}]);