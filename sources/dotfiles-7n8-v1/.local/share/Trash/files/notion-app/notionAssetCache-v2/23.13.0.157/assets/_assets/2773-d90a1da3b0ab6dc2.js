"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[2773],{18533:(e,t,n)=>{n.d(t,{Z:()=>g});var o=n(67294),i=n(480),r=n(86628),s=n(68626),l=n(53965),a=n(52629),d=n(52275),u=n(31945),c=n(78140),p=n(32163),m=n(53437),f=n(72495),h=n(60709),x=n(61766),v=n(94166),y=n(85893);const g=function(e){let{icon:t,title:n,selectedKey:g,onChange:b,onClick:k,popupStyle:S,menuItemOptionsStyle:I,disabled:C,collectionContextStore:M,openButtonPopup:w,hideCheck:T,...j}=e;const F=(0,i.Fy)(),E="options"in j?j.options:l.xH(j.sections),R=E.find((e=>l.Xy(e.key,g))),V=(0,r.qz)(void 0,x.Z),A=(0,r.Kw)(V);return(0,o.useEffect)((()=>{M&&w&&(V.setState({...V.state,open:w}),M.settingsStore.setState({...M.settingsStore.state,openButtonPopup:void 0})),R||s.log({level:"error",from:"CollectionSettingsPickListMenuItem",type:"InvalidSelectedItem",error:(0,a.Ui)("Selected key is invalid.")})})),(0,y.jsx)(u.ZP,{popupType:F.isMobile?m.kQ.SlideUp:m.kQ.Popup,alignmentToOrigin:u.vR.End,placementToOrigin:u.pO.Bottom,style:S,originGap:0,buttonPopupStore:V,disabled:C,onClick:k,renderOrigin:e=>(0,y.jsx)(v.Z,{title:n,showChevron:!0,right:null==R?void 0:R.title,rotateChevron:A.open,disabled:C,icon:t,...e}),render:e=>{let t;t=F.isMobile?{menuType:h.og.ActionSheet}:{menuType:h.og.Popup,width:250};const n=(t,n)=>({key:n,render:e=>(0,y.jsx)(d.Z,{...e,disabled:!1,title:t.title,icon:t.icon,caption:t.caption,captionStyle:t.captionStyle,inline:t.captionInline,spacerStyle:t.inlineSpacerStyle,body:t.body,style:I,checkState:!T&&l.Xy(t.key,g)}),action:()=>{b(t.key),e.close()}}),o="sections"in j?j.sections.map(((e,t)=>({key:t,render:e=>(0,y.jsx)(f.Z,{enableActionSheetTitle:!0,topBorder:t>0,...e}),items:l.oA(e.map(n))}))):[{key:0,render:e=>(0,y.jsx)(f.Z,{enableActionSheetTitle:!0,...e}),items:l.oA(E.map(n))}];return(0,y.jsx)(c.Z,{...t,children:(0,y.jsx)(p.Z,{type:p.i.Vertical,sections:o,initialFocus:0})})}})}},65668:(e,t,n)=>{n.d(t,{Z:()=>dt});n(57658);var o=n(67294),i=n(480),r=n(86628),s=n(24405),l=n(73717),a=n(50610),d=n(35102),u=n(66673),c=n(54497),p=n(70203),m=n(9291),f=n(53965),h=n(40470),x=n(1898),v=n(37810),y=n(98104),g=n(68657),b=n(68056),k=n(24666),S=n(3386),I=n(12396),C=n(84619),M=n(73110),w=n(89679),T=n(77097);const j={true:{name:"true",type:{type:"checkbox"},description:T.Gw.true,examples:[{input:"true"},{input:[(0,w.h0)("Checked"),[" == true"]]}]},false:{name:"false",type:{type:"checkbox"},description:T.Gw.false,examples:[{input:"false"},{input:[(0,w.h0)("Checked"),[" == false"]]}]},and:{name:"and",type:{type:"checkbox"},description:T.Gw.and,examples:[{input:"3 > 2 and 2 > 3",output:"false"},{input:[(0,w.h0)("Naughty"),[" && "],(0,w.h0)("Nice")]}]},or:{name:"or",type:{type:"checkbox"},description:T.Gw.or,examples:[{input:"3 > 2 or 2 > 3",output:"true"},{input:[(0,w.h0)("Naughty"),[" || "],(0,w.h0)("Nice")]}]},not:{name:"not",type:{type:"checkbox"},description:T.Gw.not,examples:[{input:"not true",output:"false"},{input:"not (2 > 3)",output:"true"},{input:[["!"],(0,w.h0)("Checked")]}]},"+":{name:"+",type:{type:"number"},description:T.Gw["+"],examples:[{input:"3 + 2",output:"5"},{input:"add(-1, 2)",output:"1"}]},"-":{name:"-",type:{type:"number"},description:T.Gw["-"],examples:[{input:"3 - 2",output:"1"},{input:"subtract(-1, 2)",output:"-3"}]},"*":{name:"*",type:{type:"number"},description:T.Gw["*"],examples:[{input:"3 * 2",output:"6"},{input:"multiply(-1, 2)",output:"-2"}]},"/":{name:"/",type:{type:"number"},description:T.Gw["/"],examples:[{input:"3 / 2",output:"1.5"},{input:"divide(-1, 2)",output:"-0.5"}]},"%":{name:"%",type:{type:"number"},description:T.Gw["%"],examples:[{input:"3 % 2",output:"1"},{input:"mod(-1, 2)",output:"-1"}]},"^":{name:"^",type:{type:"number"},description:T.Gw["^"],examples:[{input:"3 ^ 2",output:"9"},{input:"pow(-1, 2)",output:"1"}]},"==":{name:"==",type:{type:"checkbox"},description:T.Gw["=="],examples:[{input:"3 == 2",output:"false"},{input:'equal("A", "A")',output:"true"}]},"!=":{name:"!=",type:{type:"checkbox"},description:T.Gw["!="],examples:[{input:"3 != 2",output:"true"},{input:'unequal("A", "A")',output:"false"}]},">":{name:">",type:{type:"checkbox"},description:T.Gw[">"],examples:[{input:"3 > 2",output:"true"},{input:'now() > parseDate("2040-01-01")',output:"false"}]},"<":{name:"<",type:{type:"checkbox"},description:T.Gw["<"],examples:[{input:"3 < 2",output:"false"},{input:'now() < parseDate("2040-01-01")',output:"true"}]},">=":{name:">=",type:{type:"checkbox"},description:T.Gw[">="],examples:[{input:"3 >= 2",output:"true"},{input:'now() >= parseDate("2040-01-01")',output:"false"}]},"<=":{name:"<=",type:{type:"checkbox"},description:T.Gw["<="],examples:[{input:"3 <= 2",output:"false"},{input:'now() <= parseDate("2040-01-01")',output:"true"}]}};var F=n(75e3),E=n(56505),R=n(33929),V=n(60709),A=n(29798),B=n(73657),D=n(64921),N=n(52275),P=n(31945),O=n(78140),G=n(28992),Z=n(32163),U=n(40721),L=n(72495),_=n(42875),K=n(75553),W=n(20852),H=n(82883),z=n(38585),$=n(893),Q=n(95477),Y=n(60682),X=n(24990),q=n(62619),J=n(55227),ee=n(77907),te=n(80444),ne=n(77080),oe=n(73063),ie=n(85893);const re=o.memo((e=>{let{infoHelper:t,getRecordModel:n,style:o}=e;const i=t;if(void 0===(null==i?void 0:i.kind))return null;switch(i.kind){case M.x2.Token:return(0,ie.jsx)(ae,{completion:i,getRecordModel:n,style:o});case M.x2.LibraryFunction:{const e=!(null==t||!t.calledFromUnifiedFunctionProperty),r=function(e,t){if(t&&void 0!==e.syntax[1])return e.syntax[1];return e.syntax[0]}(i.libraryFunction,e),s=function(e,t){if(t&&void 0!==e.examples[1])return e.examples[1];return e.examples[0]}(i.libraryFunction,e),l=i.libraryFunction.returnType;return(0,ie.jsx)(le,{icon:ye("function"==typeof l?l([]).type:l.type),name:r,description:R.default.formatMessage(i.libraryFunction.description),examples:s.length>0?s.map(((e,t)=>(0,ie.jsx)(se,{example:e,getRecordModel:n},t))):void 0,style:o})}case M.x2.Binding:var r;return i.text===M.GV?(0,ie.jsx)(le,{icon:ye(i.type.type),name:i.text,description:R.default.formatMessage(pe.currentValueDescription),style:o}):i.text===M.WY?(0,ie.jsx)(le,{icon:ye(i.type.type),name:i.text,description:R.default.formatMessage(pe.currentIndexDescription),style:o}):(0,ie.jsx)(le,{icon:ye(i.type.type),name:i.text,description:R.default.formatMessage("array"===(null==i||null===(r=i.type)||void 0===r?void 0:r.type)?pe.listVariableType:pe.variableType),style:o});case M.x2.Builtin:{const e=j[i.builtin];return(0,ie.jsx)(le,{icon:ye(e.type.type),name:e.name,description:R.default.formatMessage(e.description),examples:e.examples.length>0?e.examples.map(((e,t)=>(0,ie.jsx)(se,{example:e,getRecordModel:n},t))):void 0,style:o})}default:return(0,x.t1)(i)}}));function se(e){let{example:t,getRecordModel:n}=e;const l=(0,ee.useDependency)(ee.deps.prismjs),a=(0,Y.kw)(),d=(0,i.O7)(),{device:u}=d,c=(0,r.VK)((()=>{var e;return null===(e=te.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),h=(0,s.Fg)(),x=(0,m.useIntl)(),v=(0,r.VK)((()=>X.Z.state),[]),y=(0,r.VK)((()=>{var e;const o=document.createElement("div"),i="string"!=typeof t.input?p.QaF(t.input):t.input,r=(null===(e=l.value)||void 0===e?void 0:e.highlight(`${i}`,l.value.languages[W.PrismLanguages.notion],W.PrismLanguages.notion))??"";o.innerHTML=J.g7(r);const s=f.oA(Array.from(o.childNodes).map(ue)),m="string"==typeof t.input?[[t.input],[" = "]]:t.input.concat([[" = "]]),y=J.kF(m,f.oA(s)),g=m.map(p.hDy).map(((e,t)=>z.fn({annotations:e,theme:h,getRecordModel:n,spaceId:c})));return y.map(((e,t)=>{const o=g[e.textTokenIndex],i=m[e.textTokenIndex];return p.km_(i)?(0,z.$i)({args:{textValue:{value:m,spaceId:c},getRecordModel:n,getRecordRole:()=>{},disableHover:!1,disableStyleAnnotations:!1,disableInsertedDeletedAnnotations:!1,disableDateStyleAnnotations:!1,disableLinks:!1,userTimeZone:(0,_.r)(),disabled:!1,isAndroid:u.isAndroid,isSafariOrIOS:u.isSafari||u.isIOS,isWindows:u.isWindows,showEmojiInline:u.isWindows,emojiType:a,highlightDiscussionId:void 0,theme:h,intl:x,renderedPageBlockId:void 0,parentBlockId:void 0,katex:void 0,isClient:!0,baseUrl:Q.default.domainBaseUrl,publicDomainName:Q.default.publicDomainName,currentUserId:d.currentUser.id,overwriteBaseUrlFromSpaceId:void 0,externalIntegrations:[],formulaValueTypes:[],emojiData:v,isMobileNative:u.isMobileNative,isMobileNativeExternalLinkFixEnabled:ne.default.checkGate("mobile_native_external_link_fix"),displayInUserTimezone:ne.default.checkGate("display_date_in_user_timezone")},style:o.style,classNames:o.classNames,index:t,token:i,tokenValue:p.WiV(i),tokenAnnotations:p.hDy(i)}):(0,ie.jsx)("span",{className:[e.classNames||"",...o.classNames].join(" "),style:o.style,"data-token-index":e.textTokenIndex,children:e.value},t)}))}),[t.input,l.value,h,n,c,u.isAndroid,u.isSafari,u.isIOS,u.isWindows,u.isMobileNative,a,x,d.currentUser.id,v]),g=(0,r.VK)((()=>Array.isArray(t.output)?(0,z.IY)({textValue:{value:t.output,spaceId:c},getRecordModel:n,getRecordRole:()=>{},disableHover:!1,disableStyleAnnotations:!1,disableInsertedDeletedAnnotations:!1,disableDateStyleAnnotations:!1,disableLinks:!1,userTimeZone:(0,_.r)(),disabled:!1,isAndroid:u.isAndroid,isSafariOrIOS:u.isSafari||u.isIOS,isWindows:u.isWindows,showEmojiInline:u.isWindows,emojiType:a,theme:h,intl:x,katex:void 0,isClient:!0,baseUrl:Q.default.domainBaseUrl,publicDomainName:Q.default.publicDomainName,currentUserId:d.currentUser.id,overwriteBaseUrlFromSpaceId:void 0,externalIntegrations:[],formulaValueTypes:[],emojiData:v,isMobileNative:u.isMobileNative,isMobileNativeExternalLinkFixEnabled:ne.default.checkGate("mobile_native_external_link_fix"),displayInUserTimezone:ne.default.checkGate("display_date_in_user_timezone")}):t.output),[u.isAndroid,u.isIOS,u.isSafari,u.isWindows,u.isMobileNative,v,a,d.currentUser.id,t.output,n,x,c,h]),b=!1!==t.isCopyable&&("string"==typeof t.input||!0===t.isCopyable),k=(0,o.useCallback)((()=>{if(b){const e=(Array.isArray(t.input)?(0,H.X)({intl:x,textValue:t.input,getRecordModel:n,userTimeZone:(0,_.r)()}):t.input).replaceAll(/\/\*.*\*\//g,"").trim();$.RD({stringValue:e,environment:d,copiedMessage:ce.copiedExampleMessage})}}),[d,t.input,n,x,b]),S=(0,s.yK)((e=>({code:{fontFamily:"monospace",whiteSpaceCollapse:"preserve",fontSize:11,borderRadius:5,border:`1px solid ${e.stroke.deemphasized}`,margin:"0 -4px",padding:"0 6px",pointerEvents:"none",opacity:.95,display:"flex",flexDirection:"row",alignItems:"center",tabSize:2},left:{flexGrow:1,padding:"6px 0"},right:{alignSelf:"center"},copyButton:{height:22,width:22,pointerEvents:"auto"},copyButtonIcon:{height:12,width:12}})),[]);return(0,ie.jsxs)("div",{style:S.code,children:[(0,ie.jsxs)("div",{style:S.left,children:[(0,ie.jsx)("div",{children:y}),g?(0,ie.jsxs)("div",{children:["= ",g]}):null]}),b?(0,ie.jsx)("div",{style:S.right,children:(0,ie.jsx)(oe.Z,{ariaLabel:x.formatMessage(ce.copyToClipboard),onClick:k,icon:K.U,style:S.copyButton,iconStyle:S.copyButtonIcon,disallowTabbing:!0})}):null]})}function le(e){let{name:t,icon:n,description:o,examples:i,style:r}=e;const l=(0,s.yK)((e=>({helper:{display:"flex",flexDirection:"column",fontSize:12,height:"auto",width:"100%",gap:8,overflow:"auto",textWrap:"wrap",...r},name:{fontSize:14,fontWeight:600,display:"flex",alignItems:"center"},description:{color:e.mediumTextColor},iconStyle:{height:14,width:14,fill:e.mediumIconColor,display:"inline",marginRight:6},divider:{borderColor:e.stroke.deemphasized},examples:{display:"flex",flexDirection:"column",gap:4}})),[r]);return(0,ie.jsxs)("div",{style:l.helper,children:[(0,ie.jsxs)("span",{style:l.name,children:[void 0!==n&&n(l.iconStyle),t]}),void 0!==o&&(0,ie.jsx)("span",{style:l.description,children:o}),void 0!==i&&(0,ie.jsx)("div",{style:l.examples,children:i})]})}function ae(e){let{completion:t,getRecordModel:n,style:o}=e;const{name:i,description:s,icon:l,examples:a}=(0,r.VK)((()=>{if(!n)return{};if(t.token.type===M.Oy.BlockProperty){var e;if(M.WG.includes(t.token.property)&&!t.token.collection){var o;const e=null===(o=M.dy[t.token.property])||void 0===o?void 0:o.type,i=e?I.wG[e]:void 0,r=w.QP[t.token.property],s="function"==typeof(null==r?void 0:r.description)?r.description():null==r?void 0:r.description,l=t.name??t.token.property;return{name:l,icon:i,description:s?R.default.formatMessage(s):void 0,examples:null!==r?de(r,n,{collection:t.token.collection,property:t.token.property,name:l},{name:l,type:t.token.property}):void 0}}if(!t.token.collection)return{};const i=(0,d.SR)(t.token.property),r=n(t.token.collection),s=null==r||null===(e=r.getNormalizedSchema())||void 0===e?void 0:e[i];if(!s)return{};const l=w.QP[s.type];return l?{name:t.name,icon:I.wG[s.type],description:R.default.formatMessage("function"==typeof l.description?l.description(s):l.description),examples:de(l,n,{collection:t.token.collection,property:i,name:t.name},s)}:{}}return{}}),[t,n]);return void 0===i?null:(0,ie.jsx)(le,{name:i,icon:l,description:s,examples:a,style:o})}function de(e,t,n,o){const i=e.examples;let r=[];return r="function"==typeof i?i(n,o).map(((e,n)=>(0,ie.jsx)(se,{example:e,getRecordModel:t},n))):i.map(((e,n)=>(0,ie.jsx)(se,{example:e,getRecordModel:t},n))),r.length>0?r:void 0}function ue(e){return q.Gs(e)?[e.data]:q.kK(e)?[e.textContent||"",e.className]:void 0}const ce=(0,m.defineMessages)({codeExamples:{id:"formula2Input.helperText.codeExamples",defaultMessage:"Examples"},copiedExampleMessage:{id:"formula2Input.helperText.copiedExampleMessage",defaultMessage:"Copied example to clipboard!"},copyToClipboard:{defaultMessage:"Copy to Clipboard",id:"database.copyButton.copyToClipboard"}}),pe=(0,m.defineMessages)({currentValueDescription:{id:"formula2Input.helperText.currentValueDescription",defaultMessage:"Returns the value of the current item in the list function."},currentIndexDescription:{id:"formula2Input.helperText.currentIndexDescription",defaultMessage:"Returns the index of the current item in the list function, starting from 0."},variableType:{id:"formula2Input.variableHelper.description",defaultMessage:"User-defined variable."},listVariableType:{id:"formula2Input.variableHelper.descriptionWithList",defaultMessage:"User-defined variable, list."},emailForUser:{id:"formula2Input.helperText.emailForUser",defaultMessage:"Returns the email address of a provided user."},nameForUser:{id:"formula2Input.helperText.nameForUser",defaultMessage:"Returns the display name of a provided user."}});var me=n(21396);function fe(e){const{store:t,selection:n,cursorEditorInfo:l,cursorEditorInfoRef:a,context:u,onChange:c,getRecordModel:m,setInfoHelper:h}=e,v=(0,s.yK)((()=>({menu:{top:0,left:0,right:0,bottom:0,position:"absolute",marginBottom:2},menuSection:{paddingTop:6,paddingBottom:2}})),[]),y=(0,i.Fy)(),g=(0,r.qz)(void 0,A.Z),b=(0,o.useMemo)((()=>{const e=f.vM((null==l?void 0:l.completions)??[],"kind");let o=-1;return Object.entries(e).map(((e,i)=>{const[r,s]=e,l=s.map(((e,r)=>{o+=1;const s=o;return{key:`${i}-${r}`,render:t=>(0,ie.jsx)(he,{...t,completion:e,context:u,getRecordModel:m,menuListStore:g,indexGlobal:s,cursorEditorInfoRef:a,setInfoHelper:h}),action:()=>{var o;void 0!==e&&a.current&&(h({...e,calledFromUnifiedFunctionProperty:"member dot receiver"===(null===(o=a.current.completionsInfo)||void 0===o?void 0:o.type)}),function(e){var t;const{completion:n,store:o,selection:i,onChange:r,cursorEditorInfo:s}=e,l=(null==i?void 0:i.startIndex)||0,a=(null==i?void 0:i.endIndex)||0,u=l!==a,c=(null===(t=s.completionsInfo)||void 0===t?void 0:t.prefix)||"",m="overridePrefixLength"in n?n.overridePrefixLength??0:c.length,f=u?l:a-m,h=o.getValue();if(n.kind===M.x2.Token){if(n.token.type===M.Oy.Checkbox)return;if(n.token.type===M.Oy.BlockProperty){const e=(0,p._QS)(h,f,a),t=n.token.collection?(0,d.SR)(n.token.property):n.token.property,o=(0,p.YCD)((0,p.kbv)({collection:n.token.collection,property:t,name:n.name}));return void r({newValue:(0,p.P$X)(e,[o],f),newSelection:{startIndex:f+1,endIndex:f+1}})}if(n.token.type===M.Oy.ContextValue){const e=(0,p._QS)(h,f,a),t=(0,d.Kv)(n.token.valueId),o=(0,p.YCD)((0,p._QF)({id:t}));r({newValue:(0,p.P$X)(e,[o],f),newSelection:{startIndex:f+1,endIndex:f+1}})}else{if(n.token.type===M.Oy.Date||n.token.type===M.Oy.Block||n.token.type===M.Oy.Person)return;(0,x.t1)(n.token)}}else if(n.kind===M.x2.LibraryFunction){var v,y,g,b;const e=(0,p._QS)(h,f,a),t=(0,p.V3y)(`${n.libraryFunction.name}()`,[]),o=(0,p.P$X)(e,[t],f);let i=f+n.libraryFunction.name.length+1;void 0!==(null===(v=n.libraryFunction)||void 0===v||null===(v=v.parameters)||void 0===v?void 0:v.varargs)||null!==(y=n.libraryFunction)&&void 0!==y&&null!==(y=y.parameters)&&void 0!==y&&null!==(y=y.expected)&&void 0!==y&&y.length&&(1!==(null===(g=n.libraryFunction)||void 0===g||null===(g=g.parameters)||void 0===g||null===(g=g.expected)||void 0===g?void 0:g.length)||"member dot receiver"!==(null===(b=s.completionsInfo)||void 0===b?void 0:b.type))||(i+=1);r({newValue:o,newSelection:{startIndex:i,endIndex:i}})}else if(n.kind===M.x2.Binding||n.kind===M.x2.Builtin){const e=(0,p._QS)(h,f,a),t=n.kind===M.x2.Binding?n.text:`${n.builtin} `,o=(0,p.V3y)(t,[]),i=(0,p.P$X)(e,[o],f),s=f+t.length;r({newValue:i,newSelection:{startIndex:s,endIndex:s}})}else(0,x.t1)(n)}({completion:e,store:t,selection:n,onChange:c,cursorEditorInfo:a.current}))}}}));return{key:r,render:e=>(0,ie.jsx)(L.Z,{...e,style:v.menuSection,title:R.default.formatMessage(ke[r])}),items:l}}))}),[u,null==l?void 0:l.completions,a,m,g,c,n,h,t,v.menuSection]),k=(0,o.useCallback)((e=>{var t;if(y.isMobile)return;const n=void 0!==e.indexGlobal?null===(t=a.current)||void 0===t||null===(t=t.completions)||void 0===t?void 0:t[e.indexGlobal]:void 0;var o;n&&h({...n,calledFromUnifiedFunctionProperty:"member dot receiver"===(null===(o=a.current)||void 0===o||null===(o=o.completionsInfo)||void 0===o?void 0:o.type)})}),[a,y.isMobile,h]);let S;return(0,o.useEffect)((()=>{if(y.isMobile)return;const e=e=>{var t,n;if(void 0!==e.state.focus.indexGlobal&&null!==(t=a.current)&&void 0!==t&&t.completions&&(null===(n=a.current)||void 0===n?void 0:n.completions.length)>0){var o;const t=null===(o=a.current)||void 0===o||null===(o=o.completions)||void 0===o?void 0:o[e.state.focus.indexGlobal];void 0!==t&&h((e=>{var n;return void 0===e||void 0===(null===(n=a.current)||void 0===n?void 0:n.callParameter)?t:e}))}};return g.addListener(e),()=>g.removeListener(e)}),[a,g,h,y.isMobile]),(0,o.useEffect)((()=>{var e,t,n,o;if(y.isMobile)return;const i="function"===(null==l||null===(e=l.callParameter)||void 0===e||null===(e=e.expression)||void 0===e||null===(e=e.type)||void 0===e?void 0:e.type)?null===(t=l.callParameter.expression)||void 0===t?void 0:t.type:void 0;void 0!==i&&void 0!==(null==l||null===(n=l.callParameter)||void 0===n?void 0:n.parameterIndex)&&(null==l||null===(o=l.callParameter)||void 0===o?void 0:o.parameterIndex)>-1&&h({kind:M.x2.LibraryFunction,libraryFunction:i.libraryFunction,calledFromUnifiedFunctionProperty:i.calledFromUnifiedFunctionProperty})}),[null==l?void 0:l.callParameter,y.isMobile,h]),(0,o.useEffect)((()=>{b.length>0&&g.update((e=>({focus:{...e,section:0,indexLocal:0,indexGlobal:0}})))}),[b.length,g,h]),S=y.isPhone?{menuType:V.og.ActionSheet,disableBottomPadding:!0,maxHeight:"100%"}:{menuType:V.og.Popup,width:y.isPhone?180:228,minWidth:y.isPhone?180:228,maxWidth:y.isPhone?180:228},(0,ie.jsx)(O.Z,{...S,scrollerStyle:v.menu,children:(0,ie.jsx)(Z.Z,{type:Z.i.Vertical,initialFocus:0,priority:1,store:g,onKeyboardArrow:k,sections:f.oA([...b,0===b.length&&{key:"no-results",render:e=>(0,ie.jsx)(L.Z,{...e,disableDesktopPadding:!0,style:v.menuSection,children:(0,ie.jsx)(ge,{})}),items:[]}])})})}const he=o.forwardRef(((e,t)=>{const{completion:n,context:l,getRecordModel:a,menuListStore:u,indexGlobal:c,cursorEditorInfoRef:p,setInfoHelper:f,onMouseEnter:h,...v}=e,y=(0,i.Fy)(),g=(0,s.yK)((e=>({icon:{width:14,fill:e.mediumIconColor},lightParens:{color:e.lightTextColor}})),[]),b=(0,o.useCallback)((e=>{if(!y.isMobile){var t;const e=null===(t=p.current)||void 0===t||null===(t=t.completions)||void 0===t?void 0:t[c];f(e)}null==h||h(e)}),[p,c,h,f,y.isMobile]),k=(0,r.VK)((()=>u.state.focus.indexGlobal===c),[u,c]),S=(0,o.useMemo)((()=>y.isMobile?(0,ie.jsx)(P.ZP,{popupType:P.Z4.SlideUp,renderOrigin:e=>(0,ie.jsx)(D.Z,{mobileFeedback:!0,style:{width:16,height:16},...e,children:(0,E.S)(g.icon)}),render:e=>{var t;let o;return o=y.isMobile?{menuType:V.og.Modal,title:(0,ie.jsx)(m.FormattedMessage,{defaultMessage:"Documentation",id:"database.formulaPropertyEntryMenuItem.title"}),right:(0,ie.jsx)(U.DoneMenuText,{}),onClickRight:e.close}:{menuType:V.og.Popup},(0,ie.jsx)(O.Z,{...o,children:(0,ie.jsx)(L.Z,{children:(0,ie.jsx)(G.Z,{title:(0,ie.jsx)(re,{infoHelper:{...n,calledFromUnifiedFunctionProperty:"member dot receiver"===(null==p||null===(t=p.current)||void 0===t||null===(t=t.completionsInfo)||void 0===t?void 0:t.type)},getRecordModel:a,style:{padding:4}}),style:{paddingTop:16,paddingBottom:16}})})})}}):(0,ie.jsx)(xe,{visible:k})),[n,p,y.isMobile,a,k,g.icon]),w=(0,r.VK)((()=>{var e;if(n.kind!==M.x2.Token||n.token.type!==M.Oy.BlockProperty||!a)return;if(M.WG.includes(n.token.property))return n.token.property;if(!n.token.collection)return;const t=(0,d.SR)(n.token.property),o=a(n.token.collection);return null==o||null===(e=o.getNormalizedSchema())||void 0===e||null===(e=e[t])||void 0===e?void 0:e.type}),[n,a]);if(n.kind===M.x2.Token){if(n.token.type===M.Oy.Checkbox)return null;if(n.token.type===M.Oy.BlockProperty)return(0,ie.jsx)(N.Z,{...v,icon:w?I.wG[w](g.icon):(0,ie.jsx)(ve,{type:"unknown"}),title:n.name??n.token.property,right:S,onMouseEnter:b,ref:t});if(n.token.type===M.Oy.ContextValue){const e=(0,d.vx)(l.valueTypes,(0,d.Kv)(n.token.valueId));return e?(0,ie.jsx)(N.Z,{...v,icon:(0,ie.jsx)(ve,{type:e.type.type}),title:(0,ie.jsx)("div",{style:{display:"flex"},children:(0,ie.jsx)(me.F,{value:e,format:C.lo.Medium,isSingle:!0,shouldShrink:!0})}),right:S,onMouseEnter:b,ref:t}):null}if(n.token.type===M.Oy.Date)return null;if(n.token.type===M.Oy.Block)return null;if(n.token.type===M.Oy.Person)return null;(0,x.t1)(n.token)}else{if(n.kind===M.x2.LibraryFunction){const e=n.libraryFunction.returnType;return(0,ie.jsx)(N.Z,{...v,icon:(0,ie.jsx)(ve,{type:"function"==typeof e?e([]).type:e.type}),title:(0,ie.jsxs)(ie.Fragment,{children:[n.libraryFunction.name,(0,ie.jsx)("span",{style:g.lightParens,children:"()"})]}),right:S,onMouseEnter:b,ref:t})}if(n.kind===M.x2.Builtin)return(0,ie.jsx)(N.Z,{...v,title:n.builtin,icon:(0,ie.jsx)(ve,{type:j[n.builtin].type.type}),right:S,onMouseEnter:b,ref:t});if(n.kind===M.x2.Binding)return(0,ie.jsx)(N.Z,{...v,title:n.text,icon:(0,ie.jsx)(ve,{type:n.type.type}),right:S,onMouseEnter:b,ref:t});(0,x.t1)(n)}})),xe=o.memo((e=>{let{visible:t}=e;const n=(0,s.yK)((e=>({icon:{width:14,fill:e.mediumIconColor,transition:"opacity 50ms 200ms",visibility:t?"visible":"hidden",opacity:t?1:0}})),[t]);return(0,F.U)(n.icon)})),ve=o.memo((e=>{var t;let{type:n}=e;const o=(0,s.yK)((e=>({icon:{width:14,fill:e.mediumIconColor,transition:"transform .3s ease"}})),[]);return null===(t=ye(n))||void 0===t?void 0:t(o.icon)}));function ye(e){return"text"===e?I.wG.text:"number"===e?I.wG.number:"checkbox"===e?I.wG.checkbox:"date"===e?I.wG.date:"block"===e?I.wG.relation:"person"===e?I.wG.person:"select"===e?I.wG.select:"array"===e?I.wG.multi_select:"function"===e||void 0===e||"unknown"===e?I.wG.formula:void(0,x.t1)(e)}function ge(){return(0,ie.jsx)(B.Z,{caption:(0,ie.jsx)(m.FormattedMessage,{defaultMessage:"No results",id:"FormulaAutocompleteMenu.noResults.message"})})}const be=(0,m.defineMessages)({[M.x2.Token]:{defaultMessage:"Properties",id:"formulaAutocompleteMenu.token.message"},[M.x2.LibraryFunction]:{defaultMessage:"Functions",id:"formulaAutocompleteMenu.function.message"},[M.x2.Binding]:{defaultMessage:"Variables",id:"formulaAutocompleteMenu.variables.message"},[M.x2.Builtin]:{defaultMessage:"Built-ins",id:"formulaAutocompleteMenu.builtin.message"}}),ke={[M.x2.Token]:be[M.x2.Token],[M.x2.LibraryFunction]:be[M.x2.LibraryFunction],[M.x2.Binding]:be[M.x2.Binding],[M.x2.Builtin]:be[M.x2.Builtin]};var Se=n(37652),Ie=n(84169),Ce=n(62134),Me=n(18514),we=n(89728),Te=n(58297),je=n(26388);const Fe={alignSelf:"right",marginRight:4,height:24,padding:"0 8px"},Ee=(0,m.defineMessages)({accept:{defaultMessage:"Accept",id:"database.formula.acceptFormulaInput.tooltip"},back:{defaultMessage:"Back",id:"formulas.SimpleFormulaValuePicker.back"},close:{id:"formula2Input.close",defaultMessage:"Close"},done:{id:"formula2Input.done",defaultMessage:"Done"},formulaHeader:{id:"formula2Input.NotionFormula",defaultMessage:"Notion Formula"},learnTooltip:{id:"formula2Input.learnAboutFormulas",defaultMessage:"Learn about formulas!"},revert:{id:"formula2Input.revert",defaultMessage:"Revert"},revertTooltip:{id:"formula2Input.revertTooltip",defaultMessage:"Revert to previous formula"}}),Re=o.memo((e=>{const{onClickBack:t,onClickClose:n,onClickRevert:o,showRevert:i,disabled:r}=e,l=(0,s.yK)((e=>({headerRow:{display:"flex",color:e.mediumTextColor,flexDirection:"row",padding:"8px 2px 6px 12px",flexWrap:"wrap",fontWeight:500},headerLeft:{flexGrow:1,fontSize:14,display:"inline-flex",alignItems:"center"}})),[]);return(0,ie.jsxs)("span",{style:l.headerRow,children:[(0,ie.jsx)("span",{style:l.headerLeft,children:t?(0,ie.jsx)(Ve,{onClick:t}):(0,ie.jsx)(De,{})}),i?(0,ie.jsx)(Ne,{onClick:o}):null,r?(0,ie.jsx)(Ae,{onClick:n}):(0,ie.jsx)(Be,{onClick:n})]})}));function Ve(e){const{onClick:t}=e,n=(0,m.useIntl)();return(0,ie.jsx)(we.Z,{isGray:!0,isSmall:!0,icon:Se.V,onClick:t,children:n.formatMessage(Ee.back)})}function Ae(e){const{onClick:t}=e,n=(0,m.useIntl)();return(0,ie.jsx)(Te.Z,{onClick:t,style:Fe,children:n.formatMessage(Ee.close)})}function Be(e){const{onClick:t}=e,n=(0,i.O7)(),o=(0,m.useIntl)(),r=(0,s.yK)((e=>({commandText:{color:e.mediumInvertedTextColor}})),[]);return(0,ie.jsx)(je.ZP,{renderTooltip:()=>(0,ie.jsxs)("div",{children:[(0,ie.jsx)("span",{children:o.formatMessage(Ee.accept)})," ",(0,ie.jsxs)("span",{style:r.commandText,children:[Ce.fg(n).command,"+Enter"]})]}),render:e=>(0,ie.jsx)(Te.Z,{onClick:t,style:Fe,...e,children:o.formatMessage(Ee.done)})})}function De(){const e=(0,m.useIntl)(),t=(0,s.yK)((()=>({headerTitle:{fontSize:12,display:"flex",alignItems:"center"},helpButton:{marginLeft:2,height:20,width:20}})),[]);return(0,ie.jsxs)("span",{style:t.headerTitle,children:[e.formatMessage(Ee.formulaHeader),(0,ie.jsx)(je.ZP,{placement:je.ug.Top,render:n=>(0,ie.jsx)(oe.Z,{...n,ariaLabel:e.formatMessage(Ee.learnTooltip),icon:Ie.m,href:(0,Me.UY)("guides.formulas"),external:!0,style:t.helpButton}),renderTooltip:()=>e.formatMessage(Ee.learnTooltip)})]})}function Ne(e){const{onClick:t}=e,n=(0,m.useIntl)(),o=(0,s.yK)((e=>({revertButton:{marginLeft:4,marginRight:4,color:e.mediumIconColor}})),[]);return(0,ie.jsx)(je.ZP,{placement:je.ug.Top,render:e=>(0,ie.jsx)(we.Z,{...e,"aria-label":n.formatMessage(Ee.revertTooltip),isGray:!0,isSmall:!0,style:o.revertButton,onClick:t,children:n.formatMessage(Ee.revert)}),renderTooltip:()=>n.formatMessage(Ee.revertTooltip)})}n(52262),n(24506);var Pe=n(83355),Oe=n(1302),Ge=n(13991),Ze=n(14577),Ue=n(15095),Le=n(62193),_e=n(6746),Ke=n(52423),We=n(993),He=n(56971),ze=n(13447),$e=n(14976),Qe=n(45023),Ye=n(89086),Xe=n(5873),qe=n(30874),Je=n(29595),et=n(1743),tt=n(93262);const nt={flexGrow:1,flexShrink:1,textAlign:"left",fontFamily:v.Z.getCompositeFontFamily(Ge.SP).githubMono,fontSize:12,tabSize:2,whiteSpace:"pre-wrap",borderRadius:4,minHeight:"1em",height:"100%",wordBreak:"break-all",paddingLeft:12,paddingRight:13,paddingBottom:10};class ot extends Pe.Z{constructor(){super(...arguments),this.editor=null,this.mergeEditorRefs=(0,Le.sH)(),this.renderContentContainer=(e,t)=>{let{leafRef:n,wrapperRef:i,...r}=e;const{device:s}=this.environment;return(0,ie.jsx)("div",{ref:i,...r,onKeyDown:e=>{!function(e,t,n){(0,Qe.Z)(n,e,"command+enter")&&(t(),e.stopPropagation())}(e,this.props.handleSave,this.environment),null==r||r.onKeyDown(e)},style:{flexGrow:1,display:"table"},children:(0,ie.jsx)(Je.Z,{ref:this.mergeEditorRefs(this.editorRef,n),style:nt,getDisabled:()=>this.props.disabled,getHtml:()=>function(e,t,n,i,r,s,l,a,d,u,c,m,h){const x=p.QaF(e),v="notion",y=n.languages[v],g=document.createElement("div"),b=n.highlight(x,y,v);g.innerHTML=J.g7(b);const k=f.oA(Array.from(g.childNodes).map(rt));for(const o of t)e=p.aSf({textValue:e,selection:o,annotation:[p.GKr.FormulaError]});const S=function(e){let{syntaxTokens:t,textValue:n,store:o,parentSpaceId:i,valueTypes:r,theme:s,isAndroid:l,isSafariOrIOS:a,isWindows:d,isMobileNative:u,currentUserId:c,overwriteBaseUrlFromSpaceId:m}=e;const f=J.kF(n,t),h=n.map(p.hDy).map(((e,t)=>z.fn({annotations:e,theme:s,getRecordModel:o.getRecordModel,spaceId:i})));return f.map(((e,t)=>{const f=n[e.textTokenIndex],x=h[e.textTokenIndex];return p.km_(f)?(0,z.$i)({args:{textValue:{value:n,spaceId:i},getRecordModel:o.getRecordModel,getRecordRole:o.getRecordRole,disableHover:!1,disableStyleAnnotations:!1,disableInsertedDeletedAnnotations:!1,disableDateStyleAnnotations:!1,disableLinks:!1,userTimeZone:(0,_.r)(),disabled:!1,isAndroid:l,isSafariOrIOS:a,isWindows:d,showEmojiInline:d,emojiType:"raw",highlightDiscussionId:void 0,theme:s,intl:R.default.getIntl(),renderedPageBlockId:void 0,parentBlockId:void 0,katex:void 0,isClient:!0,baseUrl:Q.default.domainBaseUrl,publicDomainName:Q.default.publicDomainName,currentUserId:c,overwriteBaseUrlFromSpaceId:m,externalIntegrations:qe.Z.integrations.state,formulaValueTypes:r,emojiData:X.Z.state,isMobileNative:u,isMobileNativeExternalLinkFixEnabled:ne.default.checkGate("mobile_native_external_link_fix"),displayInUserTimezone:ne.default.checkGate("display_date_in_user_timezone")},style:x.style,classNames:x.classNames,index:t,token:f,tokenValue:p.WiV(f),tokenAnnotations:p.hDy(f)}):(0,ie.jsx)("span",{className:[e.classNames||"",...x.classNames].join(" "),style:x.style,"data-token-index":e.textTokenIndex,children:e.value},t)}))}({store:i,parentSpaceId:r,valueTypes:s,syntaxTokens:f.oA(k),textValue:e||[],theme:l,isAndroid:a,isSafariOrIOS:d,isWindows:u,isMobileNative:c,overwriteBaseUrlFromSpaceId:m,currentUserId:h}),I=(0,ie.jsxs)(o.Fragment,{children:[S,(0,ie.jsx)("span",{children:"\n"})]});return _e.Z.renderToStaticMarkup(I)}(this.textValueStore.state,this.props.errorRanges,this.props.Prism,this.props.store,this.props.parentSpaceId,this.props.valueTypes,this.theme,s.isAndroid,s.isSafari||s.isIOS,s.isWindows,s.isMobileNative,(0,Xe.bT)(this.environment),this.environment.currentUser.id),getSelection:this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_getContainerSelection,onMutation:e=>function(e,t,n){const{newValue:o}=e;ze.createAndCommit({userAction:"FormulaInputText.handleMutation",environment:n,perform:e=>{We.aS({environment:n,editorMode:"default",store:t,newValue:o,disableMentions:!0,disableSlashCommands:!0,disableEmojiCommands:!0,disableFilters:!0,transaction:e}),e.postEnqueueActions.push((()=>{ze.createAndCommit({userAction:"FormulaInputText.normalizeTextValue",environment:n,perform:e=>{We.vE({store:t,editorMode:"default",transaction:e})}})}))}})}(e,this.props.store,this.environment),spellCheck:!1,autoCorrect:"off",autoCapitalize:"off",onSelect:t,onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,suppressNewlineEvents:!1,placeholder:" "})})},this.handleClick=e=>{$e.SD({environment:this.environment,event:e,textValue:this.textValueStore.state,editorNode:this.getEditorNode(),store:this.props.store,canEdit:!this.props.disabled})},this.handleDelete=e=>{if(this.props.disabled)return;const t=k.default.state;"editing"===t.mode&&t.multiSelection.start.store===this.props.store&&(ze.createAndCommit({userAction:"FormulaInputText.handleDelete",environment:this.environment,perform:n=>{He.as({environment:this.environment,multiSelection:t.multiSelection,deleteForwards:!0,transaction:n,event:e,editorMode:"default"})}}),this.scrollSelectionIntoView())},this.handleBackspace=e=>{if(this.props.disabled)return;const t=k.default.state;if("editing"===t.mode&&t.multiSelection.start.store===this.props.store){if(He.YV({device:this.environment.device,event:e,multiSelection:t.multiSelection}))return;ze.createAndCommit({userAction:"FormulaInputText.handleBackspace",environment:this.environment,perform:n=>{He.as({environment:this.environment,multiSelection:t.multiSelection,deleteForwards:!1,transaction:n,event:e,editorMode:"default"})}}),this.scrollSelectionIntoView()}},this.handleShiftEnter=e=>{var t,n,o;if(this.props.disabled)return;if(null===(t=e.preventDefault)||void 0===t||t.call(e),this.editor&&this.editor.isComposing)return;const i=k.default.state,r="editing"===i.mode&&(0,b.QY)(i.multiSelection);if(!r)return;const s=this.textValueStore.state,l=Ue.p4(p.QaF(s)),a=null===(n=l.slice(0,r.selection.startIndex).join("").split("\n"))||void 0===n?void 0:n.at(-1),d=(null==a||null===(o=a.match(/^\t*/))||void 0===o?void 0:o[0].length)||0,u=(null==a?void 0:a.split("").reverse())||[];let c=0;const m=u.some((e=>{if(")"===e)c++;else if("("===e){if(0===c)return!0;c--}return!1}))?d+1:d;let f="\t".repeat(m);const h=")"===l[r.selection.endIndex],x=!(null==a||!a.endsWith("("))&&h;x&&(f+=`\n${"\t".repeat(m-1)}`),ze.createAndCommit({userAction:"FormulaInputText.handleShiftEnter",environment:this.environment,perform:e=>{We.hJ({environment:this.environment,editorMode:"default",store:this.props.store,string:`\n${f}`,selection:r.selection,disableMentions:!0,disableSlashCommands:!0,disableEmojiCommands:!0,transaction:e}),x&&y.Z5({store:this.props.store,selection:{startIndex:r.selection.startIndex+m+1,endIndex:r.selection.startIndex+m+1}})}}),this.scrollSelectionIntoView()},this.handleCopy=e=>{var t;const{markdownLinkifyIt:n}=this.props,o=window.getSelection();null!=o&&o.anchorNode&&null!==(t=this.editor)&&void 0!==t&&null!==(t=t.getNode())&&void 0!==t&&t.contains(o.anchorNode)&&$.JG({environment:this.environment,event:e,markdownLinkifyIt:n})},this.handleCut=e=>{const{markdownLinkifyIt:t}=this.props;this.props.disabled?e.preventDefault():($.by({environment:this.environment,event:e,markdownLinkifyIt:t}),this.scrollSelectionIntoView())},this.handlePaste=e=>{const{markdownLinkifyIt:t,tinyMceMicrosoftWordPasteFilter:n}=this.props;this.props.disabled?e.preventDefault():(ze.createAndCommit({userAction:"FormulaInputText.handlePaste",environment:this.environment,perform:o=>{$.v({environment:this.environment,event:e,disableEmbedMenu:!0,transaction:o,onPasteFiles:$.AL,markdownLinkifyIt:t,tinyMceMicrosoftWordPasteFilter:n})}}),this.scrollSelectionIntoView())},this.handleMouseOver=e=>{$e.vO({environment:this.environment,event:e,textValue:this.textValueStore.state,editorNode:this.getEditorNode(),store:this.props.store,canEdit:!this.props.disabled})},this.handleMouseOut=e=>{$e.kV({environment:this.environment,event:e,textValue:this.textValueStore.state,editorNode:this.getEditorNode(),store:this.props.store,canEdit:!this.props.disabled})},this.scrollSelectionIntoView=()=>{const e=window.getSelection();null!=e&&e.rangeCount&&Oe.default.afterNextFlush((()=>{var t;const n=e.getRangeAt(0).getClientRects()[0],o=null===(t=this.editor)||void 0===t||null===(t=t.getNode())||void 0===t||null===(t=t.parentElement)||void 0===t?void 0:t.parentElement,i=null==o?void 0:o.getBoundingClientRect();n&&o&&i&&(i.top>=n.top?o.scrollTo({top:o.scrollTop+(n.top-i.top)-6}):i.bottom<=n.bottom+n.height&&o.scrollTo({top:o.scrollTop+(n.bottom-i.bottom)+28}))}))},this.clearBrowserSelection=()=>{var e;null===(e=this.getEditorNode())||void 0===e||e.blur()},this.textValueStore=new Ze.Z((()=>this.props.store.getValue()||[]),{debugName:"FormulaInputText.textValueStore"}),this.isEditing=this.createComputedStore((()=>{var e;const t=k.default.state;return"editing"===t.mode&&(null===(e=(0,b.QY)(t.multiSelection))||void 0===e?void 0:e.store)===this.props.store})),this.CLASS_COMPONENT_CONVERSION_DO_NOT_TOUCH_getContainerSelection=()=>function(e,t){if(t.state)return(0,Ye.HE)(e)}(this.props.store,this.isEditing),this.getEndSelection=()=>{const e=Ue.p4(p.QaF(this.textValueStore.state));return{startIndex:e.length,endIndex:e.length}},this.editorRef=e=>{this.editor=e}}UNSAFE_willMount(e){e.focus&&y.NX({store:e.store})}renderComponent(){const{store:e,disabled:t,handleSave:n}=this.props;return(0,ie.jsx)(et.Z,{debugName:"FormulaInputText",capture:!0,allowEnter:!0,allowTabUntab:!0,allowUndo:!0,allowEsc:!0,allowCopyPaste:!0,children:(0,ie.jsx)(tt.Z,{store:e,disabled:t,clearBrowserSelection:this.clearBrowserSelection,getEndSelection:this.getEndSelection,onClick:this.handleClick,onDelete:this.handleDelete,onBackspace:this.handleBackspace,onShiftEnter:this.handleShiftEnter,onCommandShiftEnter:f.yR,onTab:e=>function(e,t,n,o){if(t)return;e.preventDefault();const i=k.default.state,r="editing"===i.mode&&(0,b.QY)(i.multiSelection);r&&ze.createAndCommit({userAction:"FormulaInputText.handleTab",environment:o,perform:e=>{We.wA({environment:o,store:n,editorMode:"default",selection:r.selection,transaction:e,shouldStripTokens:!1,disableFilters:!0})}})}(e,this.props.disabled,this.props.store,this.environment),onUntab:e=>function(e,t,n,o){if(t)return;e.preventDefault();const i=k.default.state,r="editing"===i.mode&&(0,b.QY)(i.multiSelection);r&&ze.createAndCommit({userAction:"FormulaInputText.handleUntab",environment:o,perform:e=>{We.O5({environment:o,store:n,editorMode:"default",selection:r.selection,transaction:e,shouldStripTokens:!1,disableFilters:!0})}})}(e,this.props.disabled,this.props.store,this.environment),onToggleBold:e=>st(e,this.props.disabled),onToggleItalics:e=>st(e,this.props.disabled),onToggleUnderline:e=>st(e,this.props.disabled),onToggleStrike:e=>st(e,this.props.disabled),onToggleCode:f.yR,onCopy:this.handleCopy,onCut:this.handleCut,onPaste:this.handlePaste,onMoveUp:e=>{return t=this.environment,void ze.createAndCommit({userAction:"FormulaInputText.handleMoveUp",environment:t,perform:e=>{We.fs({environment:t,transaction:e,direction:"up"})}});var t},onMoveDown:e=>{return t=this.environment,void ze.createAndCommit({userAction:"FormulaInputText.handleMoveDown",environment:t,perform:e=>{We.fs({environment:t,transaction:e,direction:"down"})}});var t},onUndo:e=>function(e,t,n){var o;e.preventDefault();const i=Ke.XT();(null==i||null===(o=i.getFirstStore())||void 0===o?void 0:o.id)===t.id&&Ke.Yw(n)}(e,this.props.store,this.environment),onRedo:e=>function(e,t,n){var o;e.preventDefault();const i=Ke.M7();(null==i||null===(o=i.getFirstStore())||void 0===o?void 0:o.id)===t.id&&Ke.KX(n)}(e,this.props.store,this.environment),onEsc:n,render:this.renderContentContainer,disableStyleAnnotations:!0,disableMentions:!0,disableSlashCommands:!0,canSelectAllBlocks:!1,canInsertText:!0,canSelectionDrag:!0,disableMobileActionBar:!0,topBottomPadding:40,pasteBehavior:"inline"})})}getEditorNode(){var e;return(null===(e=this.editor)||void 0===e?void 0:e.getNode())||void 0}}function it(e){const{value:t}=(0,ee.useDependency)(ee.deps.prismjs),{value:n}=(0,ee.useDependency)(ee.deps.markdownLinkifyIt),{value:o}=(0,ee.useDependency)(ee.deps.tinyMceMicrosoftWordPasteFilter);return t?(0,ie.jsx)(ot,{...e,Prism:t,markdownLinkifyIt:n,tinyMceMicrosoftWordPasteFilter:o}):null}function rt(e){return q.Gs(e)?[e.data]:q.kK(e)?[e.textContent||"",e.className]:void 0}function st(e,t){t||e.preventDefault()}ot.displayName="FormulaInputText";const lt=!1,at=400;function dt(e){const{evaluationErrors:t,initialCode:n,parentSpaceId:c,outputFooter:v,disabled:I,typecheckContext:C,formulas:M,handleBack:w,onCodeChange:T,onTypeChange:j,parentCollection:F}=e,E=(0,m.useIntl)(),R=(0,i.Fy)(),{store:V,setValue:A}=(0,g.Cl)({initialValue:n,onChange:T,source:"formula",parentCollection:F}),B=(0,o.useCallback)((e=>{if(A(e.newValue),e.newSelection){const t={start:{store:V,index:e.newSelection.startIndex},end:{store:V,index:e.newSelection.endIndex}};y.NA({multiSelection:t})}}),[A,V]),D=(0,r.VK)((()=>{var e;const t=k.default.state;if("editing"===t.mode&&(null===(e=(0,b.QY)(t.multiSelection))||void 0===e?void 0:e.store)===V)return{startIndex:t.multiSelection.start.index,endIndex:t.multiSelection.end.index}}),[V]),N=(0,r.VK)((()=>!f.Xy(V.getValue(),n)),[n,V]),{handleClose:P}=e,O=(0,o.useCallback)((()=>{P(V.getValue())}),[P,V]),G=(0,r.VK)((()=>V.getValue()),[V]),[Z,U]=(0,r.VK)((()=>G?M.processFormulaInput(G):[void 0,void 0]),[G,M]),L=(0,r.VK)((()=>{if(Z)return M.parseFormulaInputToCst(Z,U)}),[Z,M,U]),_=(0,r.VK)((()=>{if(L)return M.convertFormulaCSTToAST(L[0])}),[M,L]),[K,W]=(0,o.useState)(void 0);(0,o.useEffect)((()=>{!async function(){if(_&&C&&h.x.isSuccess(_)){const e=await M.addTypesToFormulaASTAsync(_.value,C,U);W(e),null==j||j(e.node.type)}else W(void 0)}()}),[_,C,U,L,M,j]);const H=(0,o.useMemo)((()=>void 0!==K?[...(0,d.Kl)(K.node,!1),...K.errors]:[]),[K]),z=(0,o.useMemo)((()=>({parseErrors:(null==L?void 0:L[1])??[],typeErrors:H,evaluationErrors:t})),[t,L,H]),$=(0,u.Kt)(z,at,Object.is),Q=z.parseErrors.length+z.typeErrors.length+z.evaluationErrors.length>0,Y=(0,r.VK)((()=>function(e){const{errors:t,intl:n,codeLength:o,formulas:i}=e,{parseErrors:r,typeErrors:s,evaluationErrors:a}=t,d=[];if(s&&s.length>0){const e=s.map((e=>{const t=(0,l.FR)((0,l.ic)(e));return{msg:n.formatMessage(...t),range:{startIndex:e.node.startOffset,endIndex:e.node.endOffset+1}}}));d.push(...e)}else if(a&&a.length>0){const e=a.map((e=>{const t=(0,l.FR)((0,l.OY)(e));return{msg:n.formatMessage(...t),range:i.isUniqueFormulaEvaluatorError(e)?{startIndex:e.node.startOffset,endIndex:e.node.endOffset+1}:void 0}}));d.push(...e)}if(r){const e=r.map((e=>{const t=(0,l.FR)((0,l.sG)(e));return{msg:n.formatMessage(...t),range:"eof"===e.offset?{startIndex:o-1,endIndex:o}:{startIndex:e.offset,endIndex:e.offset+1}}}));d.push(...e)}return d}({errors:$,codeLength:U?(0,a.eD)(U):(0,p.QaF)(G).length,formulas:M,intl:E})),[G,$,M,E,U]),X=(0,o.useMemo)((()=>Y.map((e=>e.range)).filter(x.$K)),[Y]),[q,J]=(0,o.useState)(void 0),ee=(0,o.useRef)(void 0),[te,ne]=(0,o.useState)(void 0),oe=(0,o.useRef)(1);(0,o.useEffect)((()=>{oe.current++;const e=oe.current;!async function(){if(M){const t=await M.getFormulaEditorInfoAtPosition({formula:G??[],inputPosition:D&&D.startIndex===D.endIndex?D.startIndex:0,context:C,includeDeprecatedCompletions:!1});h.x.isSuccess(t)&&oe.current===e&&(ee.current=t.value,J(t.value))}}()}),[D,M,C,G]);const se=(0,o.useCallback)((()=>{A(n)}),[n,A]);lt&&console.log("FormulaInput",{currentValue:G,cursorEditorInfo:q,infoHelper:te,errorMessagesWithRange:Y,errorRanges:X,astWithTypes:K});const le=(0,s.yK)((e=>({container:{display:"flex",height:"100%",paddingBottom:void 0,flexDirection:"column"},editorSection:{display:"flex",flexDirection:"column",backgroundColor:"light"===e.mode?e.cardBackground:e.accentColors.gray[30]},inputText:{display:"flex",flexGrow:1,flexShrink:1,overflow:"auto",maxHeight:"min(calc(90vh - 240px - 38px - 30px), 298px)",minHeight:"28px",cursor:"text"},bottomSection:{display:"flex",flexDirection:"row",height:R.isMobile?"100%":240,maxHeight:R.isMobile?void 0:"calc(90vh - 38px - 31px - 38px - 30px)",borderTop:`1px solid ${e.outlineButtonBorder}`},leftColumn:{position:"relative",borderRight:`1px solid ${e.outlineButtonBorder}`,width:R.isMobile?"100%":void 0},rightColumn:{display:"flex",flexGrow:1},infoHelper:{padding:"12px 14px"}})),[R.isMobile]);return(0,ie.jsx)(S.Z,{debugName:"FormulaInput",capture:!0,children:(0,ie.jsxs)("div",{style:le.container,children:[(0,ie.jsxs)("div",{style:le.editorSection,children:[(0,ie.jsx)(Re,{onClickBack:w,onClickClose:O,onClickRevert:se,showRevert:N,disabled:I}),(0,ie.jsx)("div",{style:le.inputText,children:(0,ie.jsx)(it,{value:G,focus:!0,store:V,disabled:I,parentSpaceId:c,valueTypes:C.valueTypes,errorRanges:X,handleSave:O},"input")})]}),Y.length>0&&Q?(0,ie.jsx)(ut,{errorMessagesWithRange:Y}):v,!I&&(0,ie.jsxs)("div",{style:le.bottomSection,children:[(0,ie.jsx)("div",{style:le.leftColumn,children:(0,ie.jsx)(fe,{store:V,context:C,selection:D,cursorEditorInfo:q,cursorEditorInfoRef:ee,onChange:B,getRecordModel:e.getRecordModel,setInfoHelper:ne})}),!R.isMobile&&(0,ie.jsx)("div",{style:le.rightColumn,children:(0,ie.jsx)(re,{infoHelper:te,getRecordModel:e.getRecordModel,style:le.infoHelper})})]})]})})}const ut=o.memo((e=>{let{errorMessagesWithRange:t}=e;const n=(0,s.yK)((e=>({errors:{display:"flex",flexDirection:"row",alignItems:"center",padding:10,fontSize:v.Z.fontSize.UISmall.desktop,height:38,width:"100%",borderTop:`1px solid ${e.outlineButtonBorder}`,textWrap:"nowrap",color:e.darkTextColor,flexShrink:0},icon:{width:12,height:12,fill:"light"===e.mode?e.accentColors.red[400]:e.accentColors.red[700],display:"inline",marginRight:4,marginTop:1},errorMessages:{overflow:"hidden",textOverflow:"ellipsis",color:"light"===e.mode?e.accentColors.red[500]:e.accentColors.red[800]}})),[]);return 0===t.length?null:(0,ie.jsxs)("div",{style:n.errors,children:[(0,c.t)(n.icon),(0,ie.jsx)("span",{style:n.errorMessages,children:t.slice(0,3).map(((e,t)=>(0,ie.jsx)(ct,{index:t,errorMessageWithRange:e},t)))})]})}));function ct(e){let{errorMessageWithRange:t,index:n}=e;const{msg:o,range:i}=t,r=(0,s.yK)((()=>({errorRange:{opacity:.75}})),[]);return(0,ie.jsxs)(ie.Fragment,{children:[n>0?" ":null,o,void 0!==i&&(0,ie.jsxs)(ie.Fragment,{children:[" ",(0,ie.jsx)("span",{style:r.errorRange,children:`[${i.startIndex},${i.endIndex}]`})]})]})}},96711:(e,t,n)=>{n.d(t,{V:()=>r});n(67294);var o=n(45238),i=n(85893);const r=(0,o.IU)("checkboxSquareChecked",{viewBox:"0 0 14 14",svg:(0,i.jsx)("path",{d:"M2.85742 13.4561H11.1357C12.6123 13.4561 13.3779 12.6904 13.3779 11.2344V2.91504C13.3779 1.45215 12.6123 0.693359 11.1357 0.693359H2.85742C1.38086 0.693359 0.615234 1.45215 0.615234 2.91504V11.2344C0.615234 12.6973 1.38086 13.4561 2.85742 13.4561ZM2.93945 12.1162C2.30371 12.1162 1.95508 11.7812 1.95508 11.1182V3.02441C1.95508 2.36133 2.30371 2.0332 2.93945 2.0332H11.0537C11.6826 2.0332 12.0381 2.36133 12.0381 3.02441V11.1182C12.0381 11.7812 11.6826 12.1162 11.0537 12.1162H2.93945ZM6.26855 10.3115C6.51465 10.3115 6.72656 10.1885 6.87012 9.96973L9.92578 5.19141C10.0146 5.04785 10.0967 4.88379 10.0967 4.72656C10.0967 4.3916 9.7959 4.16602 9.47461 4.16602C9.26953 4.16602 9.08496 4.27539 8.94141 4.50781L6.24121 8.8418L4.96973 7.22168C4.80566 7.00977 4.6416 6.93457 4.43652 6.93457C4.10156 6.93457 3.8418 7.20117 3.8418 7.54297C3.8418 7.70703 3.90332 7.85742 4.01953 8.00098L5.63281 9.96973C5.81738 10.209 6.01562 10.3115 6.26855 10.3115Z"})})},18557:(e,t,n)=>{n.d(t,{z:()=>r});n(67294);var o=n(45238),i=n(85893);const r=(0,o.IU)("flag",{viewBox:"0 0 13 14",svg:(0,i.jsx)("path",{d:"M0.825195 13.8457C1.16699 13.8457 1.4541 13.5654 1.4541 13.2168V9.47754C1.63867 9.40918 2.21973 9.19727 3.10156 9.19727C5.59668 9.19727 7.25781 10.4414 9.66406 10.4414C10.7168 10.4414 11.1885 10.3115 11.7217 10.0654C12.207 9.84668 12.4941 9.4502 12.4941 8.82129V1.99219C12.4941 1.55469 12.1523 1.27441 11.6943 1.27441C11.3047 1.27441 10.6895 1.54102 9.58887 1.54102C7.20996 1.54102 5.52148 0.296875 3.0332 0.296875C1.99414 0.296875 1.5293 0.419922 0.975586 0.672852C0.49707 0.891602 0.196289 1.24707 0.196289 1.86914V13.2168C0.196289 13.5586 0.483398 13.8457 0.825195 13.8457ZM9.63672 9.16309C7.41504 9.16309 5.71289 7.92578 3.12207 7.92578C2.45215 7.92578 1.84375 8.00098 1.48145 8.14453V2.0332C1.59766 1.83496 2.11035 1.56836 3.05371 1.56836C5.38477 1.56836 7.09375 2.80566 9.56836 2.80566C10.2383 2.80566 10.792 2.73047 11.2158 2.61426V8.69824C11.0996 8.89648 10.5801 9.16309 9.63672 9.16309Z"})})}}]);