#!/bin/bash

# One of the following: xrandr, kernel
METHOD="kernel"

# Left click
if [[ "${BLOCK_BUTTON}" -eq 1 ]]; then
  brightness=$(cat /sys/class/backlight/intel_backlight/brightness)
  new_brightness=$((brightness + 5))
  if (( new_brightness > $(cat /sys/class/backlight/intel_backlight/max_brightness) )); then
    new_brightness=$(cat /sys/class/backlight/intel_backlight/max_brightness)
  fi
  echo $new_brightness | sudo tee /sys/class/backlight/intel_backlight/brightness
# Right click
elif [[ "${BLOCK_BUTTON}" -eq 3 ]]; then
  brightness=$(cat /sys/class/backlight/intel_backlight/brightness)
  new_brightness=$((brightness - 5))
  if (( new_brightness < 0 )); then
    new_brightness=0
  fi
  echo $new_brightness | sudo tee /sys/class/backlight/intel_backlight/brightness
fi

URGENT_VALUE=10

device="intel_backlight"
maxBrightness=$(cat /sys/class/backlight/${device}/max_brightness)
curBrightness=$(cat /sys/class/backlight/${device}/brightness)

if [[ "${curBrightness}" -le 0 ]]; then
  exit
fi

percent=$(echo "scale=0;${curBrightness} * 100 / ${maxBrightness}" | bc -l)

percent=${percent%.*}

if [[ "${percent}" -le 0 ]]; then
  exit
fi

echo "${percent}% "
echo "${percent}% "
echo " "

if [[ "${percent}" -le "${URGENT_VALUE}" ]]; then
  exit 33
fi